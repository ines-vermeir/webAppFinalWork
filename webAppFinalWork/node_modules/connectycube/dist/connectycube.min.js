!function(e,t){"object"==typeof exports&&"object"==typeof module?module.exports=t(require("nativescript-xmpp-client"),require("node-fetch"),require("form-data"),require("node-xmpp-client")):"function"==typeof define&&define.amd?define(["nativescript-xmpp-client","node-fetch","form-data","node-xmpp-client"],t):"object"==typeof exports?exports.ConnectyCube=t(require("nativescript-xmpp-client"),require("node-fetch"),require("form-data"),require("node-xmpp-client")):e.ConnectyCube=t(e["nativescript-xmpp-client"],e["node-fetch"],e["form-data"],e["node-xmpp-client"])}(window,function(e,t,n,r){return function(e){var t={};function n(r){if(t[r])return t[r].exports;var i=t[r]={i:r,l:!1,exports:{}};return e[r].call(i.exports,i,i.exports,n),i.l=!0,i.exports}return n.m=e,n.c=t,n.d=function(e,t,r){n.o(e,t)||Object.defineProperty(e,t,{enumerable:!0,get:r})},n.r=function(e){"undefined"!=typeof Symbol&&Symbol.toStringTag&&Object.defineProperty(e,Symbol.toStringTag,{value:"Module"}),Object.defineProperty(e,"__esModule",{value:!0})},n.t=function(e,t){if(1&t&&(e=n(e)),8&t)return e;if(4&t&&"object"==typeof e&&e&&e.__esModule)return e;var r=Object.create(null);if(n.r(r),Object.defineProperty(r,"default",{enumerable:!0,value:e}),2&t&&"string"!=typeof e)for(var i in e)n.d(r,i,function(t){return e[t]}.bind(null,i));return r},n.n=function(e){var t=e&&e.__esModule?function(){return e.default}:function(){return e};return n.d(t,"a",t),t},n.o=function(e,t){return Object.prototype.hasOwnProperty.call(e,t)},n.p="",n(n.s=14)}([function(e,t,n){(function(t,r){function i(e){return(i="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e})(e)}var o=n(1),s=n(8),a={machine:Math.floor(16777216*Math.random()).toString(16),pid:Math.floor(32767*Math.random()).toString(16),increment:0},c={getEnv:function(){return s.getEnv()},isWebRTCAvailble:function(){return s.isWebRTCAvailble()},safeCallbackCall:function(){for(var e,t=arguments[0].toString().split("(")[0].split(" ")[1],n=[],r=0;r<arguments.length;r++)n.push(arguments[r]);e=n.shift();try{e.apply(null,n)}catch(e){""===t?console.error("Error: "+e):console.error("Error in listener "+t+": "+e)}},randomNonce:function(){return Math.floor(1e4*Math.random())},unixTime:function(){return Math.floor(Date.now()/1e3)},getUrl:function(e,t){var n=t?"/"+t:"";return"https://"+o.endpoints.api+"/"+e+n+o.urls.type},isArray:function(e){return"[object Array]"===Object.prototype.toString.call(e)},isObject:function(e){return"[object Object]"===Object.prototype.toString.call(e)},isFunction:function(e){return!!(e&&e.constructor&&e.call&&e.apply)},getBsonObjectId:function(){var e=this.unixTime().toString(16),t=(a.increment++).toString(16);return t>16777215&&(a.increment=0),"00000000".substr(0,8-e.length)+e+"000000".substr(0,6-a.machine.length)+a.machine+"0000".substr(0,4-a.pid.length)+a.pid+"000000".substr(0,6-t.length)+t},DLog:function(){var e=this;if(e.loggers)for(var t=0;t<e.loggers.length;++t)e.loggers[t](arguments);else{var n;e.loggers=[];var r=function(){return function(e){console.log.apply(console,Array.prototype.slice.call(e))}};if("object"===i(o.debug)?"number"==typeof o.debug.mode?1==o.debug.mode&&(n=r(),e.loggers.push(n)):"object"===i(o.debug.mode)&&o.debug.mode.forEach(function(t){1===t&&(n=r(),e.loggers.push(n))}):"boolean"==typeof o.debug&&o.debug&&(n=r(),e.loggers.push(n)),e.loggers)for(var s=0;s<e.loggers.length;++s)e.loggers[s](arguments)}},getError:function(e,t,n){var r={code:e,status:"error",detail:t};switch(e){case 401:r.message="Unauthorized";break;case 403:r.message="Forbidden";break;case 408:r.message="Request Timeout";break;case 422:r.message="Unprocessable Entity";break;case 502:r.message="Bad Gateway";break;default:r.message="Unknown error"}return this.DLog("["+n+"]","Error:",t),r},isExpiredSessionError:function(e){try{return e&&401===e.code&&"Required session does not exist"===e.message.errors.base[0]}catch(e){return!1}},MergeArrayOfObjects:function(e,t){var n=JSON.parse(JSON.stringify(e));e:for(var r=0;r<t.length;r++){for(var i=t[r],o=0;o<n.length;o++)if(i.user_id===n[o].user_id){n[o]=i;continue e}n.push(i)}return n},toBase64:function(e){return this.getEnv().browser?btoa(encodeURIComponent(e).replace(/%([0-9A-F]{2})/g,function(e,t){return String.fromCharCode("0x"+t)})):this.getEnv().reactnative?t.btoa(e):new r(e).toString("base64")}};e.exports=c}).call(this,n(7),n(16).Buffer)},function(e,t){function n(e){return(n="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e})(e)}var r={version:"1.7.2",creds:{appId:"",authKey:"",authSecret:""},endpoints:{api:"api.connectycube.com",chat:"chat.connectycube.com",muc:"muc.chat.connectycube.com"},hash:"sha1",chatProtocol:{bosh:"https://chat.connectycube.com:5281",websocket:"wss://chat.connectycube.com:5291",active:2},webSession:{getSessionTimeInterval:3,getSessionTimeout:120},chat:{contactList:{subscriptionMode:{mutual:!0}},reconnectionTimeInterval:5,streamManagement:{enable:!1}},videochat:{answerTimeInterval:60,dialingTimeInterval:5,disconnectTimeInterval:30,statsReportTimeInterval:!1,iceServers:[{urls:"stun:stun.l.google.com:19302"},{urls:"stun:turn.connectycube.com"},{urls:"turn:turn.connectycube.com:5349?transport=udp",username:"connectycube",credential:"4c29501ca9207b7fb9c4b4b6b04faeb1"},{urls:"turn:turn.connectycube.com:5349?transport=tcp",username:"connectycube",credential:"4c29501ca9207b7fb9c4b4b6b04faeb1"}]},urls:{session:"session",webSession:"session/web",login:"login",users:"users",chat:"chat",blobs:"blobs",subscriptions:"subscriptions",events:"events",data:"data",addressbook:"address_book",addressbookRegistered:"address_book/registered_users",type:".json"},on:{sessionExpired:null},timeout:null,debug:{mode:0},set:function(e){"object"===n(e.endpoints)&&e.endpoints.chat&&(r.endpoints.muc="muc."+e.endpoints.chat,r.chatProtocol.bosh="https://"+e.endpoints.chat+":5281",r.chatProtocol.websocket="wss://"+e.endpoints.chat+":5291"),Object.keys(e).forEach(function(t){"set"!==t&&r.hasOwnProperty(t)&&("object"!==n(e[t])?r[t]=e[t]:Object.keys(e[t]).forEach(function(n){r[t].hasOwnProperty(n)&&(r[t][n]=e[t][n])}))})}};e.exports=r},function(e,t,n){var r,i,o,s,a,c,l,u,d,h=n(0);h.getEnv().browser?(r=fetch,i=FormData,Strophe=n(20),Object.assign(window,Strophe),o=n(21),s=window.RTCPeerConnection,a=window.RTCSessionDescription,c=window.RTCIceCandidate,l=window.MediaStream,u=navigator.mediaDevices,d=n(22)):h.getEnv().nativescript?(r=fetch,i=FormData,o=n(25)):h.getEnv().node&&(r=n(26),i=n(27),o=n(28)),e.exports={fetchImpl:r,formDataImpl:i,XMPPClient:o,XMPPWebSocketTransport:void 0,RTCPeerConnection:s,RTCSessionDescription:a,RTCIceCandidate:c,MediaStream:l,mediaDevices:u,SDPTransform:d}},function(e,t,n){"use strict";function r(e){return(r="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e})(e)}var i=n(0),o=n(1),s=n(2).XMPPClient,a="Unknown interface. SDK support browser / node env.",c={MARKERS:{CLIENT:"jabber:client",CHAT:"urn:xmpp:chat-markers:0",STATES:"http://jabber.org/protocol/chatstates",MARKERS:"urn:xmpp:chat-markers:0",CARBONS:"urn:xmpp:carbons:2",ROSTER:"jabber:iq:roster",MUC:"http://jabber.org/protocol/muc",PRIVACY:"jabber:iq:privacy",LAST:"jabber:iq:last"},buildUserJid:function(e){var t;return"userId"in e?(t=e.userId+"-"+o.creds.appId+"@"+o.endpoints.chat,"resource"in e&&(t=t+"/"+e.resource)):"jid"in e&&(t=e.jid),t},buildUserJidLocalPart:function(e){return e+"-"+o.creds.appId},createMessageStanza:function(e){return i.getEnv().browser?$msg(e):i.getEnv().reactnative?s.xml("message",e):new s.Stanza("message",e)},createIqStanza:function(e){return i.getEnv().browser?$iq(e):i.getEnv().reactnative?s.xml("iq",e):new s.Stanza("iq",e)},createPresenceStanza:function(e){return i.getEnv().browser?$pres(e):i.getEnv().reactnative?s.xml("presence",e):new s.Stanza("presence",e)},createNonza:function(e,t){return i.getEnv().browser?$build(e,t):i.getEnv().reactnative?s.xml(e,t):new s.Stanza(e,t)},getAttr:function(e,t){var n;return e?("function"==typeof e.getAttribute?n=e.getAttribute(t):e.attrs&&(n=e.attrs[t]),n||null):null},getElement:function(e,t){var n;if("function"==typeof e.querySelector)n=e.querySelector(t);else{if("function"!=typeof e.getChild)throw a;n=e.getChild(t)}return n||null},getAllElements:function(e,t){var n;if("function"==typeof e.querySelectorAll)n=e.querySelectorAll(t);else{if("function"!=typeof e.getChild)throw a;n=e.getChild(t)}return n||null},getElementText:function(e,t){var n,r;if("function"==typeof e.querySelector)r=(n=e.querySelector(t))?n.textContent:null;else{if("function"!=typeof e.getChildText)throw a;r=e.getChildText(t)}return r||null},_JStoXML:function(e,t,n){var i=this;n.c(e),Object.keys(t).forEach(function(e){"object"===r(t[e])?i._JStoXML(e,t[e],n):n.c(e).t(t[e]).up()}),n.up()},_XMLtoJS:function(e,t,n){e[t]={};for(var r=0,i=n.childNodes.length;r<i;r++)n.childNodes[r].childNodes.length>1?e[t]=this._XMLtoJS(e[t],n.childNodes[r].tagName,n.childNodes[r]):e[t][n.childNodes[r].tagName]=n.childNodes[r].textContent;return e},filledExtraParams:function(e,t){var n=this;return Object.keys(t).forEach(function(o){"attachments"===o?t[o].forEach(function(t){i.getEnv().browser?e.c("attachment",t).up():e.getChild("extraParams").c("attachment",t).up()}):"object"===r(t[o])?n._JStoXML(o,t[o],e):i.getEnv().browser?e.c(o).t(t[o]).up():e.getChild("extraParams").c(o).t(t[o]).up()}),e.up(),e},parseExtraParams:function(e){if(!e)return null;var t,n,r,o={},s=[];if(i.getEnv().browser)for(var a=0,c=e.childNodes.length;a<c;a++)if("attachment"===e.childNodes[a].tagName){n={};for(var l=0,u=(r=e.childNodes[a].attributes).length;l<u;l++)"size"===r[l].name?n[r[l].name]=parseInt(r[l].value):n[r[l].name]=r[l].value;s.push(n)}else if("dialog_id"===e.childNodes[a].tagName)t=e.childNodes[a].textContent,o.dialog_id=t;else{if(e.childNodes[a].childNodes.length>1)if(e.childNodes[a].textContent.length>4096){for(var d="",h=0;h<e.childNodes[a].childNodes.length;++h)d+=e.childNodes[a].childNodes[h].textContent;o[e.childNodes[a].tagName]=d}else o=this._XMLtoJS(o,e.childNodes[a].tagName,e.childNodes[a]);else o[e.childNodes[a].tagName]=e.childNodes[a].textContent}else for(var f=0,p=e.children.length;f<p;f++){if("attachment"===e.children[f].name){n={},r=e.children[f].attrs;for(var m=Object.keys(r),g=0;g<m.length;g++)"size"===m[g]?n.size=parseInt(r.size):n[m[g]]=r[m[g]];s.push(n)}else"dialog_id"===e.children[f].name&&(t=e.getChildText("dialog_id"),o.dialog_id=t);if(1===e.children[f].children.length){var v=e.children[f];o[v.name]=v.children[0]}}return s.length>0&&(o.attachments=s),o.moduleIdentifier&&delete o.moduleIdentifier,{extension:o,dialogId:t}},getUniqueId:function(e){var t="xxxxxxxx-xxxx-4xxx-yxxx-xxxxxxxxxxxx".replace(/[xy]/g,function(e){var t=16*Math.random()|0;return("x"==e?t:3&t|8).toString(16)});return"string"==typeof e||"number"==typeof e?t+":"+e:t+""},getErrorFromXMLNode:function(e){var t=this.getElement(e,"error"),n=parseInt(this.getAttr(t,"code")),r=this.getElementText(t,"text");return i.getError(n,r)}};e.exports=c},function(e,t,n){var r;e.exports=(r=r||function(e,t){var n=Object.create||function(){function e(){}return function(t){var n;return e.prototype=t,n=new e,e.prototype=null,n}}(),r={},i=r.lib={},o=i.Base={extend:function(e){var t=n(this);return e&&t.mixIn(e),t.hasOwnProperty("init")&&this.init!==t.init||(t.init=function(){t.$super.init.apply(this,arguments)}),t.init.prototype=t,t.$super=this,t},create:function(){var e=this.extend();return e.init.apply(e,arguments),e},init:function(){},mixIn:function(e){for(var t in e)e.hasOwnProperty(t)&&(this[t]=e[t]);e.hasOwnProperty("toString")&&(this.toString=e.toString)},clone:function(){return this.init.prototype.extend(this)}},s=i.WordArray=o.extend({init:function(e,t){e=this.words=e||[],this.sigBytes=null!=t?t:4*e.length},toString:function(e){return(e||c).stringify(this)},concat:function(e){var t=this.words,n=e.words,r=this.sigBytes,i=e.sigBytes;if(this.clamp(),r%4)for(var o=0;o<i;o++){var s=n[o>>>2]>>>24-o%4*8&255;t[r+o>>>2]|=s<<24-(r+o)%4*8}else for(var o=0;o<i;o+=4)t[r+o>>>2]=n[o>>>2];return this.sigBytes+=i,this},clamp:function(){var t=this.words,n=this.sigBytes;t[n>>>2]&=4294967295<<32-n%4*8,t.length=e.ceil(n/4)},clone:function(){var e=o.clone.call(this);return e.words=this.words.slice(0),e},random:function(t){for(var n,r=[],i=function(t){var t=t,n=987654321,r=4294967295;return function(){var i=((n=36969*(65535&n)+(n>>16)&r)<<16)+(t=18e3*(65535&t)+(t>>16)&r)&r;return i/=4294967296,(i+=.5)*(e.random()>.5?1:-1)}},o=0;o<t;o+=4){var a=i(4294967296*(n||e.random()));n=987654071*a(),r.push(4294967296*a()|0)}return new s.init(r,t)}}),a=r.enc={},c=a.Hex={stringify:function(e){for(var t=e.words,n=e.sigBytes,r=[],i=0;i<n;i++){var o=t[i>>>2]>>>24-i%4*8&255;r.push((o>>>4).toString(16)),r.push((15&o).toString(16))}return r.join("")},parse:function(e){for(var t=e.length,n=[],r=0;r<t;r+=2)n[r>>>3]|=parseInt(e.substr(r,2),16)<<24-r%8*4;return new s.init(n,t/2)}},l=a.Latin1={stringify:function(e){for(var t=e.words,n=e.sigBytes,r=[],i=0;i<n;i++){var o=t[i>>>2]>>>24-i%4*8&255;r.push(String.fromCharCode(o))}return r.join("")},parse:function(e){for(var t=e.length,n=[],r=0;r<t;r++)n[r>>>2]|=(255&e.charCodeAt(r))<<24-r%4*8;return new s.init(n,t)}},u=a.Utf8={stringify:function(e){try{return decodeURIComponent(escape(l.stringify(e)))}catch(e){throw new Error("Malformed UTF-8 data")}},parse:function(e){return l.parse(unescape(encodeURIComponent(e)))}},d=i.BufferedBlockAlgorithm=o.extend({reset:function(){this._data=new s.init,this._nDataBytes=0},_append:function(e){"string"==typeof e&&(e=u.parse(e)),this._data.concat(e),this._nDataBytes+=e.sigBytes},_process:function(t){var n=this._data,r=n.words,i=n.sigBytes,o=this.blockSize,a=4*o,c=i/a,l=(c=t?e.ceil(c):e.max((0|c)-this._minBufferSize,0))*o,u=e.min(4*l,i);if(l){for(var d=0;d<l;d+=o)this._doProcessBlock(r,d);var h=r.splice(0,l);n.sigBytes-=u}return new s.init(h,u)},clone:function(){var e=o.clone.call(this);return e._data=this._data.clone(),e},_minBufferSize:0}),h=(i.Hasher=d.extend({cfg:o.extend(),init:function(e){this.cfg=this.cfg.extend(e),this.reset()},reset:function(){d.reset.call(this),this._doReset()},update:function(e){return this._append(e),this._process(),this},finalize:function(e){e&&this._append(e);var t=this._doFinalize();return t},blockSize:16,_createHelper:function(e){return function(t,n){return new e.init(n).finalize(t)}},_createHmacHelper:function(e){return function(t,n){return new h.HMAC.init(e,n).finalize(t)}}}),r.algo={});return r}(Math),r)},function(e,t,n){"use strict";var r=n(1),i=n(0),o={};(o={getUserJid:function(e,t){return e+"-"+t+"@"+r.endpoints.chat},getIdFromNode:function(e){return e.indexOf("@")<0?null:parseInt(e.split("@")[0].split("-")[0])},userCurrentJid:function(e){return i.getEnv().browser?e.jid:i.getEnv().reactnative?e.jid._local+"@"+e.jid._domain+"/"+e.jid._resource:e.jid.user+"@"+e.jid._domain+"/"+e.jid._resource},trace:function(e){r.debug&&console.log("[VideoChat]:",e)},traceWarning:function(e){r.debug&&console.warn("[VideoChat]:",e)},traceError:function(e){r.debug&&console.error("[VideoChat]:",e)},dataURItoBlob:function(e,t){for(var n=[],r=window.atob(e.split(",")[1]),i=0,o=r.length;i<o;i++)n.push(r.charCodeAt(i));return new Blob([new Uint8Array(n)],{type:t})},getVersionFirefox:function(){var e,t=!!navigator&&navigator.userAgent;if(t){var n=t.match(/(?:firefox)[ \/](\d+)/i)||[];e=n[1]?+n[1]:null}return e},getVersionSafari:function(){var e,t=!!navigator&&navigator.userAgent;if(t)if((t.match(/(?:safari)[ \/](\d+)/i)||[]).length){var n=t.match(/(?:version)[ \/](\d+)/i)||[];e=n&&n[1]?+n[1]:null}else e=null;return e}}).SessionConnectionState={UNDEFINED:0,CONNECTING:1,CONNECTED:2,FAILED:3,DISCONNECTED:4,CLOSED:5,COMPLETED:6},o.CallType={VIDEO:1,AUDIO:2},e.exports=o},function(e,t,n){"use strict";function r(){}r.MODULE_ID="WebRTCVideoChat",r.SignalingType={CALL:"call",ACCEPT:"accept",REJECT:"reject",STOP:"hangUp",CANDIDATE:"iceCandidates",PARAMETERS_CHANGED:"update"},e.exports=r},function(e,t){var n;n=function(){return this}();try{n=n||new Function("return this")()}catch(e){"object"==typeof window&&(n=window)}e.exports=n},function(e,t,n){(function(t){function n(e){return(n="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e})(e)}var r={isBrowser:"undefined"!=typeof document,isReactNative:"undefined"!=typeof navigator&&"ReactNative"==navigator.product,isNativeScript:"object"===(void 0===t?"undefined":n(t))&&(void 0!==t.android||void 0!==t.NSObject),getEnv:function(){return{nativescript:this.isNativeScript,reactnative:this.isReactNative,browser:this.isBrowser,node:!this.isBrowser&&!this.isNativeScript&&!this.isReactNative}},isWebRTCAvailble:function(){var e=!1;return this.isBrowser?window.RTCPeerConnection&&window.RTCIceCandidate&&window.RTCSessionDescription&&(e=!0):this.isReactNative&&(e=!0),e}};e.exports=r}).call(this,n(7))},function(e,t){var n=e.exports={v:[{name:"version",reg:/^(\d*)$/}],o:[{name:"origin",reg:/^(\S*) (\d*) (\d*) (\S*) IP(\d) (\S*)/,names:["username","sessionId","sessionVersion","netType","ipVer","address"],format:"%s %s %d %s IP%d %s"}],s:[{name:"name"}],i:[{name:"description"}],u:[{name:"uri"}],e:[{name:"email"}],p:[{name:"phone"}],z:[{name:"timezones"}],r:[{name:"repeats"}],t:[{name:"timing",reg:/^(\d*) (\d*)/,names:["start","stop"],format:"%d %d"}],c:[{name:"connection",reg:/^IN IP(\d) (\S*)/,names:["version","ip"],format:"IN IP%d %s"}],b:[{push:"bandwidth",reg:/^(TIAS|AS|CT|RR|RS):(\d*)/,names:["type","limit"],format:"%s:%s"}],m:[{reg:/^(\w*) (\d*) ([\w\/]*)(?: (.*))?/,names:["type","port","protocol","payloads"],format:"%s %d %s %s"}],a:[{push:"rtp",reg:/^rtpmap:(\d*) ([\w\-\.]*)(?:\s*\/(\d*)(?:\s*\/(\S*))?)?/,names:["payload","codec","rate","encoding"],format:function(e){return e.encoding?"rtpmap:%d %s/%s/%s":e.rate?"rtpmap:%d %s/%s":"rtpmap:%d %s"}},{push:"fmtp",reg:/^fmtp:(\d*) ([\S| ]*)/,names:["payload","config"],format:"fmtp:%d %s"},{name:"control",reg:/^control:(.*)/,format:"control:%s"},{name:"rtcp",reg:/^rtcp:(\d*)(?: (\S*) IP(\d) (\S*))?/,names:["port","netType","ipVer","address"],format:function(e){return null!=e.address?"rtcp:%d %s IP%d %s":"rtcp:%d"}},{push:"rtcpFbTrrInt",reg:/^rtcp-fb:(\*|\d*) trr-int (\d*)/,names:["payload","value"],format:"rtcp-fb:%d trr-int %d"},{push:"rtcpFb",reg:/^rtcp-fb:(\*|\d*) ([\w-_]*)(?: ([\w-_]*))?/,names:["payload","type","subtype"],format:function(e){return null!=e.subtype?"rtcp-fb:%s %s %s":"rtcp-fb:%s %s"}},{push:"ext",reg:/^extmap:(\d+)(?:\/(\w+))? (\S*)(?: (\S*))?/,names:["value","direction","uri","config"],format:function(e){return"extmap:%d"+(e.direction?"/%s":"%v")+" %s"+(e.config?" %s":"")}},{push:"crypto",reg:/^crypto:(\d*) ([\w_]*) (\S*)(?: (\S*))?/,names:["id","suite","config","sessionConfig"],format:function(e){return null!=e.sessionConfig?"crypto:%d %s %s %s":"crypto:%d %s %s"}},{name:"setup",reg:/^setup:(\w*)/,format:"setup:%s"},{name:"mid",reg:/^mid:([^\s]*)/,format:"mid:%s"},{name:"msid",reg:/^msid:(.*)/,format:"msid:%s"},{name:"ptime",reg:/^ptime:(\d*)/,format:"ptime:%d"},{name:"maxptime",reg:/^maxptime:(\d*)/,format:"maxptime:%d"},{name:"direction",reg:/^(sendrecv|recvonly|sendonly|inactive)/},{name:"icelite",reg:/^(ice-lite)/},{name:"iceUfrag",reg:/^ice-ufrag:(\S*)/,format:"ice-ufrag:%s"},{name:"icePwd",reg:/^ice-pwd:(\S*)/,format:"ice-pwd:%s"},{name:"fingerprint",reg:/^fingerprint:(\S*) (\S*)/,names:["type","hash"],format:"fingerprint:%s %s"},{push:"candidates",reg:/^candidate:(\S*) (\d*) (\S*) (\d*) (\S*) (\d*) typ (\S*)(?: raddr (\S*) rport (\d*))?(?: tcptype (\S*))?(?: generation (\d*))?(?: network-id (\d*))?(?: network-cost (\d*))?/,names:["foundation","component","transport","priority","ip","port","type","raddr","rport","tcptype","generation","network-id","network-cost"],format:function(e){var t="candidate:%s %d %s %d %s %d typ %s";return t+=null!=e.raddr?" raddr %s rport %d":"%v%v",t+=null!=e.tcptype?" tcptype %s":"%v",null!=e.generation&&(t+=" generation %d"),t+=null!=e["network-id"]?" network-id %d":"%v",t+=null!=e["network-cost"]?" network-cost %d":"%v"}},{name:"endOfCandidates",reg:/^(end-of-candidates)/},{name:"remoteCandidates",reg:/^remote-candidates:(.*)/,format:"remote-candidates:%s"},{name:"iceOptions",reg:/^ice-options:(\S*)/,format:"ice-options:%s"},{push:"ssrcs",reg:/^ssrc:(\d*) ([\w_-]*)(?::(.*))?/,names:["id","attribute","value"],format:function(e){var t="ssrc:%d";return null!=e.attribute&&(t+=" %s",null!=e.value&&(t+=":%s")),t}},{push:"ssrcGroups",reg:/^ssrc-group:([\x21\x23\x24\x25\x26\x27\x2A\x2B\x2D\x2E\w]*) (.*)/,names:["semantics","ssrcs"],format:"ssrc-group:%s %s"},{name:"msidSemantic",reg:/^msid-semantic:\s?(\w*) (\S*)/,names:["semantic","token"],format:"msid-semantic: %s %s"},{push:"groups",reg:/^group:(\w*) (.*)/,names:["type","mids"],format:"group:%s %s"},{name:"rtcpMux",reg:/^(rtcp-mux)/},{name:"rtcpRsize",reg:/^(rtcp-rsize)/},{name:"sctpmap",reg:/^sctpmap:([\w_\/]*) (\S*)(?: (\S*))?/,names:["sctpmapNumber","app","maxMessageSize"],format:function(e){return null!=e.maxMessageSize?"sctpmap:%s %s %s":"sctpmap:%s %s"}},{name:"xGoogleFlag",reg:/^x-google-flag:([^\s]*)/,format:"x-google-flag:%s"},{push:"rids",reg:/^rid:([\d\w]+) (\w+)(?: ([\S| ]*))?/,names:["id","direction","params"],format:function(e){return e.params?"rid:%s %s %s":"rid:%s %s"}},{push:"imageattrs",reg:new RegExp("^imageattr:(\\d+|\\*)[\\s\\t]+(send|recv)[\\s\\t]+(\\*|\\[\\S+\\](?:[\\s\\t]+\\[\\S+\\])*)(?:[\\s\\t]+(recv|send)[\\s\\t]+(\\*|\\[\\S+\\](?:[\\s\\t]+\\[\\S+\\])*))?"),names:["pt","dir1","attrs1","dir2","attrs2"],format:function(e){return"imageattr:%s %s %s"+(e.dir2?" %s %s":"")}},{name:"simulcast",reg:new RegExp("^simulcast:(send|recv) ([a-zA-Z0-9\\-_~;,]+)(?:\\s?(send|recv) ([a-zA-Z0-9\\-_~;,]+))?$"),names:["dir1","list1","dir2","list2"],format:function(e){return"simulcast:%s %s"+(e.dir2?" %s %s":"")}},{name:"simulcast_03",reg:/^simulcast:[\s\t]+([\S+\s\t]+)$/,names:["value"],format:"simulcast: %s"},{name:"framerate",reg:/^framerate:(\d+(?:$|\.\d+))/,format:"framerate:%s"},{name:"sourceFilter",reg:/^source-filter: *(excl|incl) (\S*) (IP4|IP6|\*) (\S*) (.*)/,names:["filterMode","netType","addressTypes","destAddress","srcList"],format:"source-filter: %s %s %s %s %s"},{name:"bundleOnly",reg:/^(bundle-only)/},{name:"label",reg:/^label:(.+)/,format:"label:%s"},{name:"sctpPort",reg:/^sctp-port:(\d+)$/,format:"sctp-port:%s"},{name:"maxMessageSize",reg:/^max-message-size:(\d+)$/,format:"max-message-size:%s"},{push:"invalid",names:["value"]}]};Object.keys(n).forEach(function(e){n[e].forEach(function(e){e.reg||(e.reg=/(.*)/),e.format||(e.format="%s")})})},function(e,t,n){var r,i,o,s,a,c,l;e.exports=(r=n(4),o=(i=r).lib,s=o.Base,a=i.enc,c=a.Utf8,l=i.algo,void(l.HMAC=s.extend({init:function(e,t){e=this._hasher=new e.init,"string"==typeof t&&(t=c.parse(t));var n=e.blockSize,r=4*n;t.sigBytes>r&&(t=e.finalize(t)),t.clamp();for(var i=this._oKey=t.clone(),o=this._iKey=t.clone(),s=i.words,a=o.words,l=0;l<n;l++)s[l]^=1549556828,a[l]^=909522486;i.sigBytes=o.sigBytes=r,this.reset()},reset:function(){var e=this._hasher;e.reset(),e.update(this._iKey)},update:function(e){return this._hasher.update(e),this},finalize:function(e){var t=this._hasher,n=t.finalize(e);t.reset();var r=t.finalize(this._oKey.clone().concat(n));return r}})))},function(e,t,n){"use strict";var r=n(1),i=n(5),o=n(2).SDPTransform,s=n(2).RTCPeerConnection,a=n(2).RTCSessionDescription,c=n(2).RTCIceCandidate,l=n(2).MediaStream;function u(e,t,n){if(!n)return e.replace(/b=AS:.*\r\n/,"").replace(/b=TIAS:.*\r\n/,"");for(var r=e.split("\n"),o=-1,s=i.getVersionFirefox()?"TIAS":"AS",a=i.getVersionFirefox()?1024*n:n,c=0;c<r.length;c++)if(0===r[c].indexOf("m="+t)){o=c;break}if(-1===o)return e;for(o++;0===r[o].indexOf("i=")||0===r[o].indexOf("c=");)o++;if(0===r[o].indexOf("b"))return r[o]="b="+s+":"+a,r.join("\n");var l=r.slice(0,o);return l.push("b="+s+":"+a),(l=l.concat(r.slice(o,r.length))).join("\n")}s.State={NEW:1,CONNECTING:2,CHECKING:3,CONNECTED:4,DISCONNECTED:5,FAILED:6,CLOSED:7,COMPLETED:8},s.prototype._init=function(e,t,n,r){i.trace("RTCPeerConnection init. userID: "+t+", sessionID: "+n+", type: "+r),this.delegate=e,this.sessionID=n,this.userID=t,this.type=r,this.remoteSDP=null,this.state=s.State.NEW,this.onicecandidate=this.onIceCandidateCallback.bind(this),this.onsignalingstatechange=this.onSignalingStateCallback.bind(this),this.oniceconnectionstatechange=this.onIceConnectionStateCallback.bind(this),i.getVersionSafari()>=11?(this.remoteStream=new l,this.ontrack=this.onAddRemoteMediaCallback.bind(this),this.onStatusClosedChecker=void 0):(this.remoteStream=null,this.onaddstream=this.onAddRemoteMediaCallback.bind(this)),this.dialingTimer=null,this.answerTimeInterval=0,this.statsReportTimer=null,this.iceCandidates=[]},s.prototype.release=function(){this._clearDialingTimer(),this._clearStatsReportTimer(),"closed"!==this.connectionState&&this.close(),i.getVersionSafari()>=11&&this.onIceConnectionStateCallback()},s.prototype.updateRemoteSDP=function(e){if(!e)throw new Error("sdp string can't be empty.");this.remoteSDP=e},s.prototype.getRemoteSDP=function(){return this.remoteSDP},s.prototype.setRemoteSessionDescription=function(e,t,n){var r=new a({sdp:t,type:e}),o=i.getVersionFirefox();null===o||56!==o&&57!==o||this.delegate.bandwidth?r.sdp=u(r.sdp,"video",this.delegate.bandwidth):r.sdp=u(r.sdp,"video",12288),this.setRemoteDescription(r).then(function(e){n(null)},function(e){n(e)})},s.prototype.addLocalStream=function(e){if(!e)throw new Error("'RTCPeerConnection.addStream' error: stream is 'null'.");this.addStream(e)},s.prototype.getAndSetLocalSessionDescription=function(e,t){var n=this;function r(r){var s,c,l=i.getVersionFirefox();null!==l&&l<55&&2===e&&"offer"===n.type&&(r.sdp=(s=r.sdp,(c=o.parse(s)).groups=c.groups?c.groups:[],c.groups.push({mids:"sdparta_0",type:"BUNDLE"}),o.write(c))),n.setLocalDescription(r).then(function(){t(null)}).catch(function(e){a(e)})}function a(e){t(e)}n.state=s.State.CONNECTING,"offer"===n.type?n.createOffer().then(function(e){e.sdp=u(e.sdp,"video",n.delegate.bandwidth),r(e)}).catch(function(e){a(e)}):n.createAnswer().then(function(e){e.sdp=u(e.sdp,"video",n.delegate.bandwidth),r(e)}).catch(function(e){a(e)})},s.prototype.addCandidates=function(e){for(var t,n=0,r=e.length;n<r;n++)t={sdpMLineIndex:e[n].sdpMLineIndex,sdpMid:e[n].sdpMid,candidate:e[n].candidate},this.addIceCandidate(new c(t),function(){},function(e){i.traceError("Error on 'addIceCandidate': "+e)})},s.prototype.toString=function(){return"sessionID: "+this.sessionID+", userID:  "+this.userID+", type: "+this.type+", state: "+this.state},s.prototype.onSignalingStateCallback=function(){"stable"===this.signalingState&&this.iceCandidates.length>0&&(this.delegate.processIceCandidates(this,this.iceCandidates),this.iceCandidates.length=0)},s.prototype.onIceCandidateCallback=function(e){var t=e.candidate;if(t){var n={sdpMLineIndex:t.sdpMLineIndex,sdpMid:t.sdpMid,candidate:t.candidate};"stable"===this.signalingState?this.delegate.processIceCandidates(this,[n]):this.iceCandidates.push(n)}},s.prototype.onAddRemoteMediaCallback=function(e){"function"==typeof this.delegate._onRemoteStreamListener&&("addstream"===e.type?this.remoteStream=e.stream:this.remoteStream.addTrack(e.track),(1==this.delegate.callType&&this.remoteStream.getVideoTracks().length||2==this.delegate.callType&&this.remoteStream.getAudioTracks().length)&&this.delegate._onRemoteStreamListener(this.userID,this.remoteStream),this._getStatsWrap())},s.prototype.onIceConnectionStateCallback=function(){i.trace("onIceConnectionStateCallback: "+this.iceConnectionState);var e=this;if("function"==typeof this.delegate._onSessionConnectionStateChangedListener){var t=null;switch(i.getVersionSafari()>=11&&clearTimeout(this.onStatusClosedChecker),this.iceConnectionState){case"checking":this.state=s.State.CHECKING,t=i.SessionConnectionState.CONNECTING;break;case"connected":this._clearWaitingReconnectTimer(),this.state=s.State.CONNECTED,t=i.SessionConnectionState.CONNECTED;break;case"completed":this._clearWaitingReconnectTimer(),this.state=s.State.COMPLETED,t=i.SessionConnectionState.COMPLETED;break;case"failed":this.state=s.State.FAILED,t=i.SessionConnectionState.FAILED;break;case"disconnected":this._startWaitingReconnectTimer(),this.state=s.State.DISCONNECTED,t=i.SessionConnectionState.DISCONNECTED,i.getVersionSafari()>=11&&(this.onStatusClosedChecker=setTimeout(function(){e.onIceConnectionStateCallback()},500));break;case"closed":this._clearWaitingReconnectTimer(),this.state=s.State.CLOSED,t=i.SessionConnectionState.CLOSED}t&&e.delegate._onSessionConnectionStateChangedListener(this.userID,t)}},s.prototype._clearStatsReportTimer=function(){this.statsReportTimer&&(clearInterval(this.statsReportTimer),this.statsReportTimer=null)},s.prototype._getStatsWrap=function(){var e,t,n=this;if(r.videochat&&r.videochat.statsReportTimeInterval){if(isNaN(+r.videochat.statsReportTimeInterval))return void i.traceError("statsReportTimeInterval ("+r.videochat.statsReportTimeInterval+") must be integer.");e=1e3*r.videochat.statsReportTimeInterval;i.trace("Stats tracker has been started."),n.statsReportTimer=setInterval(function(){!function(e,t,n,r){var o={local:{audio:{},video:{},candidate:{}},remote:{audio:{},video:{},candidate:{}}};if(i.getVersionFirefox()){var s=e.getLocalStreams().length?e.getLocalStreams()[0]:e.delegate.localStream,a=s.getVideoTracks().length?s.getVideoTracks()[0].getSettings():null;o.local.video.frameHeight=a&&a.height,o.local.video.frameWidth=a&&a.width}function c(e,t,n){var r,i=t&&t.get(e.id),o=i?(e.timestamp-i.timestamp)/1e3:5;return r=i?n?8*(e.bytesSent-i.bytesSent)/(1024*o):8*(e.bytesReceived-i.bytesReceived)/(1024*o):0,Math.round(r)}function l(e,t,n){var r,i=t&&t.get(e.id),o=i?(e.timestamp-i.timestamp)/1e3:5;return r=i?n?(e.framesSent-i.framesSent)/o:(e.framesReceived-i.framesReceived)/o:0,Math.round(10*r)/10}e.getStats(null).then(function(e){e.forEach(function(e){var n;e.bytesReceived&&"inbound-rtp"===e.type?((n=o.remote[e.mediaType]).bitrate=c(e,t,!1),n.bytesReceived=e.bytesReceived,n.packetsReceived=e.packetsReceived,n.timestamp=e.timestamp,"video"===e.mediaType&&e.framerateMean&&(n.framesPerSecond=Math.round(10*e.framerateMean)/10)):e.bytesSent&&"outbound-rtp"===e.type?((n=o.local[e.mediaType]).bitrate=c(e,t,!0),n.bytesSent=e.bytesSent,n.packetsSent=e.packetsSent,n.timestamp=e.timestamp,"video"===e.mediaType&&e.framerateMean&&(n.framesPerSecond=Math.round(10*e.framerateMean)/10)):"local-candidate"===e.type?(n=o.local.candidate,"host"===e.candidateType&&"udp"===e.mozLocalTransport&&"udp"===e.transport?(n.protocol=e.transport,n.ip=e.ipAddress,n.port=e.portNumber):i.getVersionFirefox()||(n.protocol=e.protocol,n.ip=e.ip,n.port=e.port)):"remote-candidate"===e.type?((n=o.remote.candidate).protocol=e.protocol||e.transport,n.ip=e.ip||e.ipAddress,n.port=e.port||e.portNumber):"track"!==e.type||"video"!==e.kind||i.getVersionFirefox()||(e.remoteSource?((n=o.remote.video).frameHeight=e.frameHeight,n.frameWidth=e.frameWidth,n.framesPerSecond=l(e,t,!1)):((n=o.local.video).frameHeight=e.frameHeight,n.frameWidth=e.frameWidth,n.framesPerSecond=l(e,t,!0)))}),n(o,e)},r)}(n,t,function(e,r){t=r,n.delegate._onCallStatsReport(n.userID,e,null)},function(e){i.traceError("_getStats error. "+e.name+": "+e.message),n.delegate._onCallStatsReport(n.userID,null,e)})},e)}},s.prototype._clearWaitingReconnectTimer=function(){this.waitingReconnectTimeoutCallback&&(i.trace("_clearWaitingReconnectTimer"),clearTimeout(this.waitingReconnectTimeoutCallback),this.waitingReconnectTimeoutCallback=null)},s.prototype._startWaitingReconnectTimer=function(){var e=this,t=1e3*r.videochat.disconnectTimeInterval;i.trace("_startWaitingReconnectTimer, timeout: "+t),e.waitingReconnectTimeoutCallback=setTimeout(function(){i.trace("waitingReconnectTimeoutCallback"),clearTimeout(e.waitingReconnectTimeoutCallback),e.release(),e.delegate._closeSessionIfAllConnectionsClosed()},t)},s.prototype._clearDialingTimer=function(){this.dialingTimer&&(i.trace("_clearDialingTimer"),clearInterval(this.dialingTimer),this.dialingTimer=null,this.answerTimeInterval=0)},s.prototype._startDialingTimer=function(e,t){var n=this,o=1e3*r.videochat.dialingTimeInterval;i.trace("_startDialingTimer, dialingTimeInterval: "+o);var s=function(e,t,o){o||(n.answerTimeInterval+=1e3*r.videochat.dialingTimeInterval),i.trace("_dialingCallback, answerTimeInterval: "+n.answerTimeInterval),n.answerTimeInterval>=1e3*r.videochat.answerTimeInterval?(n._clearDialingTimer(),t&&n.delegate.processOnNotAnswer(n)):n.delegate.processCall(n,e)};n.dialingTimer=setInterval(s,o,e,t,!1),s(e,t,!0)},e.exports=s},function(e,t,n){"use strict";var r=function(e){function t(n,r,i){!function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,t),e.call(this,n),this.listener=r,this.context=i}return function(e,t){if("function"!=typeof t&&null!==t)throw new TypeError("Super expression must either be null or a function, not "+typeof t);e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,enumerable:!1,writable:!0,configurable:!0}}),t&&(Object.setPrototypeOf?Object.setPrototypeOf(e,t):e.__proto__=t)}(t,e),t}(n(55));e.exports=r},function(e,t,n){"use strict";var r=function(e){};e.exports=function(e,t,n,i,o,s,a,c){if(r(t),!e){var l;if(void 0===t)l=new Error("Minified exception occurred; use the non-minified dev environment for the full error message and additional helpful warnings.");else{var u=[n,i,o,s,a,c],d=0;(l=new Error(t.replace(/%s/g,function(){return u[d++]}))).name="Invariant Violation"}throw l.framesToPop=1,l}}},function(e,t,n){function r(e){return(r="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e})(e)}var i=n(1);function o(){}o.prototype={version:i.version,init:function(e,t){t&&"object"===r(t)&&i.set(t);var o=n(15),s=n(29),a=n(34),c=n(35),l=n(36),u=n(37),d=n(38),h=n(39),f=n(45),p=n(46),m=n(8);if(this.service=new o,this.auth=new s(this.service),this.users=new a(this.service),this.storage=new c(this.service),this.pushnotifications=new l(this.service),this.data=new u(this.service),this.addressbook=new d(this.service),this.chat=new h(this.service),this.chat.dialog=new f(this.service),this.chat.message=new p(this.service),this.utils=m,m.isWebRTCAvailble()){var g=n(47);this.videochat=new g(this.service,this.chat.xmppClient),this.chat.webrtcSignalingProcessor=this.videochat.signalingProcessor,this.videochatconference=n(51)}else this.videochat=!1,this.videochatconference=!1;e.token?(i.creds.appId=e.appId,this.service.setSession({token:e.token})):(i.creds.appId=e.appId,i.creds.authKey=e.authKey,i.creds.authSecret=e.authSecret)},getSession:function(e){this.auth.getSession(e)},createSession:function(e,t){this.auth.createSession(e,t)},destroySession:function(e){this.auth.destroySession(e)},createWebSession:function(e,t){this.auth.createWebSession(e,t)},checkWebSessionUntilUpgrade:function(e){return this.auth.checkWebSessionUntilUpgrade(e)},upgradeWebSession:function(e,t){this.auth.upgradeWebSession(e,t)},login:function(e,t){this.auth.login(e,t)},logout:function(e){this.auth.logout(e)}};var s=new o;s.ConnectyCube=o,e.exports=s},function(e,t,n){var r=n(1),i=n(0),o=n(2).fetchImpl,s=n(2).formDataImpl;function a(){this.sdkInstance={config:r,session:null},this.currentUserId=null,this.reqCount=0}a.prototype={setSession:function(e){this.sdkInstance.session=e},getSession:function(){return this.sdkInstance.session},setCurrentUserId:function(e){this.currentUserId=e},getCurrentUserId:function(){return this.currentUserId},handleResponse:function(e,t,n,o){i.isExpiredSessionError(e)&&"function"==typeof r.on.sessionExpired?r.on.sessionExpired(function(){n(e,t)},o):e?n(e,null):n(null,t)},logRequest:function(e){var t;++this.reqCount,e.data&&e.data.file?(t=JSON.parse(JSON.stringify(e.data))).file="...":t=i.getEnv().nativescript?JSON.stringify(e.data):e.data,i.DLog("[Request]["+this.reqCount+"]",(e.type||"GET")+" "+e.url,t||"")},ajax:function(e,t){this.logRequest(e);var n,a,c=this,l=!e.type||"GET"===e.type||"HEAD"===e.type,u=c.sdkInstance&&c.sdkInstance.session&&c.sdkInstance.session.token,d=-1===e.url.indexOf("s3.amazonaws.com"),h=!1===e.contentType,f=e.dataType||"json",p=e.url,m={};function g(e){return encodeURIComponent(e).replace(/[#$&+,\/:;=?@\[\]]/g,function(e){return"%"+e.charCodeAt(0).toString(16)})}function v(n,o,s){var a,l,u=o&&(o.status||o.statusCode);if(n||200!==u&&201!==u&&202!==u){var d;try{d={code:o&&u||n&&n.code,status:o&&o.headers&&o.headers.status||"error",message:s||n&&n.errno,detail:s&&s.errors||n&&n.syscall}}catch(e){d=n}l=s||n||s.errors,a=i.getEnv().nativescript?JSON.stringify(l):l,i.DLog("[Response]["+c.reqCount+"]","error",u,a),-1===e.url.indexOf(r.urls.session)?c.handleResponse(d,null,t,b):t(d,null)}else l=s&&" "!==s?s:"empty body",a=i.getEnv().nativescript?JSON.stringify(l):l,i.DLog("[Response]["+c.reqCount+"]",a),-1===e.url.indexOf(r.urls.session)?c.handleResponse(null,s,t,b):t(null,s)}function b(n){n&&(c.setSession(n),c.ajax(e,t))}m.method=e.type||"GET",e.data&&(n=function(){var t,n=e.data;h?(t=new s,Object.keys(n).forEach(function(r){e.fileToCustomObject&&"file"===r?t.append(r,n[r].data,n[r].name):t.append(r,e.data[r])})):t=e.isNeedStringify?JSON.stringify(n):Object.keys(n).map(function(e){return i.isObject(n[e])?Object.keys(n[e]).map(function(t){return g(e)+"["+(i.isArray(n[e])?"":t)+"]="+g(n[e][t])}).sort().join("&"):g(e)+(i.isArray(n[e])?"[]":"")+"="+g(n[e])}).sort().join("&");return t}(),l?p+="?"+n:m.body=n),h||(m.headers={"Content-Type":e.contentType||"application/x-www-form-urlencoded; charset=UTF-8"}),d&&(m.headers||(m.headers={}),m.headers["CB-SDK"]="JS "+r.version+" - Client",u&&(m.headers["CB-Token"]=u)),r.timeout&&(m.timeout=r.timeout),o(p,m).then(function(e){return a=e,"text"===f?e.text():e.json()},function(){return a={status:200}," "}).then(function(e){v(null,a,e)},function(e){v(e)})}},e.exports=a},function(e,t,n){"use strict";(function(e){
/*!
 * The buffer module from node.js, for the browser.
 *
 * @author   Feross Aboukhadijeh <feross@feross.org> <http://feross.org>
 * @license  MIT
 */
var r=n(17),i=n(18),o=n(19);function s(){return c.TYPED_ARRAY_SUPPORT?2147483647:1073741823}function a(e,t){if(s()<t)throw new RangeError("Invalid typed array length");return c.TYPED_ARRAY_SUPPORT?(e=new Uint8Array(t)).__proto__=c.prototype:(null===e&&(e=new c(t)),e.length=t),e}function c(e,t,n){if(!(c.TYPED_ARRAY_SUPPORT||this instanceof c))return new c(e,t,n);if("number"==typeof e){if("string"==typeof t)throw new Error("If encoding is specified then the first argument must be a string");return d(this,e)}return l(this,e,t,n)}function l(e,t,n,r){if("number"==typeof t)throw new TypeError('"value" argument must not be a number');return"undefined"!=typeof ArrayBuffer&&t instanceof ArrayBuffer?function(e,t,n,r){if(t.byteLength,n<0||t.byteLength<n)throw new RangeError("'offset' is out of bounds");if(t.byteLength<n+(r||0))throw new RangeError("'length' is out of bounds");t=void 0===n&&void 0===r?new Uint8Array(t):void 0===r?new Uint8Array(t,n):new Uint8Array(t,n,r);c.TYPED_ARRAY_SUPPORT?(e=t).__proto__=c.prototype:e=h(e,t);return e}(e,t,n,r):"string"==typeof t?function(e,t,n){"string"==typeof n&&""!==n||(n="utf8");if(!c.isEncoding(n))throw new TypeError('"encoding" must be a valid string encoding');var r=0|p(t,n),i=(e=a(e,r)).write(t,n);i!==r&&(e=e.slice(0,i));return e}(e,t,n):function(e,t){if(c.isBuffer(t)){var n=0|f(t.length);return 0===(e=a(e,n)).length?e:(t.copy(e,0,0,n),e)}if(t){if("undefined"!=typeof ArrayBuffer&&t.buffer instanceof ArrayBuffer||"length"in t)return"number"!=typeof t.length||(r=t.length)!=r?a(e,0):h(e,t);if("Buffer"===t.type&&o(t.data))return h(e,t.data)}var r;throw new TypeError("First argument must be a string, Buffer, ArrayBuffer, Array, or array-like object.")}(e,t)}function u(e){if("number"!=typeof e)throw new TypeError('"size" argument must be a number');if(e<0)throw new RangeError('"size" argument must not be negative')}function d(e,t){if(u(t),e=a(e,t<0?0:0|f(t)),!c.TYPED_ARRAY_SUPPORT)for(var n=0;n<t;++n)e[n]=0;return e}function h(e,t){var n=t.length<0?0:0|f(t.length);e=a(e,n);for(var r=0;r<n;r+=1)e[r]=255&t[r];return e}function f(e){if(e>=s())throw new RangeError("Attempt to allocate Buffer larger than maximum size: 0x"+s().toString(16)+" bytes");return 0|e}function p(e,t){if(c.isBuffer(e))return e.length;if("undefined"!=typeof ArrayBuffer&&"function"==typeof ArrayBuffer.isView&&(ArrayBuffer.isView(e)||e instanceof ArrayBuffer))return e.byteLength;"string"!=typeof e&&(e=""+e);var n=e.length;if(0===n)return 0;for(var r=!1;;)switch(t){case"ascii":case"latin1":case"binary":return n;case"utf8":case"utf-8":case void 0:return F(e).length;case"ucs2":case"ucs-2":case"utf16le":case"utf-16le":return 2*n;case"hex":return n>>>1;case"base64":return H(e).length;default:if(r)return F(e).length;t=(""+t).toLowerCase(),r=!0}}function m(e,t,n){var r=e[t];e[t]=e[n],e[n]=r}function g(e,t,n,r,i){if(0===e.length)return-1;if("string"==typeof n?(r=n,n=0):n>2147483647?n=2147483647:n<-2147483648&&(n=-2147483648),n=+n,isNaN(n)&&(n=i?0:e.length-1),n<0&&(n=e.length+n),n>=e.length){if(i)return-1;n=e.length-1}else if(n<0){if(!i)return-1;n=0}if("string"==typeof t&&(t=c.from(t,r)),c.isBuffer(t))return 0===t.length?-1:v(e,t,n,r,i);if("number"==typeof t)return t&=255,c.TYPED_ARRAY_SUPPORT&&"function"==typeof Uint8Array.prototype.indexOf?i?Uint8Array.prototype.indexOf.call(e,t,n):Uint8Array.prototype.lastIndexOf.call(e,t,n):v(e,[t],n,r,i);throw new TypeError("val must be string, number or Buffer")}function v(e,t,n,r,i){var o,s=1,a=e.length,c=t.length;if(void 0!==r&&("ucs2"===(r=String(r).toLowerCase())||"ucs-2"===r||"utf16le"===r||"utf-16le"===r)){if(e.length<2||t.length<2)return-1;s=2,a/=2,c/=2,n/=2}function l(e,t){return 1===s?e[t]:e.readUInt16BE(t*s)}if(i){var u=-1;for(o=n;o<a;o++)if(l(e,o)===l(t,-1===u?0:o-u)){if(-1===u&&(u=o),o-u+1===c)return u*s}else-1!==u&&(o-=o-u),u=-1}else for(n+c>a&&(n=a-c),o=n;o>=0;o--){for(var d=!0,h=0;h<c;h++)if(l(e,o+h)!==l(t,h)){d=!1;break}if(d)return o}return-1}function b(e,t,n,r){n=Number(n)||0;var i=e.length-n;r?(r=Number(r))>i&&(r=i):r=i;var o=t.length;if(o%2!=0)throw new TypeError("Invalid hex string");r>o/2&&(r=o/2);for(var s=0;s<r;++s){var a=parseInt(t.substr(2*s,2),16);if(isNaN(a))return s;e[n+s]=a}return s}function y(e,t,n,r){return B(F(t,e.length-n),e,n,r)}function S(e,t,n,r){return B(function(e){for(var t=[],n=0;n<e.length;++n)t.push(255&e.charCodeAt(n));return t}(t),e,n,r)}function C(e,t,n,r){return S(e,t,n,r)}function _(e,t,n,r){return B(H(t),e,n,r)}function w(e,t,n,r){return B(function(e,t){for(var n,r,i,o=[],s=0;s<e.length&&!((t-=2)<0);++s)n=e.charCodeAt(s),r=n>>8,i=n%256,o.push(i),o.push(r);return o}(t,e.length-n),e,n,r)}function T(e,t,n){return 0===t&&n===e.length?r.fromByteArray(e):r.fromByteArray(e.slice(t,n))}function x(e,t,n){n=Math.min(e.length,n);for(var r=[],i=t;i<n;){var o,s,a,c,l=e[i],u=null,d=l>239?4:l>223?3:l>191?2:1;if(i+d<=n)switch(d){case 1:l<128&&(u=l);break;case 2:128==(192&(o=e[i+1]))&&(c=(31&l)<<6|63&o)>127&&(u=c);break;case 3:o=e[i+1],s=e[i+2],128==(192&o)&&128==(192&s)&&(c=(15&l)<<12|(63&o)<<6|63&s)>2047&&(c<55296||c>57343)&&(u=c);break;case 4:o=e[i+1],s=e[i+2],a=e[i+3],128==(192&o)&&128==(192&s)&&128==(192&a)&&(c=(15&l)<<18|(63&o)<<12|(63&s)<<6|63&a)>65535&&c<1114112&&(u=c)}null===u?(u=65533,d=1):u>65535&&(u-=65536,r.push(u>>>10&1023|55296),u=56320|1023&u),r.push(u),i+=d}return function(e){var t=e.length;if(t<=I)return String.fromCharCode.apply(String,e);var n="",r=0;for(;r<t;)n+=String.fromCharCode.apply(String,e.slice(r,r+=I));return n}(r)}t.Buffer=c,t.SlowBuffer=function(e){+e!=e&&(e=0);return c.alloc(+e)},t.INSPECT_MAX_BYTES=50,c.TYPED_ARRAY_SUPPORT=void 0!==e.TYPED_ARRAY_SUPPORT?e.TYPED_ARRAY_SUPPORT:function(){try{var e=new Uint8Array(1);return e.__proto__={__proto__:Uint8Array.prototype,foo:function(){return 42}},42===e.foo()&&"function"==typeof e.subarray&&0===e.subarray(1,1).byteLength}catch(e){return!1}}(),t.kMaxLength=s(),c.poolSize=8192,c._augment=function(e){return e.__proto__=c.prototype,e},c.from=function(e,t,n){return l(null,e,t,n)},c.TYPED_ARRAY_SUPPORT&&(c.prototype.__proto__=Uint8Array.prototype,c.__proto__=Uint8Array,"undefined"!=typeof Symbol&&Symbol.species&&c[Symbol.species]===c&&Object.defineProperty(c,Symbol.species,{value:null,configurable:!0})),c.alloc=function(e,t,n){return function(e,t,n,r){return u(t),t<=0?a(e,t):void 0!==n?"string"==typeof r?a(e,t).fill(n,r):a(e,t).fill(n):a(e,t)}(null,e,t,n)},c.allocUnsafe=function(e){return d(null,e)},c.allocUnsafeSlow=function(e){return d(null,e)},c.isBuffer=function(e){return!(null==e||!e._isBuffer)},c.compare=function(e,t){if(!c.isBuffer(e)||!c.isBuffer(t))throw new TypeError("Arguments must be Buffers");if(e===t)return 0;for(var n=e.length,r=t.length,i=0,o=Math.min(n,r);i<o;++i)if(e[i]!==t[i]){n=e[i],r=t[i];break}return n<r?-1:r<n?1:0},c.isEncoding=function(e){switch(String(e).toLowerCase()){case"hex":case"utf8":case"utf-8":case"ascii":case"latin1":case"binary":case"base64":case"ucs2":case"ucs-2":case"utf16le":case"utf-16le":return!0;default:return!1}},c.concat=function(e,t){if(!o(e))throw new TypeError('"list" argument must be an Array of Buffers');if(0===e.length)return c.alloc(0);var n;if(void 0===t)for(t=0,n=0;n<e.length;++n)t+=e[n].length;var r=c.allocUnsafe(t),i=0;for(n=0;n<e.length;++n){var s=e[n];if(!c.isBuffer(s))throw new TypeError('"list" argument must be an Array of Buffers');s.copy(r,i),i+=s.length}return r},c.byteLength=p,c.prototype._isBuffer=!0,c.prototype.swap16=function(){var e=this.length;if(e%2!=0)throw new RangeError("Buffer size must be a multiple of 16-bits");for(var t=0;t<e;t+=2)m(this,t,t+1);return this},c.prototype.swap32=function(){var e=this.length;if(e%4!=0)throw new RangeError("Buffer size must be a multiple of 32-bits");for(var t=0;t<e;t+=4)m(this,t,t+3),m(this,t+1,t+2);return this},c.prototype.swap64=function(){var e=this.length;if(e%8!=0)throw new RangeError("Buffer size must be a multiple of 64-bits");for(var t=0;t<e;t+=8)m(this,t,t+7),m(this,t+1,t+6),m(this,t+2,t+5),m(this,t+3,t+4);return this},c.prototype.toString=function(){var e=0|this.length;return 0===e?"":0===arguments.length?x(this,0,e):function(e,t,n){var r=!1;if((void 0===t||t<0)&&(t=0),t>this.length)return"";if((void 0===n||n>this.length)&&(n=this.length),n<=0)return"";if((n>>>=0)<=(t>>>=0))return"";for(e||(e="utf8");;)switch(e){case"hex":return k(this,t,n);case"utf8":case"utf-8":return x(this,t,n);case"ascii":return E(this,t,n);case"latin1":case"binary":return A(this,t,n);case"base64":return T(this,t,n);case"ucs2":case"ucs-2":case"utf16le":case"utf-16le":return R(this,t,n);default:if(r)throw new TypeError("Unknown encoding: "+e);e=(e+"").toLowerCase(),r=!0}}.apply(this,arguments)},c.prototype.equals=function(e){if(!c.isBuffer(e))throw new TypeError("Argument must be a Buffer");return this===e||0===c.compare(this,e)},c.prototype.inspect=function(){var e="",n=t.INSPECT_MAX_BYTES;return this.length>0&&(e=this.toString("hex",0,n).match(/.{2}/g).join(" "),this.length>n&&(e+=" ... ")),"<Buffer "+e+">"},c.prototype.compare=function(e,t,n,r,i){if(!c.isBuffer(e))throw new TypeError("Argument must be a Buffer");if(void 0===t&&(t=0),void 0===n&&(n=e?e.length:0),void 0===r&&(r=0),void 0===i&&(i=this.length),t<0||n>e.length||r<0||i>this.length)throw new RangeError("out of range index");if(r>=i&&t>=n)return 0;if(r>=i)return-1;if(t>=n)return 1;if(this===e)return 0;for(var o=(i>>>=0)-(r>>>=0),s=(n>>>=0)-(t>>>=0),a=Math.min(o,s),l=this.slice(r,i),u=e.slice(t,n),d=0;d<a;++d)if(l[d]!==u[d]){o=l[d],s=u[d];break}return o<s?-1:s<o?1:0},c.prototype.includes=function(e,t,n){return-1!==this.indexOf(e,t,n)},c.prototype.indexOf=function(e,t,n){return g(this,e,t,n,!0)},c.prototype.lastIndexOf=function(e,t,n){return g(this,e,t,n,!1)},c.prototype.write=function(e,t,n,r){if(void 0===t)r="utf8",n=this.length,t=0;else if(void 0===n&&"string"==typeof t)r=t,n=this.length,t=0;else{if(!isFinite(t))throw new Error("Buffer.write(string, encoding, offset[, length]) is no longer supported");t|=0,isFinite(n)?(n|=0,void 0===r&&(r="utf8")):(r=n,n=void 0)}var i=this.length-t;if((void 0===n||n>i)&&(n=i),e.length>0&&(n<0||t<0)||t>this.length)throw new RangeError("Attempt to write outside buffer bounds");r||(r="utf8");for(var o=!1;;)switch(r){case"hex":return b(this,e,t,n);case"utf8":case"utf-8":return y(this,e,t,n);case"ascii":return S(this,e,t,n);case"latin1":case"binary":return C(this,e,t,n);case"base64":return _(this,e,t,n);case"ucs2":case"ucs-2":case"utf16le":case"utf-16le":return w(this,e,t,n);default:if(o)throw new TypeError("Unknown encoding: "+r);r=(""+r).toLowerCase(),o=!0}},c.prototype.toJSON=function(){return{type:"Buffer",data:Array.prototype.slice.call(this._arr||this,0)}};var I=4096;function E(e,t,n){var r="";n=Math.min(e.length,n);for(var i=t;i<n;++i)r+=String.fromCharCode(127&e[i]);return r}function A(e,t,n){var r="";n=Math.min(e.length,n);for(var i=t;i<n;++i)r+=String.fromCharCode(e[i]);return r}function k(e,t,n){var r=e.length;(!t||t<0)&&(t=0),(!n||n<0||n>r)&&(n=r);for(var i="",o=t;o<n;++o)i+=q(e[o]);return i}function R(e,t,n){for(var r=e.slice(t,n),i="",o=0;o<r.length;o+=2)i+=String.fromCharCode(r[o]+256*r[o+1]);return i}function D(e,t,n){if(e%1!=0||e<0)throw new RangeError("offset is not uint");if(e+t>n)throw new RangeError("Trying to access beyond buffer length")}function O(e,t,n,r,i,o){if(!c.isBuffer(e))throw new TypeError('"buffer" argument must be a Buffer instance');if(t>i||t<o)throw new RangeError('"value" argument is out of bounds');if(n+r>e.length)throw new RangeError("Index out of range")}function N(e,t,n,r){t<0&&(t=65535+t+1);for(var i=0,o=Math.min(e.length-n,2);i<o;++i)e[n+i]=(t&255<<8*(r?i:1-i))>>>8*(r?i:1-i)}function L(e,t,n,r){t<0&&(t=4294967295+t+1);for(var i=0,o=Math.min(e.length-n,4);i<o;++i)e[n+i]=t>>>8*(r?i:3-i)&255}function M(e,t,n,r,i,o){if(n+r>e.length)throw new RangeError("Index out of range");if(n<0)throw new RangeError("Index out of range")}function j(e,t,n,r,o){return o||M(e,0,n,4),i.write(e,t,n,r,23,4),n+4}function P(e,t,n,r,o){return o||M(e,0,n,8),i.write(e,t,n,r,52,8),n+8}c.prototype.slice=function(e,t){var n,r=this.length;if((e=~~e)<0?(e+=r)<0&&(e=0):e>r&&(e=r),(t=void 0===t?r:~~t)<0?(t+=r)<0&&(t=0):t>r&&(t=r),t<e&&(t=e),c.TYPED_ARRAY_SUPPORT)(n=this.subarray(e,t)).__proto__=c.prototype;else{var i=t-e;n=new c(i,void 0);for(var o=0;o<i;++o)n[o]=this[o+e]}return n},c.prototype.readUIntLE=function(e,t,n){e|=0,t|=0,n||D(e,t,this.length);for(var r=this[e],i=1,o=0;++o<t&&(i*=256);)r+=this[e+o]*i;return r},c.prototype.readUIntBE=function(e,t,n){e|=0,t|=0,n||D(e,t,this.length);for(var r=this[e+--t],i=1;t>0&&(i*=256);)r+=this[e+--t]*i;return r},c.prototype.readUInt8=function(e,t){return t||D(e,1,this.length),this[e]},c.prototype.readUInt16LE=function(e,t){return t||D(e,2,this.length),this[e]|this[e+1]<<8},c.prototype.readUInt16BE=function(e,t){return t||D(e,2,this.length),this[e]<<8|this[e+1]},c.prototype.readUInt32LE=function(e,t){return t||D(e,4,this.length),(this[e]|this[e+1]<<8|this[e+2]<<16)+16777216*this[e+3]},c.prototype.readUInt32BE=function(e,t){return t||D(e,4,this.length),16777216*this[e]+(this[e+1]<<16|this[e+2]<<8|this[e+3])},c.prototype.readIntLE=function(e,t,n){e|=0,t|=0,n||D(e,t,this.length);for(var r=this[e],i=1,o=0;++o<t&&(i*=256);)r+=this[e+o]*i;return r>=(i*=128)&&(r-=Math.pow(2,8*t)),r},c.prototype.readIntBE=function(e,t,n){e|=0,t|=0,n||D(e,t,this.length);for(var r=t,i=1,o=this[e+--r];r>0&&(i*=256);)o+=this[e+--r]*i;return o>=(i*=128)&&(o-=Math.pow(2,8*t)),o},c.prototype.readInt8=function(e,t){return t||D(e,1,this.length),128&this[e]?-1*(255-this[e]+1):this[e]},c.prototype.readInt16LE=function(e,t){t||D(e,2,this.length);var n=this[e]|this[e+1]<<8;return 32768&n?4294901760|n:n},c.prototype.readInt16BE=function(e,t){t||D(e,2,this.length);var n=this[e+1]|this[e]<<8;return 32768&n?4294901760|n:n},c.prototype.readInt32LE=function(e,t){return t||D(e,4,this.length),this[e]|this[e+1]<<8|this[e+2]<<16|this[e+3]<<24},c.prototype.readInt32BE=function(e,t){return t||D(e,4,this.length),this[e]<<24|this[e+1]<<16|this[e+2]<<8|this[e+3]},c.prototype.readFloatLE=function(e,t){return t||D(e,4,this.length),i.read(this,e,!0,23,4)},c.prototype.readFloatBE=function(e,t){return t||D(e,4,this.length),i.read(this,e,!1,23,4)},c.prototype.readDoubleLE=function(e,t){return t||D(e,8,this.length),i.read(this,e,!0,52,8)},c.prototype.readDoubleBE=function(e,t){return t||D(e,8,this.length),i.read(this,e,!1,52,8)},c.prototype.writeUIntLE=function(e,t,n,r){(e=+e,t|=0,n|=0,r)||O(this,e,t,n,Math.pow(2,8*n)-1,0);var i=1,o=0;for(this[t]=255&e;++o<n&&(i*=256);)this[t+o]=e/i&255;return t+n},c.prototype.writeUIntBE=function(e,t,n,r){(e=+e,t|=0,n|=0,r)||O(this,e,t,n,Math.pow(2,8*n)-1,0);var i=n-1,o=1;for(this[t+i]=255&e;--i>=0&&(o*=256);)this[t+i]=e/o&255;return t+n},c.prototype.writeUInt8=function(e,t,n){return e=+e,t|=0,n||O(this,e,t,1,255,0),c.TYPED_ARRAY_SUPPORT||(e=Math.floor(e)),this[t]=255&e,t+1},c.prototype.writeUInt16LE=function(e,t,n){return e=+e,t|=0,n||O(this,e,t,2,65535,0),c.TYPED_ARRAY_SUPPORT?(this[t]=255&e,this[t+1]=e>>>8):N(this,e,t,!0),t+2},c.prototype.writeUInt16BE=function(e,t,n){return e=+e,t|=0,n||O(this,e,t,2,65535,0),c.TYPED_ARRAY_SUPPORT?(this[t]=e>>>8,this[t+1]=255&e):N(this,e,t,!1),t+2},c.prototype.writeUInt32LE=function(e,t,n){return e=+e,t|=0,n||O(this,e,t,4,4294967295,0),c.TYPED_ARRAY_SUPPORT?(this[t+3]=e>>>24,this[t+2]=e>>>16,this[t+1]=e>>>8,this[t]=255&e):L(this,e,t,!0),t+4},c.prototype.writeUInt32BE=function(e,t,n){return e=+e,t|=0,n||O(this,e,t,4,4294967295,0),c.TYPED_ARRAY_SUPPORT?(this[t]=e>>>24,this[t+1]=e>>>16,this[t+2]=e>>>8,this[t+3]=255&e):L(this,e,t,!1),t+4},c.prototype.writeIntLE=function(e,t,n,r){if(e=+e,t|=0,!r){var i=Math.pow(2,8*n-1);O(this,e,t,n,i-1,-i)}var o=0,s=1,a=0;for(this[t]=255&e;++o<n&&(s*=256);)e<0&&0===a&&0!==this[t+o-1]&&(a=1),this[t+o]=(e/s>>0)-a&255;return t+n},c.prototype.writeIntBE=function(e,t,n,r){if(e=+e,t|=0,!r){var i=Math.pow(2,8*n-1);O(this,e,t,n,i-1,-i)}var o=n-1,s=1,a=0;for(this[t+o]=255&e;--o>=0&&(s*=256);)e<0&&0===a&&0!==this[t+o+1]&&(a=1),this[t+o]=(e/s>>0)-a&255;return t+n},c.prototype.writeInt8=function(e,t,n){return e=+e,t|=0,n||O(this,e,t,1,127,-128),c.TYPED_ARRAY_SUPPORT||(e=Math.floor(e)),e<0&&(e=255+e+1),this[t]=255&e,t+1},c.prototype.writeInt16LE=function(e,t,n){return e=+e,t|=0,n||O(this,e,t,2,32767,-32768),c.TYPED_ARRAY_SUPPORT?(this[t]=255&e,this[t+1]=e>>>8):N(this,e,t,!0),t+2},c.prototype.writeInt16BE=function(e,t,n){return e=+e,t|=0,n||O(this,e,t,2,32767,-32768),c.TYPED_ARRAY_SUPPORT?(this[t]=e>>>8,this[t+1]=255&e):N(this,e,t,!1),t+2},c.prototype.writeInt32LE=function(e,t,n){return e=+e,t|=0,n||O(this,e,t,4,2147483647,-2147483648),c.TYPED_ARRAY_SUPPORT?(this[t]=255&e,this[t+1]=e>>>8,this[t+2]=e>>>16,this[t+3]=e>>>24):L(this,e,t,!0),t+4},c.prototype.writeInt32BE=function(e,t,n){return e=+e,t|=0,n||O(this,e,t,4,2147483647,-2147483648),e<0&&(e=4294967295+e+1),c.TYPED_ARRAY_SUPPORT?(this[t]=e>>>24,this[t+1]=e>>>16,this[t+2]=e>>>8,this[t+3]=255&e):L(this,e,t,!1),t+4},c.prototype.writeFloatLE=function(e,t,n){return j(this,e,t,!0,n)},c.prototype.writeFloatBE=function(e,t,n){return j(this,e,t,!1,n)},c.prototype.writeDoubleLE=function(e,t,n){return P(this,e,t,!0,n)},c.prototype.writeDoubleBE=function(e,t,n){return P(this,e,t,!1,n)},c.prototype.copy=function(e,t,n,r){if(n||(n=0),r||0===r||(r=this.length),t>=e.length&&(t=e.length),t||(t=0),r>0&&r<n&&(r=n),r===n)return 0;if(0===e.length||0===this.length)return 0;if(t<0)throw new RangeError("targetStart out of bounds");if(n<0||n>=this.length)throw new RangeError("sourceStart out of bounds");if(r<0)throw new RangeError("sourceEnd out of bounds");r>this.length&&(r=this.length),e.length-t<r-n&&(r=e.length-t+n);var i,o=r-n;if(this===e&&n<t&&t<r)for(i=o-1;i>=0;--i)e[i+t]=this[i+n];else if(o<1e3||!c.TYPED_ARRAY_SUPPORT)for(i=0;i<o;++i)e[i+t]=this[i+n];else Uint8Array.prototype.set.call(e,this.subarray(n,n+o),t);return o},c.prototype.fill=function(e,t,n,r){if("string"==typeof e){if("string"==typeof t?(r=t,t=0,n=this.length):"string"==typeof n&&(r=n,n=this.length),1===e.length){var i=e.charCodeAt(0);i<256&&(e=i)}if(void 0!==r&&"string"!=typeof r)throw new TypeError("encoding must be a string");if("string"==typeof r&&!c.isEncoding(r))throw new TypeError("Unknown encoding: "+r)}else"number"==typeof e&&(e&=255);if(t<0||this.length<t||this.length<n)throw new RangeError("Out of range index");if(n<=t)return this;var o;if(t>>>=0,n=void 0===n?this.length:n>>>0,e||(e=0),"number"==typeof e)for(o=t;o<n;++o)this[o]=e;else{var s=c.isBuffer(e)?e:F(new c(e,r).toString()),a=s.length;for(o=0;o<n-t;++o)this[o+t]=s[o%a]}return this};var U=/[^+\/0-9A-Za-z-_]/g;function q(e){return e<16?"0"+e.toString(16):e.toString(16)}function F(e,t){var n;t=t||1/0;for(var r=e.length,i=null,o=[],s=0;s<r;++s){if((n=e.charCodeAt(s))>55295&&n<57344){if(!i){if(n>56319){(t-=3)>-1&&o.push(239,191,189);continue}if(s+1===r){(t-=3)>-1&&o.push(239,191,189);continue}i=n;continue}if(n<56320){(t-=3)>-1&&o.push(239,191,189),i=n;continue}n=65536+(i-55296<<10|n-56320)}else i&&(t-=3)>-1&&o.push(239,191,189);if(i=null,n<128){if((t-=1)<0)break;o.push(n)}else if(n<2048){if((t-=2)<0)break;o.push(n>>6|192,63&n|128)}else if(n<65536){if((t-=3)<0)break;o.push(n>>12|224,n>>6&63|128,63&n|128)}else{if(!(n<1114112))throw new Error("Invalid code point");if((t-=4)<0)break;o.push(n>>18|240,n>>12&63|128,n>>6&63|128,63&n|128)}}return o}function H(e){return r.toByteArray(function(e){if((e=function(e){return e.trim?e.trim():e.replace(/^\s+|\s+$/g,"")}(e).replace(U,"")).length<2)return"";for(;e.length%4!=0;)e+="=";return e}(e))}function B(e,t,n,r){for(var i=0;i<r&&!(i+n>=t.length||i>=e.length);++i)t[i+n]=e[i];return i}}).call(this,n(7))},function(e,t,n){"use strict";t.byteLength=function(e){return 3*e.length/4-l(e)},t.toByteArray=function(e){var t,n,r,s,a,c,u=e.length;a=l(e),c=new o(3*u/4-a),r=a>0?u-4:u;var d=0;for(t=0,n=0;t<r;t+=4,n+=3)s=i[e.charCodeAt(t)]<<18|i[e.charCodeAt(t+1)]<<12|i[e.charCodeAt(t+2)]<<6|i[e.charCodeAt(t+3)],c[d++]=s>>16&255,c[d++]=s>>8&255,c[d++]=255&s;2===a?(s=i[e.charCodeAt(t)]<<2|i[e.charCodeAt(t+1)]>>4,c[d++]=255&s):1===a&&(s=i[e.charCodeAt(t)]<<10|i[e.charCodeAt(t+1)]<<4|i[e.charCodeAt(t+2)]>>2,c[d++]=s>>8&255,c[d++]=255&s);return c},t.fromByteArray=function(e){for(var t,n=e.length,i=n%3,o="",s=[],a=0,c=n-i;a<c;a+=16383)s.push(u(e,a,a+16383>c?c:a+16383));1===i?(t=e[n-1],o+=r[t>>2],o+=r[t<<4&63],o+="=="):2===i&&(t=(e[n-2]<<8)+e[n-1],o+=r[t>>10],o+=r[t>>4&63],o+=r[t<<2&63],o+="=");return s.push(o),s.join("")};for(var r=[],i=[],o="undefined"!=typeof Uint8Array?Uint8Array:Array,s="ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789+/",a=0,c=s.length;a<c;++a)r[a]=s[a],i[s.charCodeAt(a)]=a;function l(e){var t=e.length;if(t%4>0)throw new Error("Invalid string. Length must be a multiple of 4");return"="===e[t-2]?2:"="===e[t-1]?1:0}function u(e,t,n){for(var i,o,s=[],a=t;a<n;a+=3)i=(e[a]<<16)+(e[a+1]<<8)+e[a+2],s.push(r[(o=i)>>18&63]+r[o>>12&63]+r[o>>6&63]+r[63&o]);return s.join("")}i["-".charCodeAt(0)]=62,i["_".charCodeAt(0)]=63},function(e,t){t.read=function(e,t,n,r,i){var o,s,a=8*i-r-1,c=(1<<a)-1,l=c>>1,u=-7,d=n?i-1:0,h=n?-1:1,f=e[t+d];for(d+=h,o=f&(1<<-u)-1,f>>=-u,u+=a;u>0;o=256*o+e[t+d],d+=h,u-=8);for(s=o&(1<<-u)-1,o>>=-u,u+=r;u>0;s=256*s+e[t+d],d+=h,u-=8);if(0===o)o=1-l;else{if(o===c)return s?NaN:1/0*(f?-1:1);s+=Math.pow(2,r),o-=l}return(f?-1:1)*s*Math.pow(2,o-r)},t.write=function(e,t,n,r,i,o){var s,a,c,l=8*o-i-1,u=(1<<l)-1,d=u>>1,h=23===i?Math.pow(2,-24)-Math.pow(2,-77):0,f=r?0:o-1,p=r?1:-1,m=t<0||0===t&&1/t<0?1:0;for(t=Math.abs(t),isNaN(t)||t===1/0?(a=isNaN(t)?1:0,s=u):(s=Math.floor(Math.log(t)/Math.LN2),t*(c=Math.pow(2,-s))<1&&(s--,c*=2),(t+=s+d>=1?h/c:h*Math.pow(2,1-d))*c>=2&&(s++,c/=2),s+d>=u?(a=0,s=u):s+d>=1?(a=(t*c-1)*Math.pow(2,i),s+=d):(a=t*Math.pow(2,d-1)*Math.pow(2,i),s=0));i>=8;e[n+f]=255&a,f+=p,a/=256,i-=8);for(s=s<<i|a,l+=i;l>0;e[n+f]=255&s,f+=p,s/=256,l-=8);e[n+f-p]|=128*m}},function(e,t){var n={}.toString;e.exports=Array.isArray||function(e){return"[object Array]"==n.call(e)}},function(e,t,n){var r;window,r=function(){return function(e){var t={};function n(r){if(t[r])return t[r].exports;var i=t[r]={i:r,l:!1,exports:{}};return e[r].call(i.exports,i,i.exports,n),i.l=!0,i.exports}return n.m=e,n.c=t,n.d=function(e,t,r){n.o(e,t)||Object.defineProperty(e,t,{enumerable:!0,get:r})},n.r=function(e){"undefined"!=typeof Symbol&&Symbol.toStringTag&&Object.defineProperty(e,Symbol.toStringTag,{value:"Module"}),Object.defineProperty(e,"__esModule",{value:!0})},n.t=function(e,t){if(1&t&&(e=n(e)),8&t)return e;if(4&t&&"object"==typeof e&&e&&e.__esModule)return e;var r=Object.create(null);if(n.r(r),Object.defineProperty(r,"default",{enumerable:!0,value:e}),2&t&&"string"!=typeof e)for(var i in e)n.d(r,i,function(t){return e[t]}.bind(null,i));return r},n.n=function(e){var t=e&&e.__esModule?function(){return e.default}:function(){return e};return n.d(t,"a",t),t},n.o=function(e,t){return Object.prototype.hasOwnProperty.call(e,t)},n.p="",n(n.s="./src/strophe.js")}({"./node_modules/webpack/buildin/global.js":
/*!***********************************!*\
  !*** (webpack)/buildin/global.js ***!
  \***********************************/
/*! no static exports found */function(e,t){var n;n=function(){return this}();try{n=n||Function("return this")()||(0,eval)("this")}catch(e){"object"==typeof window&&(n=window)}e.exports=n},"./src/bosh.js":
/*!*********************!*\
  !*** ./src/bosh.js ***!
  \*********************/
/*! no exports provided */function(e,t,n){"use strict";n.r(t);var r=n(/*! core */"./src/core.js"),i=r.default.Strophe,o=r.default.$build;i.Request=function(e,t,n,r){this.id=++i._requestId,this.xmlData=e,this.data=i.serialize(e),this.origFunc=t,this.func=t,this.rid=n,this.date=NaN,this.sends=r||0,this.abort=!1,this.dead=null,this.age=function(){return this.date?(new Date-this.date)/1e3:0},this.timeDead=function(){return this.dead?(new Date-this.dead)/1e3:0},this.xhr=this._newXHR()},i.Request.prototype={getResponse:function(){var e=null;if(this.xhr.responseXML&&this.xhr.responseXML.documentElement){if("parsererror"===(e=this.xhr.responseXML.documentElement).tagName)throw i.error("invalid response received"),i.error("responseText: "+this.xhr.responseText),i.error("responseXML: "+i.serialize(this.xhr.responseXML)),new Error("parsererror")}else if(this.xhr.responseText){if(i.debug("Got responseText but no responseXML; attempting to parse it with DOMParser..."),!(e=(new DOMParser).parseFromString(this.xhr.responseText,"application/xml").documentElement))throw new Error("Parsing produced null node");if(e.querySelector("parsererror")){i.error("invalid response received: "+e.querySelector("parsererror").textContent),i.error("responseText: "+this.xhr.responseText);var t=new Error;throw t.name=i.ErrorCondition.BAD_FORMAT,t}}return e},_newXHR:function(){var e=null;return window.XMLHttpRequest?(e=new XMLHttpRequest).overrideMimeType&&e.overrideMimeType("text/xml; charset=utf-8"):window.ActiveXObject&&(e=new ActiveXObject("Microsoft.XMLHTTP")),e.onreadystatechange=this.func.bind(null,this),e}},i.Bosh=function(e){this._conn=e,this.rid=Math.floor(4294967295*Math.random()),this.sid=null,this.hold=1,this.wait=60,this.window=5,this.errors=0,this.inactivity=null,this.lastResponseHeaders=null,this._requests=[]},i.Bosh.prototype={strip:null,_buildBody:function(){var e=o("body",{rid:this.rid++,xmlns:i.NS.HTTPBIND});return null!==this.sid&&e.attrs({sid:this.sid}),this._conn.options.keepalive&&this._conn._sessionCachingSupported()&&this._cacheSession(),e},_reset:function(){this.rid=Math.floor(4294967295*Math.random()),this.sid=null,this.errors=0,this._conn._sessionCachingSupported()&&window.sessionStorage.removeItem("strophe-bosh-session"),this._conn.nextValidRid(this.rid)},_connect:function(e,t,n){this.wait=e||this.wait,this.hold=t||this.hold,this.errors=0;var r=this._buildBody().attrs({to:this._conn.domain,"xml:lang":"en",wait:this.wait,hold:this.hold,content:"text/xml; charset=utf-8",ver:"1.6","xmpp:version":"1.0","xmlns:xmpp":i.NS.BOSH});n&&r.attrs({route:n});var o=this._conn._connect_cb;this._requests.push(new i.Request(r.tree(),this._onRequestStateChange.bind(this,o.bind(this._conn)),r.tree().getAttribute("rid"))),this._throttledRequestHandler()},_attach:function(e,t,n,r,o,s,a){this._conn.jid=e,this.sid=t,this.rid=n,this._conn.connect_callback=r,this._conn.domain=i.getDomainFromJid(this._conn.jid),this._conn.authenticated=!0,this._conn.connected=!0,this.wait=o||this.wait,this.hold=s||this.hold,this.window=a||this.window,this._conn._changeConnectStatus(i.Status.ATTACHED,null)},_restore:function(e,t,n,r,o){var s=JSON.parse(window.sessionStorage.getItem("strophe-bosh-session"));if(!(null!=s&&s.rid&&s.sid&&s.jid&&(null==e||i.getBareJidFromJid(s.jid)===i.getBareJidFromJid(e)||null===i.getNodeFromJid(e)&&i.getDomainFromJid(s.jid)===e))){var a=new Error("_restore: no restoreable session.");throw a.name="StropheSessionError",a}this._conn.restored=!0,this._attach(s.jid,s.sid,s.rid,t,n,r,o)},_cacheSession:function(){this._conn.authenticated?this._conn.jid&&this.rid&&this.sid&&window.sessionStorage.setItem("strophe-bosh-session",JSON.stringify({jid:this._conn.jid,rid:this.rid,sid:this.sid})):window.sessionStorage.removeItem("strophe-bosh-session")},_connect_cb:function(e){var t=e.getAttribute("type");if(null!==t&&"terminate"===t){var n=e.getAttribute("condition");i.error("BOSH-Connection failed: "+n);var r=e.getElementsByTagName("conflict");return null!==n?("remote-stream-error"===n&&r.length>0&&(n="conflict"),this._conn._changeConnectStatus(i.Status.CONNFAIL,n)):this._conn._changeConnectStatus(i.Status.CONNFAIL,"unknown"),this._conn._doDisconnect(n),i.Status.CONNFAIL}this.sid||(this.sid=e.getAttribute("sid"));var o=e.getAttribute("requests");o&&(this.window=parseInt(o,10));var s=e.getAttribute("hold");s&&(this.hold=parseInt(s,10));var a=e.getAttribute("wait");a&&(this.wait=parseInt(a,10));var c=e.getAttribute("inactivity");c&&(this.inactivity=parseInt(c,10))},_disconnect:function(e){this._sendTerminate(e)},_doDisconnect:function(){this.sid=null,this.rid=Math.floor(4294967295*Math.random()),this._conn._sessionCachingSupported()&&window.sessionStorage.removeItem("strophe-bosh-session"),this._conn.nextValidRid(this.rid)},_emptyQueue:function(){return 0===this._requests.length},_callProtocolErrorHandlers:function(e){var t=this._getRequestStatus(e),n=this._conn.protocolErrorHandlers.HTTP[t];n&&n.call(this,t)},_hitError:function(e){this.errors++,i.warn("request errored, status: "+e+", number of errors: "+this.errors),this.errors>4&&this._conn._onDisconnectTimeout()},_no_auth_received:function(e){i.warn("Server did not yet offer a supported authentication mechanism. Sending a blank poll request."),e=e?e.bind(this._conn):this._conn._connect_cb.bind(this._conn);var t=this._buildBody();this._requests.push(new i.Request(t.tree(),this._onRequestStateChange.bind(this,e),t.tree().getAttribute("rid"))),this._throttledRequestHandler()},_onDisconnectTimeout:function(){this._abortAllRequests()},_abortAllRequests:function(){for(;this._requests.length>0;){var e=this._requests.pop();e.abort=!0,e.xhr.abort(),e.xhr.onreadystatechange=function(){}}},_onIdle:function(){var e=this._conn._data;if(this._conn.authenticated&&0===this._requests.length&&0===e.length&&!this._conn.disconnecting&&(i.info("no requests during idle cycle, sending blank request"),e.push(null)),!this._conn.paused){if(this._requests.length<2&&e.length>0){for(var t=this._buildBody(),n=0;n<e.length;n++)null!==e[n]&&("restart"===e[n]?t.attrs({to:this._conn.domain,"xml:lang":"en","xmpp:restart":"true","xmlns:xmpp":i.NS.BOSH}):t.cnode(e[n]).up());delete this._conn._data,this._conn._data=[],this._requests.push(new i.Request(t.tree(),this._onRequestStateChange.bind(this,this._conn._dataRecv.bind(this._conn)),t.tree().getAttribute("rid"))),this._throttledRequestHandler()}if(this._requests.length>0){var r=this._requests[0].age();null!==this._requests[0].dead&&this._requests[0].timeDead()>Math.floor(i.SECONDARY_TIMEOUT*this.wait)&&this._throttledRequestHandler(),r>Math.floor(i.TIMEOUT*this.wait)&&(i.warn("Request "+this._requests[0].id+" timed out, over "+Math.floor(i.TIMEOUT*this.wait)+" seconds since last activity"),this._throttledRequestHandler())}}},_getRequestStatus:function(e,t){var n;if(4===e.xhr.readyState)try{n=e.xhr.status}catch(e){i.error("Caught an error while retrieving a request's status, reqStatus: "+n)}return void 0===n&&(n="number"==typeof t?t:0),n},_onRequestStateChange:function(e,t){if(i.debug("request id "+t.id+"."+t.sends+" state changed to "+t.xhr.readyState),t.abort)t.abort=!1;else if(4===t.xhr.readyState){var n=this._getRequestStatus(t);if(this.lastResponseHeaders=t.xhr.getAllResponseHeaders(),this.disconnecting&&n>=400)return this._hitError(n),void this._callProtocolErrorHandlers(t);var r=n>0&&n<500,o=t.sends>this._conn.maxRetries;if((r||o)&&(this._removeRequest(t),i.debug("request id "+t.id+" should now be removed")),200===n){var s=this._requests[0]===t;(this._requests[1]===t||s&&this._requests.length>0&&this._requests[0].age()>Math.floor(i.SECONDARY_TIMEOUT*this.wait))&&this._restartRequest(0),this._conn.nextValidRid(Number(t.rid)+1),i.debug("request id "+t.id+"."+t.sends+" got 200"),e(t),this.errors=0}else 0===n||n>=400&&n<600||n>=12e3?(i.error("request id "+t.id+"."+t.sends+" error "+n+" happened"),this._hitError(n),this._callProtocolErrorHandlers(t),n>=400&&n<500&&(this._conn._changeConnectStatus(i.Status.DISCONNECTING,null),this._conn._doDisconnect())):i.error("request id "+t.id+"."+t.sends+" error "+n+" happened");r||o?o&&!this._conn.connected&&this._conn._changeConnectStatus(i.Status.CONNFAIL,"giving-up"):this._throttledRequestHandler()}},_processRequest:function(e){var t=this,n=this._requests[e],r=this._getRequestStatus(n,-1);if(n.sends>this._conn.maxRetries)this._conn._onDisconnectTimeout();else{var o=n.age(),s=!isNaN(o)&&o>Math.floor(i.TIMEOUT*this.wait),a=null!==n.dead&&n.timeDead()>Math.floor(i.SECONDARY_TIMEOUT*this.wait),c=4===n.xhr.readyState&&(r<1||r>=500);if((s||a||c)&&(a&&i.error("Request ".concat(this._requests[e].id," timed out (secondary), restarting")),n.abort=!0,n.xhr.abort(),n.xhr.onreadystatechange=function(){},this._requests[e]=new i.Request(n.xmlData,n.origFunc,n.rid,n.sends),n=this._requests[e]),0===n.xhr.readyState){i.debug("request id "+n.id+"."+n.sends+" posting");try{var l=this._conn.options.contentType||"text/xml; charset=utf-8";n.xhr.open("POST",this._conn.service,!this._conn.options.sync),void 0!==n.xhr.setRequestHeader&&n.xhr.setRequestHeader("Content-Type",l),this._conn.options.withCredentials&&(n.xhr.withCredentials=!0)}catch(e){return i.error("XHR open failed: "+e.toString()),this._conn.connected||this._conn._changeConnectStatus(i.Status.CONNFAIL,"bad-service"),void this._conn.disconnect()}var u=function(){if(n.date=new Date,t._conn.options.customHeaders){var e=t._conn.options.customHeaders;for(var r in e)Object.prototype.hasOwnProperty.call(e,r)&&n.xhr.setRequestHeader(r,e[r])}n.xhr.send(n.data)};if(n.sends>1){var d=1e3*Math.min(Math.floor(i.TIMEOUT*this.wait),Math.pow(n.sends,3));setTimeout(function(){u()},d)}else u();n.sends++,this._conn.xmlOutput!==i.Connection.prototype.xmlOutput&&(n.xmlData.nodeName===this.strip&&n.xmlData.childNodes.length?this._conn.xmlOutput(n.xmlData.childNodes[0]):this._conn.xmlOutput(n.xmlData)),this._conn.rawOutput!==i.Connection.prototype.rawOutput&&this._conn.rawOutput(n.data)}else i.debug("_processRequest: "+(0===e?"first":"second")+" request has readyState of "+n.xhr.readyState)}},_removeRequest:function(e){i.debug("removing request");for(var t=this._requests.length-1;t>=0;t--)e===this._requests[t]&&this._requests.splice(t,1);e.xhr.onreadystatechange=function(){},this._throttledRequestHandler()},_restartRequest:function(e){var t=this._requests[e];null===t.dead&&(t.dead=new Date),this._processRequest(e)},_reqToData:function(e){try{return e.getResponse()}catch(e){if("parsererror"!==e.message)throw e;this._conn.disconnect("strophe-parsererror")}},_sendTerminate:function(e){i.info("_sendTerminate was called");var t=this._buildBody().attrs({type:"terminate"});e&&t.cnode(e.tree());var n=new i.Request(t.tree(),this._onRequestStateChange.bind(this,this._conn._dataRecv.bind(this._conn)),t.tree().getAttribute("rid"));this._requests.push(n),this._throttledRequestHandler()},_send:function(){var e=this;clearTimeout(this._conn._idleTimeout),this._throttledRequestHandler(),this._conn._idleTimeout=setTimeout(function(){return e._conn._onIdle()},100)},_sendRestart:function(){this._throttledRequestHandler(),clearTimeout(this._conn._idleTimeout)},_throttledRequestHandler:function(){this._requests?i.debug("_throttledRequestHandler called with "+this._requests.length+" requests"):i.debug("_throttledRequestHandler called with undefined requests"),this._requests&&0!==this._requests.length&&(this._requests.length>0&&this._processRequest(0),this._requests.length>1&&Math.abs(this._requests[0].rid-this._requests[1].rid)<this.window&&this._processRequest(1))}}},"./src/core.js":
/*!*********************!*\
  !*** ./src/core.js ***!
  \*********************/
/*! exports provided: Strophe, $build, $iq, $msg, $pres, SHA1, MD5, default */function(e,t,n){"use strict";n.r(t),n.d(t,"Strophe",function(){return h}),n.d(t,"$build",function(){return c}),n.d(t,"$iq",function(){return u}),n.d(t,"$msg",function(){return l}),n.d(t,"$pres",function(){return d});var r=n(/*! md5 */"./src/md5.js");n.d(t,"MD5",function(){return r.default});var i=n(/*! sha1 */"./src/sha1.js");n.d(t,"SHA1",function(){return i.default});var o=n(/*! utils */"./src/utils.js");function s(e){return function(e){if(Array.isArray(e)){for(var t=0,n=new Array(e.length);t<e.length;t++)n[t]=e[t];return n}}(e)||function(e){if(Symbol.iterator in Object(e)||"[object Arguments]"===Object.prototype.toString.call(e))return Array.from(e)}(e)||function(){throw new TypeError("Invalid attempt to spread non-iterable instance")}()}function a(e){return(a="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e})(e)}function c(e,t){return new h.Builder(e,t)}function l(e){return new h.Builder("message",e)}function u(e){return new h.Builder("iq",e)}function d(e){return new h.Builder("presence",e)}var h={VERSION:"1.3.2",NS:{HTTPBIND:"http://jabber.org/protocol/httpbind",BOSH:"urn:xmpp:xbosh",CLIENT:"jabber:client",AUTH:"jabber:iq:auth",ROSTER:"jabber:iq:roster",PROFILE:"jabber:iq:profile",DISCO_INFO:"http://jabber.org/protocol/disco#info",DISCO_ITEMS:"http://jabber.org/protocol/disco#items",MUC:"http://jabber.org/protocol/muc",SASL:"urn:ietf:params:xml:ns:xmpp-sasl",STREAM:"http://etherx.jabber.org/streams",FRAMING:"urn:ietf:params:xml:ns:xmpp-framing",BIND:"urn:ietf:params:xml:ns:xmpp-bind",SESSION:"urn:ietf:params:xml:ns:xmpp-session",VERSION:"jabber:iq:version",STANZAS:"urn:ietf:params:xml:ns:xmpp-stanzas",XHTML_IM:"http://jabber.org/protocol/xhtml-im",XHTML:"http://www.w3.org/1999/xhtml"},XHTML:{tags:["a","blockquote","br","cite","em","img","li","ol","p","span","strong","ul","body"],attributes:{a:["href"],blockquote:["style"],br:[],cite:["style"],em:[],img:["src","alt","style","height","width"],li:["style"],ol:["style"],p:["style"],span:["style"],strong:[],ul:["style"],body:[]},css:["background-color","color","font-family","font-size","font-style","font-weight","margin-left","margin-right","text-align","text-decoration"],validTag:function(e){for(var t=0;t<h.XHTML.tags.length;t++)if(e===h.XHTML.tags[t])return!0;return!1},validAttribute:function(e,t){if(void 0!==h.XHTML.attributes[e]&&h.XHTML.attributes[e].length>0)for(var n=0;n<h.XHTML.attributes[e].length;n++)if(t===h.XHTML.attributes[e][n])return!0;return!1},validCSS:function(e){for(var t=0;t<h.XHTML.css.length;t++)if(e===h.XHTML.css[t])return!0;return!1}},Status:{ERROR:0,CONNECTING:1,CONNFAIL:2,AUTHENTICATING:3,AUTHFAIL:4,CONNECTED:5,DISCONNECTED:6,DISCONNECTING:7,ATTACHED:8,REDIRECT:9,CONNTIMEOUT:10},ErrorCondition:{BAD_FORMAT:"bad-format",CONFLICT:"conflict",MISSING_JID_NODE:"x-strophe-bad-non-anon-jid",NO_AUTH_MECH:"no-auth-mech",UNKNOWN_REASON:"unknown"},LogLevel:{DEBUG:0,INFO:1,WARN:2,ERROR:3,FATAL:4},ElementType:{NORMAL:1,TEXT:3,CDATA:4,FRAGMENT:11},TIMEOUT:1.1,SECONDARY_TIMEOUT:.1,addNamespace:function(e,t){h.NS[e]=t},forEachChild:function(e,t,n){for(var r=0;r<e.childNodes.length;r++){var i=e.childNodes[r];i.nodeType!==h.ElementType.NORMAL||t&&!this.isTagEqual(i,t)||n(i)}},isTagEqual:function(e,t){return e.tagName===t},_xmlGenerator:null,_makeGenerator:function(){var e;return void 0===document.implementation.createDocument||document.implementation.createDocument&&document.documentMode&&document.documentMode<10?(e=this._getIEXmlDom()).appendChild(e.createElement("strophe")):e=document.implementation.createDocument("jabber:client","strophe",null),e},xmlGenerator:function(){return h._xmlGenerator||(h._xmlGenerator=h._makeGenerator()),h._xmlGenerator},_getIEXmlDom:function(){for(var e=null,t=["Msxml2.DOMDocument.6.0","Msxml2.DOMDocument.5.0","Msxml2.DOMDocument.4.0","MSXML2.DOMDocument.3.0","MSXML2.DOMDocument","MSXML.DOMDocument","Microsoft.XMLDOM"],n=0;n<t.length&&null===e;n++)try{e=new ActiveXObject(t[n])}catch(t){e=null}return e},xmlElement:function(e){if(!e)return null;for(var t=h.xmlGenerator().createElement(e),n=1;n<arguments.length;n++){var r=arguments[n];if(r)if("string"==typeof r||"number"==typeof r)t.appendChild(h.xmlTextNode(r));else if("object"===a(r)&&"function"==typeof r.sort)for(var i=0;i<r.length;i++){var o=r[i];"object"===a(o)&&"function"==typeof o.sort&&void 0!==o[1]&&null!==o[1]&&t.setAttribute(o[0],o[1])}else if("object"===a(r))for(var s in r)Object.prototype.hasOwnProperty.call(r,s)&&void 0!==r[s]&&null!==r[s]&&t.setAttribute(s,r[s])}return t},xmlescape:function(e){return e=(e=(e=(e=(e=e.replace(/\&/g,"&amp;")).replace(/</g,"&lt;")).replace(/>/g,"&gt;")).replace(/'/g,"&apos;")).replace(/"/g,"&quot;")},xmlunescape:function(e){return e=(e=(e=(e=(e=e.replace(/\&amp;/g,"&")).replace(/&lt;/g,"<")).replace(/&gt;/g,">")).replace(/&apos;/g,"'")).replace(/&quot;/g,'"')},xmlTextNode:function(e){return h.xmlGenerator().createTextNode(e)},xmlHtmlNode:function(e){var t;DOMParser?t=(new DOMParser).parseFromString(e,"text/xml"):((t=new ActiveXObject("Microsoft.XMLDOM")).async="false",t.loadXML(e));return t},getText:function(e){if(!e)return null;var t="";0===e.childNodes.length&&e.nodeType===h.ElementType.TEXT&&(t+=e.nodeValue);for(var n=0;n<e.childNodes.length;n++)e.childNodes[n].nodeType===h.ElementType.TEXT&&(t+=e.childNodes[n].nodeValue);return h.xmlescape(t)},copyElement:function(e){var t;if(e.nodeType===h.ElementType.NORMAL){t=h.xmlElement(e.tagName);for(var n=0;n<e.attributes.length;n++)t.setAttribute(e.attributes[n].nodeName,e.attributes[n].value);for(var r=0;r<e.childNodes.length;r++)t.appendChild(h.copyElement(e.childNodes[r]))}else e.nodeType===h.ElementType.TEXT&&(t=h.xmlGenerator().createTextNode(e.nodeValue));return t},createHtml:function(e){var t;if(e.nodeType===h.ElementType.NORMAL){var n=e.nodeName.toLowerCase();if(h.XHTML.validTag(n))try{t=h.xmlElement(n);for(var r=0;r<h.XHTML.attributes[n].length;r++){var i=h.XHTML.attributes[n][r],o=e.getAttribute(i);if(null!=o&&""!==o&&!1!==o&&0!==o)if("style"===i&&"object"===a(o)&&void 0!==o.cssText&&(o=o.cssText),"style"===i){for(var s=[],c=o.split(";"),l=0;l<c.length;l++){var u=c[l].split(":"),d=u[0].replace(/^\s*/,"").replace(/\s*$/,"").toLowerCase();if(h.XHTML.validCSS(d)){var f=u[1].replace(/^\s*/,"").replace(/\s*$/,"");s.push(d+": "+f)}}s.length>0&&(o=s.join("; "),t.setAttribute(i,o))}else t.setAttribute(i,o)}for(var p=0;p<e.childNodes.length;p++)t.appendChild(h.createHtml(e.childNodes[p]))}catch(e){t=h.xmlTextNode("")}else{t=h.xmlGenerator().createDocumentFragment();for(var m=0;m<e.childNodes.length;m++)t.appendChild(h.createHtml(e.childNodes[m]))}}else if(e.nodeType===h.ElementType.FRAGMENT){t=h.xmlGenerator().createDocumentFragment();for(var g=0;g<e.childNodes.length;g++)t.appendChild(h.createHtml(e.childNodes[g]))}else e.nodeType===h.ElementType.TEXT&&(t=h.xmlTextNode(e.nodeValue));return t},escapeNode:function(e){return"string"!=typeof e?e:e.replace(/^\s+|\s+$/g,"").replace(/\\/g,"\\5c").replace(/ /g,"\\20").replace(/\"/g,"\\22").replace(/\&/g,"\\26").replace(/\'/g,"\\27").replace(/\//g,"\\2f").replace(/:/g,"\\3a").replace(/</g,"\\3c").replace(/>/g,"\\3e").replace(/@/g,"\\40")},unescapeNode:function(e){return"string"!=typeof e?e:e.replace(/\\20/g," ").replace(/\\22/g,'"').replace(/\\26/g,"&").replace(/\\27/g,"'").replace(/\\2f/g,"/").replace(/\\3a/g,":").replace(/\\3c/g,"<").replace(/\\3e/g,">").replace(/\\40/g,"@").replace(/\\5c/g,"\\")},getNodeFromJid:function(e){return e.indexOf("@")<0?null:e.split("@")[0]},getDomainFromJid:function(e){var t=h.getBareJidFromJid(e);if(t.indexOf("@")<0)return t;var n=t.split("@");return n.splice(0,1),n.join("@")},getResourceFromJid:function(e){var t=e.split("/");return t.length<2?null:(t.splice(0,1),t.join("/"))},getBareJidFromJid:function(e){return e?e.split("/")[0]:null},_handleError:function(e){void 0!==e.stack&&h.fatal(e.stack),e.sourceURL?h.fatal("error: "+this.handler+" "+e.sourceURL+":"+e.line+" - "+e.name+": "+e.message):e.fileName?h.fatal("error: "+this.handler+" "+e.fileName+":"+e.lineNumber+" - "+e.name+": "+e.message):h.fatal("error: "+e.message)},log:function(e,t){e===this.LogLevel.FATAL&&"object"===a(window.console)&&"function"==typeof window.console.error&&window.console.error(t)},debug:function(e){this.log(this.LogLevel.DEBUG,e)},info:function(e){this.log(this.LogLevel.INFO,e)},warn:function(e){this.log(this.LogLevel.WARN,e)},error:function(e){this.log(this.LogLevel.ERROR,e)},fatal:function(e){this.log(this.LogLevel.FATAL,e)},serialize:function(e){if(!e)return null;"function"==typeof e.tree&&(e=e.tree());var t=s(Array(e.attributes.length).keys()).map(function(t){return e.attributes[t].nodeName});t.sort();var n=t.reduce(function(t,n){return"".concat(t," ").concat(n,'="').concat(h.xmlescape(e.attributes.getNamedItem(n).value),'"')},"<".concat(e.nodeName));if(e.childNodes.length>0){n+=">";for(var r=0;r<e.childNodes.length;r++){var i=e.childNodes[r];switch(i.nodeType){case h.ElementType.NORMAL:n+=h.serialize(i);break;case h.ElementType.TEXT:n+=h.xmlescape(i.nodeValue);break;case h.ElementType.CDATA:n+="<![CDATA["+i.nodeValue+"]]>"}}n+="</"+e.nodeName+">"}else n+="/>";return n},_requestId:0,_connectionPlugins:{},addConnectionPlugin:function(e,t){h._connectionPlugins[e]=t},Builder:function(e,t){"presence"!==e&&"message"!==e&&"iq"!==e||(t&&!t.xmlns?t.xmlns=h.NS.CLIENT:t||(t={xmlns:h.NS.CLIENT})),this.nodeTree=h.xmlElement(e,t),this.node=this.nodeTree}};h.Builder.prototype={tree:function(){return this.nodeTree},toString:function(){return h.serialize(this.nodeTree)},up:function(){return this.node=this.node.parentNode,this},root:function(){return this.node=this.nodeTree,this},attrs:function(e){for(var t in e)Object.prototype.hasOwnProperty.call(e,t)&&(void 0===e[t]?this.node.removeAttribute(t):this.node.setAttribute(t,e[t]));return this},c:function(e,t,n){var r=h.xmlElement(e,t,n);return this.node.appendChild(r),"string"!=typeof n&&"number"!=typeof n&&(this.node=r),this},cnode:function(e){var t,n=h.xmlGenerator();try{t=void 0!==n.importNode}catch(e){t=!1}var r=t?n.importNode(e,!0):h.copyElement(e);return this.node.appendChild(r),this.node=r,this},t:function(e){var t=h.xmlTextNode(e);return this.node.appendChild(t),this},h:function(e){var t=document.createElement("body");t.innerHTML=e;for(var n=h.createHtml(t);n.childNodes.length>0;)this.node.appendChild(n.childNodes[0]);return this}},h.Handler=function(e,t,n,r,i,o,s){this.handler=e,this.ns=t,this.name=n,this.type=r,this.id=i,this.options=s||{matchBareFromJid:!1,ignoreNamespaceFragment:!1},this.options.matchBare&&(h.warn('The "matchBare" option is deprecated, use "matchBareFromJid" instead.'),this.options.matchBareFromJid=this.options.matchBare,delete this.options.matchBare),this.options.matchBareFromJid?this.from=o?h.getBareJidFromJid(o):null:this.from=o,this.user=!0},h.Handler.prototype={getNamespace:function(e){var t=e.getAttribute("xmlns");return t&&this.options.ignoreNamespaceFragment&&(t=t.split("#")[0]),t},namespaceMatch:function(e){var t=this,n=!1;return!this.ns||(h.forEachChild(e,null,function(e){t.getNamespace(e)===t.ns&&(n=!0)}),n||this.getNamespace(e)===this.ns)},isMatch:function(e){var t=e.getAttribute("from");this.options.matchBareFromJid&&(t=h.getBareJidFromJid(t));var n=e.getAttribute("type");return!(!this.namespaceMatch(e)||this.name&&!h.isTagEqual(e,this.name)||this.type&&(Array.isArray(this.type)?-1===this.type.indexOf(n):n!==this.type)||this.id&&e.getAttribute("id")!==this.id||this.from&&t!==this.from)},run:function(e){var t=null;try{t=this.handler(e)}catch(e){throw h._handleError(e),e}return t},toString:function(){return"{Handler: "+this.handler+"("+this.name+","+this.id+","+this.ns+")}"}},h.TimedHandler=function(e,t){this.period=e,this.handler=t,this.lastCalled=(new Date).getTime(),this.user=!0},h.TimedHandler.prototype={run:function(){return this.lastCalled=(new Date).getTime(),this.handler()},reset:function(){this.lastCalled=(new Date).getTime()},toString:function(){return"{TimedHandler: "+this.handler+"("+this.period+")}"}},h.Connection=function(e,t){var n=this;this.service=e,this.options=t||{};var r=this.options.protocol||"";for(var i in 0===e.indexOf("ws:")||0===e.indexOf("wss:")||0===r.indexOf("ws")?this._proto=new h.Websocket(this):this._proto=new h.Bosh(this),this.jid="",this.domain=null,this.features=null,this._sasl_data={},this.do_session=!1,this.do_bind=!1,this.timedHandlers=[],this.handlers=[],this.removeTimeds=[],this.removeHandlers=[],this.addTimeds=[],this.addHandlers=[],this.protocolErrorHandlers={HTTP:{},websocket:{}},this._idleTimeout=null,this._disconnectTimeout=null,this.authenticated=!1,this.connected=!1,this.disconnecting=!1,this.do_authentication=!0,this.paused=!1,this.restored=!1,this._data=[],this._uniqueId=0,this._sasl_success_handler=null,this._sasl_failure_handler=null,this._sasl_challenge_handler=null,this.maxRetries=5,this._idleTimeout=setTimeout(function(){return n._onIdle()},100),o.default.addCookies(this.options.cookies),this.registerSASLMechanisms(this.options.mechanisms),h._connectionPlugins)if(Object.prototype.hasOwnProperty.call(h._connectionPlugins,i)){var s=function(){};s.prototype=h._connectionPlugins[i],this[i]=new s,this[i].init(this)}},h.Connection.prototype={reset:function(){this._proto._reset(),this.do_session=!1,this.do_bind=!1,this.timedHandlers=[],this.handlers=[],this.removeTimeds=[],this.removeHandlers=[],this.addTimeds=[],this.addHandlers=[],this.authenticated=!1,this.connected=!1,this.disconnecting=!1,this.restored=!1,this._data=[],this._requests=[],this._uniqueId=0},pause:function(){this.paused=!0},resume:function(){this.paused=!1},getUniqueId:function(e){var t="xxxxxxxx-xxxx-4xxx-yxxx-xxxxxxxxxxxx".replace(/[xy]/g,function(e){var t=16*Math.random()|0;return("x"===e?t:3&t|8).toString(16)});return"string"==typeof e||"number"==typeof e?t+":"+e:t+""},addProtocolErrorHandler:function(e,t,n){this.protocolErrorHandlers[e][t]=n},connect:function(e,t,n,r,i,o,s){this.jid=e,this.authzid=h.getBareJidFromJid(this.jid),this.authcid=s||h.getNodeFromJid(this.jid),this.pass=t,this.servtype="xmpp",this.connect_callback=n,this.disconnecting=!1,this.connected=!1,this.authenticated=!1,this.restored=!1,this.domain=h.getDomainFromJid(this.jid),this._changeConnectStatus(h.Status.CONNECTING,null),this._proto._connect(r,i,o)},attach:function(e,t,n,r,i,o,s){if(!(this._proto instanceof h.Bosh)){var a=new Error('The "attach" method can only be used with a BOSH connection.');throw a.name="StropheSessionError",a}this._proto._attach(e,t,n,r,i,o,s)},restore:function(e,t,n,r,i){if(!this._sessionCachingSupported()){var o=new Error('The "restore" method can only be used with a BOSH connection.');throw o.name="StropheSessionError",o}this._proto._restore(e,t,n,r,i)},_sessionCachingSupported:function(){if(this._proto instanceof h.Bosh){if(!JSON)return!1;try{sessionStorage.setItem("_strophe_","_strophe_"),sessionStorage.removeItem("_strophe_")}catch(e){return!1}return!0}return!1},xmlInput:function(e){},xmlOutput:function(e){},rawInput:function(e){},rawOutput:function(e){},nextValidRid:function(e){},send:function(e){if(null!==e){if("function"==typeof e.sort)for(var t=0;t<e.length;t++)this._queueData(e[t]);else"function"==typeof e.tree?this._queueData(e.tree()):this._queueData(e);this._proto._send()}},flush:function(){clearTimeout(this._idleTimeout),this._onIdle()},sendPresence:function(e,t,n,r){var i=this,o=null;"function"==typeof e.tree&&(e=e.tree());var s=e.getAttribute("id");if(s||(s=this.getUniqueId("sendPresence"),e.setAttribute("id",s)),"function"==typeof t||"function"==typeof n){var a=this.addHandler(function(e){o&&i.deleteTimedHandler(o),"error"===e.getAttribute("type")?n&&n(e):t&&t(e)},null,"presence",null,s);r&&(o=this.addTimedHandler(r,function(){return i.deleteHandler(a),n&&n(null),!1}))}return this.send(e),s},sendIQ:function(e,t,n,r){var i=this,o=null;"function"==typeof e.tree&&(e=e.tree());var s=e.getAttribute("id");if(s||(s=this.getUniqueId("sendIQ"),e.setAttribute("id",s)),"function"==typeof t||"function"==typeof n){var a=this.addHandler(function(e){o&&i.deleteTimedHandler(o);var r=e.getAttribute("type");if("result"===r)t&&t(e);else{if("error"!==r){var s=new Error("Got bad IQ type of ".concat(r));throw s.name="StropheError",s}n&&n(e)}},null,"iq",["error","result"],s);r&&(o=this.addTimedHandler(r,function(){return i.deleteHandler(a),n&&n(null),!1}))}return this.send(e),s},_queueData:function(e){if(null===e||!e.tagName||!e.childNodes){var t=new Error("Cannot queue non-DOMElement.");throw t.name="StropheError",t}this._data.push(e)},_sendRestart:function(){var e=this;this._data.push("restart"),this._proto._sendRestart(),this._idleTimeout=setTimeout(function(){return e._onIdle()},100)},addTimedHandler:function(e,t){var n=new h.TimedHandler(e,t);return this.addTimeds.push(n),n},deleteTimedHandler:function(e){this.removeTimeds.push(e)},addHandler:function(e,t,n,r,i,o,s){var a=new h.Handler(e,t,n,r,i,o,s);return this.addHandlers.push(a),a},deleteHandler:function(e){this.removeHandlers.push(e);var t=this.addHandlers.indexOf(e);t>=0&&this.addHandlers.splice(t,1)},registerSASLMechanisms:function(e){this.mechanisms={},(e=e||[h.SASLAnonymous,h.SASLExternal,h.SASLMD5,h.SASLOAuthBearer,h.SASLXOAuth2,h.SASLPlain,h.SASLSHA1]).forEach(this.registerSASLMechanism.bind(this))},registerSASLMechanism:function(e){this.mechanisms[e.prototype.name]=e},disconnect:function(e){if(this._changeConnectStatus(h.Status.DISCONNECTING,e),h.info("Disconnect was called because: "+e),this.connected){var t=!1;this.disconnecting=!0,this.authenticated&&(t=d({xmlns:h.NS.CLIENT,type:"unavailable"})),this._disconnectTimeout=this._addSysTimedHandler(3e3,this._onDisconnectTimeout.bind(this)),this._proto._disconnect(t)}else h.info("Disconnect was called before Strophe connected to the server"),this._proto._abortAllRequests(),this._doDisconnect()},_changeConnectStatus:function(e,t,n){for(var r in h._connectionPlugins)if(Object.prototype.hasOwnProperty.call(h._connectionPlugins,r)){var i=this[r];if(i.statusChanged)try{i.statusChanged(e,t)}catch(e){h.error("".concat(r," plugin caused an exception changing status: ").concat(e))}}if(this.connect_callback)try{this.connect_callback(e,t,n)}catch(e){h._handleError(e),h.error("User connection callback caused an exception: ".concat(e))}},_doDisconnect:function(e){"number"==typeof this._idleTimeout&&clearTimeout(this._idleTimeout),null!==this._disconnectTimeout&&(this.deleteTimedHandler(this._disconnectTimeout),this._disconnectTimeout=null),h.info("_doDisconnect was called"),this._proto._doDisconnect(),this.authenticated=!1,this.disconnecting=!1,this.restored=!1,this.handlers=[],this.timedHandlers=[],this.removeTimeds=[],this.removeHandlers=[],this.addTimeds=[],this.addHandlers=[],this._changeConnectStatus(h.Status.DISCONNECTED,e),this.connected=!1},_dataRecv:function(e,t){var n=this;h.info("_dataRecv called");var r=this._proto._reqToData(e);if(null!==r){for(this.xmlInput!==h.Connection.prototype.xmlInput&&(r.nodeName===this._proto.strip&&r.childNodes.length?this.xmlInput(r.childNodes[0]):this.xmlInput(r)),this.rawInput!==h.Connection.prototype.rawInput&&(t?this.rawInput(t):this.rawInput(h.serialize(r)));this.removeHandlers.length>0;){var i=this.removeHandlers.pop(),o=this.handlers.indexOf(i);o>=0&&this.handlers.splice(o,1)}for(;this.addHandlers.length>0;)this.handlers.push(this.addHandlers.pop());if(this.disconnecting&&this._proto._emptyQueue())this._doDisconnect();else{var s=r.getAttribute("type");if(null!==s&&"terminate"===s){if(this.disconnecting)return;var a=r.getAttribute("condition"),c=r.getElementsByTagName("conflict");return null!==a?("remote-stream-error"===a&&c.length>0&&(a="conflict"),this._changeConnectStatus(h.Status.CONNFAIL,a)):this._changeConnectStatus(h.Status.CONNFAIL,h.ErrorCondition.UNKOWN_REASON),void this._doDisconnect(a)}h.forEachChild(r,null,function(e){var t=n.handlers;n.handlers=[];for(var r=0;r<t.length;r++){var i=t[r];try{!i.isMatch(e)||!n.authenticated&&i.user?n.handlers.push(i):i.run(e)&&n.handlers.push(i)}catch(e){h.warn("Removing Strophe handlers due to uncaught exception: "+e.message)}}})}}},mechanisms:{},_connect_cb:function(e,t,n){var r;h.info("_connect_cb was called"),this.connected=!0;try{r=this._proto._reqToData(e)}catch(e){if(e.name!==h.ErrorCondition.BAD_FORMAT)throw e;this._changeConnectStatus(h.Status.CONNFAIL,h.ErrorCondition.BAD_FORMAT),this._doDisconnect(h.ErrorCondition.BAD_FORMAT)}if(r&&(this.xmlInput!==h.Connection.prototype.xmlInput&&(r.nodeName===this._proto.strip&&r.childNodes.length?this.xmlInput(r.childNodes[0]):this.xmlInput(r)),this.rawInput!==h.Connection.prototype.rawInput&&(n?this.rawInput(n):this.rawInput(h.serialize(r))),this._proto._connect_cb(r)!==h.Status.CONNFAIL))if(r.getElementsByTagNameNS?r.getElementsByTagNameNS(h.NS.STREAM,"features").length>0:r.getElementsByTagName("stream:features").length>0||r.getElementsByTagName("features").length>0){var i=[],o=r.getElementsByTagName("mechanism");if(o.length>0)for(var s=0;s<o.length;s++){var a=h.getText(o[s]);this.mechanisms[a]&&i.push(this.mechanisms[a])}0!==i.length||0!==r.getElementsByTagName("auth").length?!1!==this.do_authentication&&this.authenticate(i):this._proto._no_auth_received(t)}else this._proto._no_auth_received(t)},sortMechanismsByPriority:function(e){for(var t=0;t<e.length-1;++t){for(var n=t,r=t+1;r<e.length;++r)e[r].prototype.priority>e[n].prototype.priority&&(n=r);if(n!==t){var i=e[t];e[t]=e[n],e[n]=i}}return e},_attemptSASLAuth:function(e){e=this.sortMechanismsByPriority(e||[]);for(var t=!1,n=0;n<e.length;++n)if(e[n].prototype.test(this)){this._sasl_success_handler=this._addSysHandler(this._sasl_success_cb.bind(this),null,"success",null,null),this._sasl_failure_handler=this._addSysHandler(this._sasl_failure_cb.bind(this),null,"failure",null,null),this._sasl_challenge_handler=this._addSysHandler(this._sasl_challenge_cb.bind(this),null,"challenge",null,null),this._sasl_mechanism=new e[n],this._sasl_mechanism.onStart(this);var r=c("auth",{xmlns:h.NS.SASL,mechanism:this._sasl_mechanism.name});if(this._sasl_mechanism.isClientFirst){var i=this._sasl_mechanism.onChallenge(this,null);r.t(btoa(i))}this.send(r.tree()),t=!0;break}return t},_attemptLegacyAuth:function(){null===h.getNodeFromJid(this.jid)?(this._changeConnectStatus(h.Status.CONNFAIL,h.ErrorCondition.MISSING_JID_NODE),this.disconnect(h.ErrorCondition.MISSING_JID_NODE)):(this._changeConnectStatus(h.Status.AUTHENTICATING,null),this._addSysHandler(this._auth1_cb.bind(this),null,null,null,"_auth_1"),this.send(u({type:"get",to:this.domain,id:"_auth_1"}).c("query",{xmlns:h.NS.AUTH}).c("username",{}).t(h.getNodeFromJid(this.jid)).tree()))},authenticate:function(e){this._attemptSASLAuth(e)||this._attemptLegacyAuth()},_sasl_challenge_cb:function(e){var t=atob(h.getText(e)),n=this._sasl_mechanism.onChallenge(this,t),r=c("response",{xmlns:h.NS.SASL});return""!==n&&r.t(btoa(n)),this.send(r.tree()),!0},_auth1_cb:function(e){var t=u({type:"set",id:"_auth_2"}).c("query",{xmlns:h.NS.AUTH}).c("username",{}).t(h.getNodeFromJid(this.jid)).up().c("password").t(this.pass);return h.getResourceFromJid(this.jid)||(this.jid=h.getBareJidFromJid(this.jid)+"/strophe"),t.up().c("resource",{}).t(h.getResourceFromJid(this.jid)),this._addSysHandler(this._auth2_cb.bind(this),null,null,null,"_auth_2"),this.send(t.tree()),!1},_sasl_success_cb:function(e){var t=this;if(this._sasl_data["server-signature"]){var n,r=atob(h.getText(e)).match(/([a-z]+)=([^,]+)(,|$)/);if("v"===r[1]&&(n=r[2]),n!==this._sasl_data["server-signature"])return this.deleteHandler(this._sasl_failure_handler),this._sasl_failure_handler=null,this._sasl_challenge_handler&&(this.deleteHandler(this._sasl_challenge_handler),this._sasl_challenge_handler=null),this._sasl_data={},this._sasl_failure_cb(null)}h.info("SASL authentication succeeded."),this._sasl_mechanism&&this._sasl_mechanism.onSuccess(),this.deleteHandler(this._sasl_failure_handler),this._sasl_failure_handler=null,this._sasl_challenge_handler&&(this.deleteHandler(this._sasl_challenge_handler),this._sasl_challenge_handler=null);var i=[],o=function(e,n){for(;e.length;)t.deleteHandler(e.pop());return t._sasl_auth1_cb(n),!1};return i.push(this._addSysHandler(function(e){return o(i,e)},null,"stream:features",null,null)),i.push(this._addSysHandler(function(e){return o(i,e)},h.NS.STREAM,"features",null,null)),this._sendRestart(),!1},_sasl_auth1_cb:function(e){this.features=e;for(var t=0;t<e.childNodes.length;t++){var n=e.childNodes[t];"bind"===n.nodeName&&(this.do_bind=!0),"session"===n.nodeName&&(this.do_session=!0)}if(!this.do_bind)return this._changeConnectStatus(h.Status.AUTHFAIL,null),!1;this._addSysHandler(this._sasl_bind_cb.bind(this),null,null,null,"_bind_auth_2");var r=h.getResourceFromJid(this.jid);return r?this.send(u({type:"set",id:"_bind_auth_2"}).c("bind",{xmlns:h.NS.BIND}).c("resource",{}).t(r).tree()):this.send(u({type:"set",id:"_bind_auth_2"}).c("bind",{xmlns:h.NS.BIND}).tree()),!1},_sasl_bind_cb:function(e){var t;if("error"===e.getAttribute("type"))return h.info("SASL binding failed."),e.getElementsByTagName("conflict").length>0&&(t=h.ErrorCondition.CONFLICT),this._changeConnectStatus(h.Status.AUTHFAIL,t,e),!1;var n=e.getElementsByTagName("bind");if(!(n.length>0))return h.info("SASL binding failed."),this._changeConnectStatus(h.Status.AUTHFAIL,null,e),!1;var r=n[0].getElementsByTagName("jid");r.length>0&&(this.jid=h.getText(r[0]),this.do_session?(this._addSysHandler(this._sasl_session_cb.bind(this),null,null,null,"_session_auth_2"),this.send(u({type:"set",id:"_session_auth_2"}).c("session",{xmlns:h.NS.SESSION}).tree())):(this.authenticated=!0,this._changeConnectStatus(h.Status.CONNECTED,null)))},_sasl_session_cb:function(e){if("result"===e.getAttribute("type"))this.authenticated=!0,this._changeConnectStatus(h.Status.CONNECTED,null);else if("error"===e.getAttribute("type"))return h.info("Session creation failed."),this._changeConnectStatus(h.Status.AUTHFAIL,null,e),!1;return!1},_sasl_failure_cb:function(e){return this._sasl_success_handler&&(this.deleteHandler(this._sasl_success_handler),this._sasl_success_handler=null),this._sasl_challenge_handler&&(this.deleteHandler(this._sasl_challenge_handler),this._sasl_challenge_handler=null),this._sasl_mechanism&&this._sasl_mechanism.onFailure(),this._changeConnectStatus(h.Status.AUTHFAIL,null,e),!1},_auth2_cb:function(e){return"result"===e.getAttribute("type")?(this.authenticated=!0,this._changeConnectStatus(h.Status.CONNECTED,null)):"error"===e.getAttribute("type")&&(this._changeConnectStatus(h.Status.AUTHFAIL,null,e),this.disconnect("authentication failed")),!1},_addSysTimedHandler:function(e,t){var n=new h.TimedHandler(e,t);return n.user=!1,this.addTimeds.push(n),n},_addSysHandler:function(e,t,n,r,i){var o=new h.Handler(e,t,n,r,i);return o.user=!1,this.addHandlers.push(o),o},_onDisconnectTimeout:function(){return h.info("_onDisconnectTimeout was called"),this._changeConnectStatus(h.Status.CONNTIMEOUT,null),this._proto._onDisconnectTimeout(),this._doDisconnect(),!1},_onIdle:function(){for(var e=this;this.addTimeds.length>0;)this.timedHandlers.push(this.addTimeds.pop());for(;this.removeTimeds.length>0;){var t=this.removeTimeds.pop(),n=this.timedHandlers.indexOf(t);n>=0&&this.timedHandlers.splice(n,1)}for(var r=(new Date).getTime(),i=[],o=0;o<this.timedHandlers.length;o++){var s=this.timedHandlers[o];if(this.authenticated||!s.user)s.lastCalled+s.period-r<=0?s.run()&&i.push(s):i.push(s)}this.timedHandlers=i,clearTimeout(this._idleTimeout),this._proto._onIdle(),this.connected&&(this._idleTimeout=setTimeout(function(){return e._onIdle()},100))}},h.SASLMechanism=function(e,t,n){this.name=e,this.isClientFirst=t,this.priority=n},h.SASLMechanism.prototype={test:function(e){return!0},onStart:function(e){this._connection=e},onChallenge:function(e,t){throw new Error("You should implement challenge handling!")},onFailure:function(){this._connection=null},onSuccess:function(){this._connection=null}},h.SASLAnonymous=function(){},h.SASLAnonymous.prototype=new h.SASLMechanism("ANONYMOUS",!1,20),h.SASLAnonymous.prototype.test=function(e){return null===e.authcid},h.SASLPlain=function(){},h.SASLPlain.prototype=new h.SASLMechanism("PLAIN",!0,50),h.SASLPlain.prototype.test=function(e){return null!==e.authcid},h.SASLPlain.prototype.onChallenge=function(e){var t=e.authzid;return t+="\0",t+=e.authcid,t+="\0",t+=e.pass,o.default.utf16to8(t)},h.SASLSHA1=function(){},h.SASLSHA1.prototype=new h.SASLMechanism("SCRAM-SHA-1",!0,70),h.SASLSHA1.prototype.test=function(e){return null!==e.authcid},h.SASLSHA1.prototype.onChallenge=function(e,t,n){var s=n||r.default.hexdigest(""+1234567890*Math.random()),a="n="+o.default.utf16to8(e.authcid);return a+=",r=",a+=s,e._sasl_data.cnonce=s,e._sasl_data["client-first-message-bare"]=a,a="n,,"+a,this.onChallenge=function(e,t){for(var n,r,s,a,c,l,u,d,h="c=biws,",f="".concat(e._sasl_data["client-first-message-bare"],",").concat(t,","),p=e._sasl_data.cnonce,m=/([a-z]+)=([^,]+)(,|$)/;t.match(m);){var g=t.match(m);switch(t=t.replace(g[0],""),g[1]){case"r":n=g[2];break;case"s":r=g[2];break;case"i":s=g[2]}}if(n.substr(0,p.length)!==p)return e._sasl_data={},e._sasl_failure_cb();f+=h+="r="+n,r=atob(r),r+="\0\0\0";var v=o.default.utf16to8(e.pass);for(a=l=i.default.core_hmac_sha1(v,r),u=1;u<s;u++){for(c=i.default.core_hmac_sha1(v,i.default.binb2str(l)),d=0;d<5;d++)a[d]^=c[d];l=c}a=i.default.binb2str(a);var b=i.default.core_hmac_sha1(a,"Client Key"),y=i.default.str_hmac_sha1(a,"Server Key"),S=i.default.core_hmac_sha1(i.default.str_sha1(i.default.binb2str(b)),f);for(e._sasl_data["server-signature"]=i.default.b64_hmac_sha1(y,f),d=0;d<5;d++)b[d]^=S[d];return h+=",p="+btoa(i.default.binb2str(b))},a},h.SASLMD5=function(){},h.SASLMD5.prototype=new h.SASLMechanism("DIGEST-MD5",!1,60),h.SASLMD5.prototype.test=function(e){return null!==e.authcid},h.SASLMD5.prototype._quote=function(e){return'"'+e.replace(/\\/g,"\\\\").replace(/"/g,'\\"')+'"'},h.SASLMD5.prototype.onChallenge=function(e,t,n){for(var i=/([a-z]+)=("[^"]+"|[^,"]+)(?:,|$)/,s=n||r.default.hexdigest(""+1234567890*Math.random()),a="",c=null,l="";t.match(i);){var u=t.match(i);switch(t=t.replace(u[0],""),u[2]=u[2].replace(/^"(.+)"$/,"$1"),u[1]){case"realm":a=u[2];break;case"nonce":l=u[2];break;case"qop":u[2];break;case"host":c=u[2]}}var d=e.servtype+"/"+e.domain;null!==c&&(d=d+"/"+c);var h=o.default.utf16to8(e.authcid+":"+a+":"+this._connection.pass),f=r.default.hash(h)+":"+l+":"+s,p="AUTHENTICATE:"+d,m="";return m+="charset=utf-8,",m+="username="+this._quote(o.default.utf16to8(e.authcid))+",",m+="realm="+this._quote(a)+",",m+="nonce="+this._quote(l)+",",m+="nc=00000001,",m+="cnonce="+this._quote(s)+",",m+="digest-uri="+this._quote(d)+",",m+="response="+r.default.hexdigest(r.default.hexdigest(f)+":"+l+":00000001:"+s+":auth:"+r.default.hexdigest(p))+",",m+="qop=auth",this.onChallenge=function(){return""},m},h.SASLOAuthBearer=function(){},h.SASLOAuthBearer.prototype=new h.SASLMechanism("OAUTHBEARER",!0,40),h.SASLOAuthBearer.prototype.test=function(e){return null!==e.pass},h.SASLOAuthBearer.prototype.onChallenge=function(e){var t="n,";return null!==e.authcid&&(t=t+"a="+e.authzid),t+=",",t+="",t+="auth=Bearer ",t+=e.pass,t+="",t+="",o.default.utf16to8(t)},h.SASLExternal=function(){},h.SASLExternal.prototype=new h.SASLMechanism("EXTERNAL",!0,10),h.SASLExternal.prototype.onChallenge=function(e){return e.authcid===e.authzid?"":e.authzid},h.SASLXOAuth2=function(){},h.SASLXOAuth2.prototype=new h.SASLMechanism("X-OAUTH2",!0,30),h.SASLXOAuth2.prototype.test=function(e){return null!==e.pass},h.SASLXOAuth2.prototype.onChallenge=function(e){var t="\0";return null!==e.authcid&&(t+=e.authzid),t+="\0",t+=e.pass,o.default.utf16to8(t)},t.default={Strophe:h,$build:c,$iq:u,$msg:l,$pres:d,SHA1:i.default,MD5:r.default,b64_hmac_sha1:i.default.b64_hmac_sha1,b64_sha1:i.default.b64_sha1,str_hmac_sha1:i.default.str_hmac_sha1,str_sha1:i.default.str_sha1}},"./src/md5.js":
/*!********************!*\
  !*** ./src/md5.js ***!
  \********************/
/*! exports provided: default */function(e,t,n){"use strict";n.r(t),n.d(t,"default",function(){return d});var r=function(e,t){var n=(65535&e)+(65535&t);return(e>>16)+(t>>16)+(n>>16)<<16|65535&n},i=function(e){if("string"!=typeof e)throw new Error("str2binl was passed a non-string");for(var t=[],n=0;n<8*e.length;n+=8)t[n>>5]|=(255&e.charCodeAt(n/8))<<n%32;return t},o=function(e,t,n,i,o,s){return r((a=r(r(t,e),r(i,s)))<<(c=o)|a>>>32-c,n);var a,c},s=function(e,t,n,r,i,s,a){return o(t&n|~t&r,e,t,i,s,a)},a=function(e,t,n,r,i,s,a){return o(t&r|n&~r,e,t,i,s,a)},c=function(e,t,n,r,i,s,a){return o(t^n^r,e,t,i,s,a)},l=function(e,t,n,r,i,s,a){return o(n^(t|~r),e,t,i,s,a)},u=function(e,t){e[t>>5]|=128<<t%32,e[14+(t+64>>>9<<4)]=t;for(var n,i,o,u,d=1732584193,h=-271733879,f=-1732584194,p=271733878,m=0;m<e.length;m+=16)n=d,i=h,o=f,u=p,d=s(d,h,f,p,e[m+0],7,-680876936),p=s(p,d,h,f,e[m+1],12,-389564586),f=s(f,p,d,h,e[m+2],17,606105819),h=s(h,f,p,d,e[m+3],22,-1044525330),d=s(d,h,f,p,e[m+4],7,-176418897),p=s(p,d,h,f,e[m+5],12,1200080426),f=s(f,p,d,h,e[m+6],17,-1473231341),h=s(h,f,p,d,e[m+7],22,-45705983),d=s(d,h,f,p,e[m+8],7,1770035416),p=s(p,d,h,f,e[m+9],12,-1958414417),f=s(f,p,d,h,e[m+10],17,-42063),h=s(h,f,p,d,e[m+11],22,-1990404162),d=s(d,h,f,p,e[m+12],7,1804603682),p=s(p,d,h,f,e[m+13],12,-40341101),f=s(f,p,d,h,e[m+14],17,-1502002290),h=s(h,f,p,d,e[m+15],22,1236535329),d=a(d,h,f,p,e[m+1],5,-165796510),p=a(p,d,h,f,e[m+6],9,-1069501632),f=a(f,p,d,h,e[m+11],14,643717713),h=a(h,f,p,d,e[m+0],20,-373897302),d=a(d,h,f,p,e[m+5],5,-701558691),p=a(p,d,h,f,e[m+10],9,38016083),f=a(f,p,d,h,e[m+15],14,-660478335),h=a(h,f,p,d,e[m+4],20,-405537848),d=a(d,h,f,p,e[m+9],5,568446438),p=a(p,d,h,f,e[m+14],9,-1019803690),f=a(f,p,d,h,e[m+3],14,-187363961),h=a(h,f,p,d,e[m+8],20,1163531501),d=a(d,h,f,p,e[m+13],5,-1444681467),p=a(p,d,h,f,e[m+2],9,-51403784),f=a(f,p,d,h,e[m+7],14,1735328473),h=a(h,f,p,d,e[m+12],20,-1926607734),d=c(d,h,f,p,e[m+5],4,-378558),p=c(p,d,h,f,e[m+8],11,-2022574463),f=c(f,p,d,h,e[m+11],16,1839030562),h=c(h,f,p,d,e[m+14],23,-35309556),d=c(d,h,f,p,e[m+1],4,-1530992060),p=c(p,d,h,f,e[m+4],11,1272893353),f=c(f,p,d,h,e[m+7],16,-155497632),h=c(h,f,p,d,e[m+10],23,-1094730640),d=c(d,h,f,p,e[m+13],4,681279174),p=c(p,d,h,f,e[m+0],11,-358537222),f=c(f,p,d,h,e[m+3],16,-722521979),h=c(h,f,p,d,e[m+6],23,76029189),d=c(d,h,f,p,e[m+9],4,-640364487),p=c(p,d,h,f,e[m+12],11,-421815835),f=c(f,p,d,h,e[m+15],16,530742520),h=c(h,f,p,d,e[m+2],23,-995338651),d=l(d,h,f,p,e[m+0],6,-198630844),p=l(p,d,h,f,e[m+7],10,1126891415),f=l(f,p,d,h,e[m+14],15,-1416354905),h=l(h,f,p,d,e[m+5],21,-57434055),d=l(d,h,f,p,e[m+12],6,1700485571),p=l(p,d,h,f,e[m+3],10,-1894986606),f=l(f,p,d,h,e[m+10],15,-1051523),h=l(h,f,p,d,e[m+1],21,-2054922799),d=l(d,h,f,p,e[m+8],6,1873313359),p=l(p,d,h,f,e[m+15],10,-30611744),f=l(f,p,d,h,e[m+6],15,-1560198380),h=l(h,f,p,d,e[m+13],21,1309151649),d=l(d,h,f,p,e[m+4],6,-145523070),p=l(p,d,h,f,e[m+11],10,-1120210379),f=l(f,p,d,h,e[m+2],15,718787259),h=l(h,f,p,d,e[m+9],21,-343485551),d=r(d,n),h=r(h,i),f=r(f,o),p=r(p,u);return[d,h,f,p]},d={hexdigest:function(e){return function(e){for(var t="",n=0;n<4*e.length;n++)t+="0123456789abcdef".charAt(e[n>>2]>>n%4*8+4&15)+"0123456789abcdef".charAt(e[n>>2]>>n%4*8&15);return t}(u(i(e),8*e.length))},hash:function(e){return function(e){for(var t="",n=0;n<32*e.length;n+=8)t+=String.fromCharCode(e[n>>5]>>>n%32&255);return t}(u(i(e),8*e.length))}}},"./src/sha1.js":
/*!*********************!*\
  !*** ./src/sha1.js ***!
  \*********************/
/*! exports provided: default */function(e,t,n){"use strict";function r(e,t){e[t>>5]|=128<<24-t%32,e[15+(t+64>>9<<4)]=t;var n,r,s,l,u,d,h,f,p=new Array(80),m=1732584193,g=-271733879,v=-1732584194,b=271733878,y=-1009589776;for(n=0;n<e.length;n+=16){for(l=m,u=g,d=v,h=b,f=y,r=0;r<80;r++)p[r]=r<16?e[n+r]:c(p[r-3]^p[r-8]^p[r-14]^p[r-16],1),s=a(a(c(m,5),i(r,g,v,b)),a(a(y,p[r]),o(r))),y=b,b=v,v=c(g,30),g=m,m=s;m=a(m,l),g=a(g,u),v=a(v,d),b=a(b,h),y=a(y,f)}return[m,g,v,b,y]}function i(e,t,n,r){return e<20?t&n|~t&r:e<40?t^n^r:e<60?t&n|t&r|n&r:t^n^r}function o(e){return e<20?1518500249:e<40?1859775393:e<60?-1894007588:-899497514}function s(e,t){var n=l(e);n.length>16&&(n=r(n,8*e.length));for(var i=new Array(16),o=new Array(16),s=0;s<16;s++)i[s]=909522486^n[s],o[s]=1549556828^n[s];var a=r(i.concat(l(t)),512+8*t.length);return r(o.concat(a),672)}function a(e,t){var n=(65535&e)+(65535&t);return(e>>16)+(t>>16)+(n>>16)<<16|65535&n}function c(e,t){return e<<t|e>>>32-t}function l(e){for(var t=[],n=0;n<8*e.length;n+=8)t[n>>5]|=(255&e.charCodeAt(n/8))<<24-n%32;return t}function u(e){for(var t,n,r="",i=0;i<4*e.length;i+=3)for(t=(e[i>>2]>>8*(3-i%4)&255)<<16|(e[i+1>>2]>>8*(3-(i+1)%4)&255)<<8|e[i+2>>2]>>8*(3-(i+2)%4)&255,n=0;n<4;n++)8*i+6*n>32*e.length?r+="=":r+="ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789+/".charAt(t>>6*(3-n)&63);return r}function d(e){for(var t="",n=0;n<32*e.length;n+=8)t+=String.fromCharCode(e[n>>5]>>>24-n%32&255);return t}n.r(t),n.d(t,"default",function(){return h});var h={b64_hmac_sha1:function(e,t){return u(s(e,t))},b64_sha1:function(e){return u(r(l(e),8*e.length))},binb2str:d,core_hmac_sha1:s,str_hmac_sha1:function(e,t){return d(s(e,t))},str_sha1:function(e){return d(r(l(e),8*e.length))}}},"./src/strophe.js":
/*!************************!*\
  !*** ./src/strophe.js ***!
  \************************/
/*! exports provided: default */function(e,t,n){"use strict";n.r(t),function(e){var r=n(/*! core */"./src/core.js");n(/*! bosh */"./src/bosh.js"),n(/*! websocket */"./src/websocket.js");n.d(t,"default",function(){return r.default}),e.Strophe=r.default.Strophe,e.$build=r.default.$build,e.$iq=r.default.$iq,e.$msg=r.default.$msg,e.$pres=r.default.$pres}.call(this,n(/*! ./../node_modules/webpack/buildin/global.js */"./node_modules/webpack/buildin/global.js"))},"./src/utils.js":
/*!**********************!*\
  !*** ./src/utils.js ***!
  \**********************/
/*! exports provided: default */function(e,t,n){"use strict";function r(e){return(r="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e})(e)}n.r(t),n.d(t,"default",function(){return i});var i={utf16to8:function(e){var t,n,r="",i=e.length;for(t=0;t<i;t++)(n=e.charCodeAt(t))>=0&&n<=127?r+=e.charAt(t):n>2047?(r+=String.fromCharCode(224|n>>12&15),r+=String.fromCharCode(128|n>>6&63),r+=String.fromCharCode(128|n>>0&63)):(r+=String.fromCharCode(192|n>>6&31),r+=String.fromCharCode(128|n>>0&63));return r},addCookies:function(e){for(var t in e=e||{})if(Object.prototype.hasOwnProperty.call(e,t)){var n="",i="",o="",s=e[t],a="object"===r(s),c=escape(unescape(a?s.value:s));a&&(n=s.expires?";expires="+s.expires:"",i=s.domain?";domain="+s.domain:"",o=s.path?";path="+s.path:""),document.cookie=t+"="+c+n+i+o}}}},"./src/websocket.js":
/*!**************************!*\
  !*** ./src/websocket.js ***!
  \**************************/
/*! no exports provided */function(e,t,n){"use strict";n.r(t);var r=n(/*! core */"./src/core.js"),i=r.default.Strophe,o=r.default.$build;i.Websocket=function(e){this._conn=e,this.strip="wrapper";var t=e.service;if(0!==t.indexOf("ws:")&&0!==t.indexOf("wss:")){var n="";"ws"===e.options.protocol&&"https:"!==window.location.protocol?n+="ws":n+="wss",n+="://"+window.location.host,0!==t.indexOf("/")?n+=window.location.pathname+t:n+=t,e.service=n}},i.Websocket.prototype={_buildStream:function(){return o("open",{xmlns:i.NS.FRAMING,to:this._conn.domain,version:"1.0"})},_check_streamerror:function(e,t){var n;if(0===(n=e.getElementsByTagNameNS?e.getElementsByTagNameNS(i.NS.STREAM,"error"):e.getElementsByTagName("stream:error")).length)return!1;for(var r=n[0],o="",s="",a=0;a<r.childNodes.length;a++){var c=r.childNodes[a];if("urn:ietf:params:xml:ns:xmpp-streams"!==c.getAttribute("xmlns"))break;"text"===c.nodeName?s=c.textContent:o=c.nodeName}var l="WebSocket stream error: ";return l+=o||"unknown",s&&(l+=" - "+s),i.error(l),this._conn._changeConnectStatus(t,o),this._conn._doDisconnect(),!0},_reset:function(){},_connect:function(){this._closeSocket(),this.socket=new WebSocket(this._conn.service,"xmpp"),this.socket.onopen=this._onOpen.bind(this),this.socket.onerror=this._onError.bind(this),this.socket.onclose=this._onClose.bind(this),this.socket.onmessage=this._connect_cb_wrapper.bind(this)},_connect_cb:function(e){if(this._check_streamerror(e,i.Status.CONNFAIL))return i.Status.CONNFAIL},_handleStreamStart:function(e){var t=!1,n=e.getAttribute("xmlns");"string"!=typeof n?t="Missing xmlns in <open />":n!==i.NS.FRAMING&&(t="Wrong xmlns in <open />: "+n);var r=e.getAttribute("version");return"string"!=typeof r?t="Missing version in <open />":"1.0"!==r&&(t="Wrong version in <open />: "+r),!t||(this._conn._changeConnectStatus(i.Status.CONNFAIL,t),this._conn._doDisconnect(),!1)},_connect_cb_wrapper:function(e){if(0===e.data.indexOf("<open ")||0===e.data.indexOf("<?xml")){var t=e.data.replace(/^(<\?.*?\?>\s*)*/,"");if(""===t)return;var n=(new DOMParser).parseFromString(t,"text/xml").documentElement;this._conn.xmlInput(n),this._conn.rawInput(e.data),this._handleStreamStart(n)&&this._connect_cb(n)}else if(0===e.data.indexOf("<close ")){var r=(new DOMParser).parseFromString(e.data,"text/xml").documentElement;this._conn.xmlInput(r),this._conn.rawInput(e.data);var o=r.getAttribute("see-other-uri");if(o){var s=this._conn.service;(s.indexOf("wss:")>=0&&o.indexOf("wss:")>=0||s.indexOf("ws:")>=0)&&(this._conn._changeConnectStatus(i.Status.REDIRECT,"Received see-other-uri, resetting connection"),this._conn.reset(),this._conn.service=o,this._connect())}else this._conn._changeConnectStatus(i.Status.CONNFAIL,"Received closing stream"),this._conn._doDisconnect()}else{var a=this._streamWrap(e.data),c=(new DOMParser).parseFromString(a,"text/xml").documentElement;this.socket.onmessage=this._onMessage.bind(this),this._conn._connect_cb(c,null,e.data)}},_disconnect:function(e){if(this.socket&&this.socket.readyState!==WebSocket.CLOSED){e&&this._conn.send(e);var t=o("close",{xmlns:i.NS.FRAMING});this._conn.xmlOutput(t.tree());var n=i.serialize(t);this._conn.rawOutput(n);try{this.socket.send(n)}catch(e){i.info("Couldn't send <close /> tag.")}}this._conn._doDisconnect()},_doDisconnect:function(){i.info("WebSockets _doDisconnect was called"),this._closeSocket()},_streamWrap:function(e){return"<wrapper>"+e+"</wrapper>"},_closeSocket:function(){if(this.socket)try{this.socket.onerror=null,this.socket.close()}catch(e){i.debug(e.message)}this.socket=null},_emptyQueue:function(){return!0},_onClose:function(e){this._conn.connected&&!this._conn.disconnecting?(i.error("Websocket closed unexpectedly"),this._conn._doDisconnect()):e&&1006===e.code&&!this._conn.connected&&this.socket?(i.error("Websocket closed unexcectedly"),this._conn._changeConnectStatus(i.Status.CONNFAIL,"The WebSocket connection could not be established or was disconnected."),this._conn._doDisconnect()):i.info("Websocket closed")},_no_auth_received:function(e){i.error("Server did not offer a supported authentication mechanism"),this._changeConnectStatus(i.Status.CONNFAIL,i.ErrorCondition.NO_AUTH_MECH),e&&e.call(this._conn),this._conn._doDisconnect()},_onDisconnectTimeout:function(){},_abortAllRequests:function(){},_onError:function(e){i.error("Websocket error "+e),this._conn._changeConnectStatus(i.Status.CONNFAIL,"The WebSocket connection could not be established or was disconnected."),this._disconnect()},_onIdle:function(){var e=this._conn._data;if(e.length>0&&!this._conn.paused){for(var t=0;t<e.length;t++)if(null!==e[t]){var n=void 0;n="restart"===e[t]?this._buildStream().tree():e[t];var r=i.serialize(n);this._conn.xmlOutput(n),this._conn.rawOutput(r),this.socket.send(r)}this._conn._data=[]}},_onMessage:function(e){var t,n='<close xmlns="urn:ietf:params:xml:ns:xmpp-framing" />';if(e.data===n)return this._conn.rawInput(n),this._conn.xmlInput(e),void(this._conn.disconnecting||this._conn._doDisconnect());if(0===e.data.search("<open ")){if(t=(new DOMParser).parseFromString(e.data,"text/xml").documentElement,!this._handleStreamStart(t))return}else{var r=this._streamWrap(e.data);t=(new DOMParser).parseFromString(r,"text/xml").documentElement}return this._check_streamerror(t,i.Status.ERROR)?void 0:this._conn.disconnecting&&"presence"===t.firstChild.nodeName&&"unavailable"===t.firstChild.getAttribute("type")?(this._conn.xmlInput(t),void this._conn.rawInput(i.serialize(t))):void this._conn._dataRecv(t,e.data)},_onOpen:function(){i.info("Websocket open");var e=this._buildStream();this._conn.xmlOutput(e.tree());var t=i.serialize(e);this._conn.rawOutput(t),this.socket.send(t)},_reqToData:function(e){return e},_send:function(){this._conn.flush()},_sendRestart:function(){clearTimeout(this._conn._idleTimeout),this._conn._onIdle.bind(this._conn)()}}}}).default},e.exports=r()},function(e,t,n){var r=n(1).chatProtocol,i=n(0);e.exports=function(){var e=1===r.active?r.bosh:r.websocket,t=new Strophe.Connection(e);return 1===r.active?(t.xmlInput=function(e){if(e.childNodes[0])for(var t=0,n=e.childNodes.length;t<n;t++)i.DLog("[Chat]","RECV:",e.childNodes[t])},t.xmlOutput=function(e){if(e.childNodes[0])for(var t=0,n=e.childNodes.length;t<n;t++)i.DLog("[Chat]","SENT:",e.childNodes[t])}):(t.xmlInput=function(e){i.DLog("[Chat]","RECV:",e)},t.xmlOutput=function(e){i.DLog("[Chat]","SENT:",e)}),t}},function(e,t,n){var r=n(23),i=n(24);t.write=i,t.parse=r.parse,t.parseFmtpConfig=r.parseFmtpConfig,t.parseParams=r.parseParams,t.parsePayloads=r.parsePayloads,t.parseRemoteCandidates=r.parseRemoteCandidates,t.parseImageAttributes=r.parseImageAttributes,t.parseSimulcastStreamList=r.parseSimulcastStreamList},function(e,t,n){var r=function(e){return String(Number(e))===e?Number(e):e},i=function(e,t,n){var i=e.name&&e.names;e.push&&!t[e.push]?t[e.push]=[]:i&&!t[e.name]&&(t[e.name]={});var o=e.push?{}:i?t[e.name]:t;!function(e,t,n,i){if(i&&!n)t[i]=r(e[1]);else for(var o=0;o<n.length;o+=1)null!=e[o+1]&&(t[n[o]]=r(e[o+1]))}(n.match(e.reg),o,e.names,e.name),e.push&&t[e.push].push(o)},o=n(9),s=RegExp.prototype.test.bind(/^([a-z])=(.*)/);t.parse=function(e){var t={},n=[],r=t;return e.split(/(\r\n|\r|\n)/).filter(s).forEach(function(e){var t=e[0],s=e.slice(2);"m"===t&&(n.push({rtp:[],fmtp:[]}),r=n[n.length-1]);for(var a=0;a<(o[t]||[]).length;a+=1){var c=o[t][a];if(c.reg.test(s))return i(c,r,s)}}),t.media=n,t};var a=function(e,t){var n=t.split(/=(.+)/,2);return 2===n.length?e[n[0]]=r(n[1]):1===n.length&&t.length>1&&(e[n[0]]=void 0),e};t.parseParams=function(e){return e.split(/\;\s?/).reduce(a,{})},t.parseFmtpConfig=t.parseParams,t.parsePayloads=function(e){return e.split(" ").map(Number)},t.parseRemoteCandidates=function(e){for(var t=[],n=e.split(" ").map(r),i=0;i<n.length;i+=3)t.push({component:n[i],ip:n[i+1],port:n[i+2]});return t},t.parseImageAttributes=function(e){return e.split(" ").map(function(e){return e.substring(1,e.length-1).split(",").reduce(a,{})})},t.parseSimulcastStreamList=function(e){return e.split(";").map(function(e){return e.split(",").map(function(e){var t,n=!1;return"~"!==e[0]?t=r(e):(t=r(e.substring(1,e.length)),n=!0),{scid:t,paused:n}})})}},function(e,t,n){var r=n(9),i=/%[sdv%]/g,o=function(e,t,n){var r=[e+"="+(t.format instanceof Function?t.format(t.push?n:n[t.name]):t.format)];if(t.names)for(var o=0;o<t.names.length;o+=1){var s=t.names[o];t.name?r.push(n[t.name][s]):r.push(n[t.names[o]])}else r.push(n[t.name]);return function(e){var t=1,n=arguments,r=n.length;return e.replace(i,function(e){if(t>=r)return e;var i=n[t];switch(t+=1,e){case"%%":return"%";case"%s":return String(i);case"%d":return Number(i);case"%v":return""}})}.apply(null,r)},s=["v","o","s","i","u","e","p","c","b","t","r","z","a"],a=["i","c","b","a"];e.exports=function(e,t){t=t||{},null==e.version&&(e.version=0),null==e.name&&(e.name=" "),e.media.forEach(function(e){null==e.payloads&&(e.payloads="")});var n=t.outerOrder||s,i=t.innerOrder||a,c=[];return n.forEach(function(t){r[t].forEach(function(n){n.name in e&&null!=e[n.name]?c.push(o(t,n,e)):n.push in e&&null!=e[n.push]&&e[n.push].forEach(function(e){c.push(o(t,n,e))})})}),e.media.forEach(function(e){c.push(o("m",r.m[0],e)),i.forEach(function(t){r[t].forEach(function(n){n.name in e&&null!=e[n.name]?c.push(o(t,n,e)):n.push in e&&null!=e[n.push]&&e[n.push].forEach(function(e){c.push(o(t,n,e))})})})}),c.join("\r\n")+"\r\n"}},function(t,n){t.exports=e},function(e,n){e.exports=t},function(e,t){e.exports=n},function(e,t){e.exports=r},function(e,t,n){function r(e){return(r="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e})(e)}var i=n(1),o=n(0),s=n(30),a=n(32);function c(e){this.service=e,this.webSessionCheckInterval=null}c.prototype={getSession:function(e){var t={url:o.getUrl(i.urls.session)};this.service.ajax(t,function(t,n){e(t,n&&n.session)})},createSession:function(e,t){if(""===i.creds.appId||""===i.creds.authKey||""===i.creds.authSecret)throw new Error("Cannot create a new session without app credentials (app ID, auth key and auth secret)");var n,c=this,l=i.urls.session;"function"==typeof e&&void 0===t&&(t=e,e={}),e.hasOwnProperty("long")&&(l=i.urls.webSession),(n=function(e){var t={application_id:i.creds.appId,auth_key:i.creds.authKey,nonce:o.randomNonce(),timestamp:o.unixTime()};e.login&&e.password?t.user={login:e.login,password:e.password}:e.email&&e.password?t.user={email:e.email,password:e.password}:e.provider?(t.provider=e.provider,e.scope&&(t.scope=e.scope),e.keys&&e.keys.token&&(t.keys={token:e.keys.token}),e.keys&&e.keys.secret&&(t.keys.secret=e.keys.secret)):e.hasOwnProperty("long")&&(t.long=e.long);return t}(e)).signature=function(e,t){var n,o=Object.keys(e).map(function(t){return"object"===r(e[t])?Object.keys(e[t]).map(function(n){return t+"["+n+"]="+e[t][n]}).sort().join("&"):t+"="+e[t]}).sort().join("&");if("sha1"===i.hash)n=s(o,t).toString();else{if("sha256"!==i.hash)throw new Error("Unknown crypto standards, available sha1 or sha256");n=a(o,t).toString()}return n}(n,i.creds.authSecret);var u={url:o.getUrl(l),type:"POST",data:n};this.service.ajax(u,function(e,n){if(e)t(e,null);else{var r=n.qr_code?n.qr_code:n.session;c.service.setSession(n.session),c.service.setCurrentUserId(n.session.user_id),t(null,r)}})},destroySession:function(e){var t=this,n={url:o.getUrl(i.urls.session),type:"DELETE",dataType:"text"};this.service.ajax(n,function(n,r){n?e(n,null):(t.service.setSession(null),e(null)),t.service.setCurrentUserId(null)})},createWebSession:function(e,t){"function"==typeof e&&void 0===t&&(t=e,e={long:0}),this.createSession(e,function(e,n){t(e,n)})},checkWebSessionUntilUpgrade:function(e){var t=this,n=i.webSession.getSessionTimeInterval,r=new Error("The web session check interval was stopped (timeout)"),o=i.webSession.getSessionTimeout;function s(){t.webSessionCheckInterval&&clearInterval(t.webSessionCheckInterval)}return s(),t.webSessionCheckInterval=setInterval(function(){t.getSession(function(i,a){if(i)s(),e(i,null);else if(0!==a.user_id)s(),t.service.setCurrentUserId(a.user_id),t.service.setSession(a),e(null,a);else{if(!(o>n))throw s(),e(r,null),r;o-=n}})},1e3*n),t.webSessionCheckInterval},upgradeWebSession:function(e,t){var n={url:o.getUrl(i.urls.webSession),type:"PATCH",dataType:"text",data:{web_token:e}};this.service.ajax(n,function(e){e&&t(e)})},login:function(e,t){var n=this,r={type:"POST",url:o.getUrl(i.urls.login),data:e};this.service.ajax(r,function(e,r){e?t(e,null):(n.service.setCurrentUserId(r.user.id),t(null,r.user))})},logout:function(e){var t={url:o.getUrl(i.urls.login),type:"DELETE",dataType:"text"};this.service.ajax(t,e),this.service.setCurrentUserId(null)}},e.exports=c},function(e,t,n){var r;e.exports=(r=n(4),n(31),n(10),r.HmacSHA1)},function(e,t,n){var r,i,o,s,a,c,l,u;e.exports=(r=n(4),o=(i=r).lib,s=o.WordArray,a=o.Hasher,c=i.algo,l=[],u=c.SHA1=a.extend({_doReset:function(){this._hash=new s.init([1732584193,4023233417,2562383102,271733878,3285377520])},_doProcessBlock:function(e,t){for(var n=this._hash.words,r=n[0],i=n[1],o=n[2],s=n[3],a=n[4],c=0;c<80;c++){if(c<16)l[c]=0|e[t+c];else{var u=l[c-3]^l[c-8]^l[c-14]^l[c-16];l[c]=u<<1|u>>>31}var d=(r<<5|r>>>27)+a+l[c];d+=c<20?1518500249+(i&o|~i&s):c<40?1859775393+(i^o^s):c<60?(i&o|i&s|o&s)-1894007588:(i^o^s)-899497514,a=s,s=o,o=i<<30|i>>>2,i=r,r=d}n[0]=n[0]+r|0,n[1]=n[1]+i|0,n[2]=n[2]+o|0,n[3]=n[3]+s|0,n[4]=n[4]+a|0},_doFinalize:function(){var e=this._data,t=e.words,n=8*this._nDataBytes,r=8*e.sigBytes;return t[r>>>5]|=128<<24-r%32,t[14+(r+64>>>9<<4)]=Math.floor(n/4294967296),t[15+(r+64>>>9<<4)]=n,e.sigBytes=4*t.length,this._process(),this._hash},clone:function(){var e=a.clone.call(this);return e._hash=this._hash.clone(),e}}),i.SHA1=a._createHelper(u),i.HmacSHA1=a._createHmacHelper(u),r.SHA1)},function(e,t,n){var r;e.exports=(r=n(4),n(33),n(10),r.HmacSHA256)},function(e,t,n){var r;e.exports=(r=n(4),function(e){var t=r,n=t.lib,i=n.WordArray,o=n.Hasher,s=t.algo,a=[],c=[];!function(){function t(t){for(var n=e.sqrt(t),r=2;r<=n;r++)if(!(t%r))return!1;return!0}function n(e){return 4294967296*(e-(0|e))|0}for(var r=2,i=0;i<64;)t(r)&&(i<8&&(a[i]=n(e.pow(r,.5))),c[i]=n(e.pow(r,1/3)),i++),r++}();var l=[],u=s.SHA256=o.extend({_doReset:function(){this._hash=new i.init(a.slice(0))},_doProcessBlock:function(e,t){for(var n=this._hash.words,r=n[0],i=n[1],o=n[2],s=n[3],a=n[4],u=n[5],d=n[6],h=n[7],f=0;f<64;f++){if(f<16)l[f]=0|e[t+f];else{var p=l[f-15],m=(p<<25|p>>>7)^(p<<14|p>>>18)^p>>>3,g=l[f-2],v=(g<<15|g>>>17)^(g<<13|g>>>19)^g>>>10;l[f]=m+l[f-7]+v+l[f-16]}var b=r&i^r&o^i&o,y=(r<<30|r>>>2)^(r<<19|r>>>13)^(r<<10|r>>>22),S=h+((a<<26|a>>>6)^(a<<21|a>>>11)^(a<<7|a>>>25))+(a&u^~a&d)+c[f]+l[f];h=d,d=u,u=a,a=s+S|0,s=o,o=i,i=r,r=S+(y+b)|0}n[0]=n[0]+r|0,n[1]=n[1]+i|0,n[2]=n[2]+o|0,n[3]=n[3]+s|0,n[4]=n[4]+a|0,n[5]=n[5]+u|0,n[6]=n[6]+d|0,n[7]=n[7]+h|0},_doFinalize:function(){var t=this._data,n=t.words,r=8*this._nDataBytes,i=8*t.sigBytes;return n[i>>>5]|=128<<24-i%32,n[14+(i+64>>>9<<4)]=e.floor(r/4294967296),n[15+(i+64>>>9<<4)]=r,t.sigBytes=4*n.length,this._process(),this._hash},clone:function(){var e=o.clone.call(this);return e._hash=this._hash.clone(),e}});t.SHA256=o._createHelper(u),t.HmacSHA256=o._createHmacHelper(u)}(Math),r.SHA256)},function(e,t,n){function r(e){return(r="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e})(e)}var i=n(1),o=n(0),s=["created_at","updated_at","last_request_at"],a=["id","external_user_id"],c=i.urls.users+"/password/reset";function l(e){this.service=e}function u(e){var t=e.field in s?"date":r(e.value);return o.isArray(e.value)&&("object"===t&&(t=r(e.value[0])),e.value=e.value.toString()),[t,e.field,e.param,e.value].join(" ")}l.prototype={get:function(e,t){var n,r,c,l,d=[];e.order&&(e.order=(c=e.order,l=c.field in s?"date":c.field in a?"number":"string",[c.sort,l,c.field].join(" "))),e&&e.filter&&(o.isArray(e.filter)?e.filter.forEach(function(e){r=u(e),d.push(r)}):(r=u(e.filter),d.push(r)),e.filter=d),"number"==typeof e?(n=e,e={}):e.login?n="by_login":e.full_name?n="by_full_name":e.facebook_id?n="by_facebook_id":e.twitter_id?n="by_twitter_id":e.phone?n="phone":e.email?n="by_email":e.tags?n="by_tags":e.external&&(n="external/"+e.external,e={});var h={url:o.getUrl(i.urls.users,n),data:e};this.service.ajax(h,function(e,n){e?t(e,null):t(null,n.user||n)})},signup:function(e,t){var n={url:o.getUrl(i.urls.users),type:"POST",data:{user:e}};this.service.ajax(n,function(e,n){e?t(e,null):t(null,n.user)})},update:function(e,t){var n={url:o.getUrl(i.urls.users,this.service.getCurrentUserId()),type:"PUT",data:{user:e}};this.service.ajax(n,function(e,n){e?t(e,null):t(null,n.user)})},delete:function(e){var t={url:o.getUrl(i.urls.users,this.service.getCurrentUserId()),type:"DELETE",dataType:"text"};this.service.ajax(t,e)},resetPassword:function(e,t){var n={url:o.getUrl(c),data:{email:e},dataType:"text"};this.service.ajax(n,t)}},e.exports=l},function(e,t,n){var r=n(1),i=n(0);function o(e){this.service=e}function s(e){for(var t=s.options,n=t.parser[t.strictMode?"strict":"loose"].exec(e),r={},i=14;i--;)r[t.key[i]]=n[i]||"";return r[t.q.name]={},r[t.key[12]].replace(t.q.parser,function(e,n,i){n&&(r[t.q.name][n]=i)}),r}o.prototype={list:function(e,t){"function"==typeof e&&void 0===t&&(t=e,e=null);var n={url:i.getUrl(r.urls.blobs),data:e,type:"GET"};this.service.ajax(n,function(e,n){t(e,e?null:n)})},create:function(e,t){var n={type:"POST",data:{blob:e},url:i.getUrl(r.urls.blobs)};this.service.ajax(n,function(e,n){t(e,e?null:n.blob)})},delete:function(e,t){var n={url:i.getUrl(r.urls.blobs,e),type:"DELETE",dataType:"text"};this.service.ajax(n,function(e,n){e?t(e,null):t(null,!0)})},createAndUpload:function(e,t){var n,r,i,o,a,c=this,l={};JSON.parse(JSON.stringify(e)).file.data="...",n=e.file,r=e.name||n.name,i=e.type||n.type,o=e.size||n.size,l.name=r,l.content_type=i,e.public&&(l.public=e.public),e.tag_list&&(l.tag_list=e.tag_list),this.create(l,function(e,r){if(e)t(e,null);else{var i=s(r.blob_object_access.params),l={url:i.protocol+"://"+i.authority+i.path},u={};a=r.id,r.size=o,Object.keys(i.queryKey).forEach(function(e){u[e]=decodeURIComponent(i.queryKey[e])}),u.file=n,l.data=u,c.upload(l,function(e,n){if(e)t(e,null);else{var i={id:a,size:o};c.markUploaded(i,function(e,n){e?t(e,null):t(null,r)})}})}})},upload:function(e,t){var n={type:"POST",dataType:"text",contentType:!1,url:e.url,data:e.data};this.service.ajax(n,function(e,n){e?t(e,null):t(null,{})})},markUploaded:function(e,t){var n={url:i.getUrl(r.urls.blobs,e.id+"/complete"),type:"PUT",data:{size:e.size},dataType:"text"};this.service.ajax(n,function(e,n){e?t(e,null):t(null,n)})},getInfo:function(e,t){var n={url:i.getUrl(r.urls.blobs,e)};this.service.ajax(n,function(e,n){e?t(e,null):t(null,n)})},getFile:function(e,t){var n={url:i.getUrl(r.urls.blobs,e)};this.service.ajax(n,function(e,n){e?t(e,null):t(null,n)})},update:function(e,t){var n={blob:{}};void 0!==e.name&&(n.blob.name=e.name);var o={url:i.getUrl(r.urls.blobs,e.id),data:n};this.service.ajax(o,function(e,n){e?t(e,null):t(null,n)})},privateUrl:function(e){return"https://"+r.endpoints.api+"/blobs/"+e+"?token="+this.service.getSession().token},publicUrl:function(e){return"https://"+r.endpoints.api+"/blobs/"+e}},e.exports=o,s.options={strictMode:!1,key:["source","protocol","authority","userInfo","user","password","host","port","relative","path","directory","file","query","anchor"],q:{name:"queryKey",parser:/(?:^|&)([^&=]*)=?([^&]*)/g},parser:{strict:/^(?:([^:\/?#]+):)?(?:\/\/((?:(([^:@]*)(?::([^:@]*))?)?@)?([^:\/?#]*)(?::(\d*))?))?((((?:[^?#\/]*\/)*)([^?#]*))(?:\?([^#]*))?(?:#(.*))?)/,loose:/^(?:(?![^:@]+:[^:@\/]*@)([^:\/?#.]+):)?(?:\/\/)?((?:(([^:@]*)(?::([^:@]*))?)?@)?([^:\/?#]*)(?::(\d*))?)(((\/(?:[^?#](?![^?#\/]*\.[^?#\/.]+(?:[?#]|$)))*\/?)?([^?#\/]*))(?:\?([^#]*))?(?:#(.*))?)/}}},function(e,t,n){var r=n(1),i=n(0);function o(e){this.service=e}function s(e){this.service=e}o.prototype={create:function(e,t){var n={url:i.getUrl(r.urls.subscriptions),type:"POST",data:e};this.service.ajax(n,t)},list:function(e){var t={url:i.getUrl(r.urls.subscriptions)};this.service.ajax(t,e)},delete:function(e,t){var n={type:"DELETE",dataType:"text",url:i.getUrl(r.urls.subscriptions,e)};this.service.ajax(n,function(e,n){t(e||null)})}},s.prototype={create:function(e,t){var n={url:i.getUrl(r.urls.events),type:"POST",contentType:"application/json; charset=utf-8",isNeedStringify:!0,data:{event:e}};this.service.ajax(n,t)},list:function(e,t){"function"==typeof e&&void 0===t&&(t=e,e=null);var n={url:i.getUrl(r.urls.events),data:e};this.service.ajax(n,t)},get:function(e,t){var n={url:i.getUrl(r.urls.events,e)};this.service.ajax(n,t)},delete:function(e,t){var n={url:i.getUrl(r.urls.events,e),dataType:"text",type:"DELETE"};this.service.ajax(n,t)},status:function(e,t){var n={url:i.getUrl(r.urls.events,e+"/status")};this.service.ajax(n,t)}},e.exports=function(e){this.service=e,this.subscriptions=new o(e),this.events=new s(e),this.base64Encode=function(e){return i.toBase64(e)}}},function(e,t,n){var r=n(1),i=n(0);function o(e){this.service=e}o.prototype={create:function(e,t,n){var o={type:"POST",data:t,isNeedStringify:!0,contentType:"application/json; charset=utf-8",url:i.getUrl(r.urls.data,e)};this.service.ajax(o,function(e,t){n(e,e?null:t)})},list:function(e,t,n){void 0===n&&"function"==typeof t&&(n=t,t=null),this.service.ajax({url:i.getUrl(r.urls.data,e),data:t},function(e,t){n(e,e?null:t)})},update:function(e,t,n){var o={url:i.getUrl(r.urls.data,e+"/"+t._id),type:"PUT",contentType:"application/json; charset=utf-8",isNeedStringify:!0,data:t};this.service.ajax(o,function(e,t){n(e,e?null:t)})},delete:function(e,t,n){var o,s={id:1,ids:2,criteria:3},a={deleted:[],deletedCount:0},c={type:"DELETE",dataType:"text"};"string"==typeof t?o=s.id:i.isArray(t)?o=s.ids:i.isObject(t)&&(o=s.criteria),o===s.id?c.url=i.getUrl(r.urls.data,e+"/"+t):o===s.ids?c.url=i.getUrl(r.urls.data,e+"/"+t.toString()):o===s.criteria&&(c.url=i.getUrl(r.urls.data,e+"/by_criteria"),c.data=t),this.service.ajax(c,function(e,r){var i;e?n(e,null):(o===s.id?(a.deleted.push(t),a.deletedCount=a.deleted.length):o===s.ids?(i=JSON.parse(r),a.deleted=i.SuccessfullyDeleted.ids.slice(0),a.deletedCount=a.deleted.length):o===s.criteria&&(i=JSON.parse(r),a.deleted=null,a.deletedCount=i.total_deleted),n(e,a))})},uploadFile:function(e,t,n){var o={url:i.getUrl(r.urls.data,e+"/"+t.id+"/file"),type:"POST",fileToCustomObject:!0,contentType:!1,data:{field_name:t.field_name,file:{data:t.file,name:t.name}}};this.service.ajax(o,function(e,t){n(e,e?null:t)})},downloadFile:function(e,t,n){n(null,this.fileUrl(e,t))},fileUrl:function(e,t){var n=i.getUrl(r.urls.data,e+"/"+t.id+"/file");return n+="?field_name="+t.field_name+"&token="+this.service.getSession().token},deleteFile:function(e,t,n){var o={url:i.getUrl(r.urls.data,e+"/"+t.id+"/file"),data:{field_name:t.field_name},dataType:"text",type:"DELETE"};this.service.ajax(o,function(e,t){n(e,!e||null)})}},e.exports=o},function(e,t,n){var r=n(0),i=n(1);function o(e){this.service=e}function s(e){var t=e.detail?e.detail:e.message.errors;return 404===e.code&&"Empty address book"===t[0]}o.prototype={uploadAddressBook:function(e,t,n){if(r.isArray(e)){var o,s;r.isFunction(t)?s=t:(o=t,s=n);var a={contacts:e};o&&(o.force&&(a.force=o.force),o.udid&&(a.udid=o.udid));var c={type:"POST",url:r.getUrl(i.urls.addressbook),data:a,contentType:"application/json; charset=utf-8",isNeedStringify:!0};this.service.ajax(c,function(e,t){e?s(e,null):s(null,t)})}else new Error("First parameter must be an Array.")},get:function(e,t){var n,o;if(r.isFunction(e)?o=e:(n=e,o=t),!r.isFunction(o))throw new Error("A callback function is required.");var a={type:"GET",url:r.getUrl(i.urls.addressbook),contentType:"application/json; charset=utf-8",isNeedStringify:!0};n&&(a.data={udid:n}),this.service.ajax(a,function(e,t){e?s(e)?o(null,[]):o(e,null):o(null,t)})},getRegisteredUsers:function(e,t){var n,o;if(r.isFunction(e)?o=e:(n=e,o=t),!r.isFunction(o))throw new Error("A callback function is required.");var a={type:"GET",url:r.getUrl(i.urls.addressbookRegistered),contentType:"application/json; charset=utf-8"};n&&(a.data={compact:1}),this.service.ajax(a,function(e,t){e?s(e)?o(null,[]):o(e,null):o(null,t)})}},e.exports=o},function(e,t,n){"use strict";var r=n(1),i=n(0),o=n(3),s=n(40),a=n(41),c=n(42),l=n(43),u=n(44),d=n(2).XMPPClient;function h(e){var t=this;if(t.webrtcSignalingProcessor=null,i.getEnv().browser)t.xmppClient=new d,t.xmppClient.XHandlerReferences=[],t.xmppClient.XAddTrackedHandler=function(e,n,r,i,o,s,a){t.xmppClient.XHandlerReferences.push(t.xmppClient.addHandler(e,n,r,i,o,s,a))},t.xmppClient.XDeleteHandlers=function(){for(;t.xmppClient.XHandlerReferences.length;)t.xmppClient.deleteHandler(t.xmppClient.XHandlerReferences.pop())};else{if(i.getEnv().nativescript?t.xmppClient=new d.Client({websocket:{url:r.chatProtocol.websocket},autostart:!1}):i.getEnv().node?t.xmppClient=new d({autostart:!1}):i.getEnv().reactnative&&(t.xmppClient=d.client({service:r.chatProtocol.websocket,credentials:function(e,n){return e({username:t.xmppClient.cbUserName,password:t.xmppClient.cbUserPassword})}})),i.getEnv().node||i.getEnv().nativescript){var n=t.xmppClient.send;t.xmppClient.send=function(e){i.DLog("[Chat]","SENT:",e.toString()),n.call(t.xmppClient,e)}}t.nodeStanzasCallbacks={}}this.service=e,this.isConnected=!1,this._isConnecting=!1,this._isLogout=!1,this._checkConnectionTimer=void 0,this.helpers=new s,this.xmppClientListeners=[];var h={xmppClient:t.xmppClient,helpers:t.helpers,nodeStanzasCallbacks:t.nodeStanzasCallbacks};this.contactList=new c(h),this.privacylist=new l(h),this.muc=new u(h),r.chat.streamManagement.enable&&(2===r.chatProtocol.active?(this.streamManagement=new a,t._sentMessageCallback=function(e,n){"function"==typeof t.onSentMessageCallback&&(n?t.onSentMessageCallback(null,n):t.onSentMessageCallback(e))}):i.DLog("[Chat] StreamManagement:",'BOSH protocol doesn\'t support stream management. Set WebSocket as the "chatProtocol" parameter to use this functionality.')),this._onMessage=function(e){var n,r,s,a=o.getAttr(e,"from"),c=o.getAttr(e,"type"),l=o.getAttr(e,"id"),u=o.getElement(e,"markable"),d=o.getElement(e,"received"),h=o.getElement(e,"displayed"),f=o.getElement(e,"composing"),p=o.getElement(e,"paused"),m=o.getElement(e,"invite"),g=o.getElement(e,"delay"),v=o.getElement(e,"extraParams"),b=o.getElementText(e,"body"),y=o.getElement(e,"forwarded"),S=y?o.getElement(y,"message"):null;r=(s=S?o.getAttr(S,"to"):null)?t.helpers.getIdFromNode(s):null;var C="groupchat"===c?t.helpers.getDialogIdFromNode(a):null,_="groupchat"===c?t.helpers.getIdFromResource(a):t.helpers.getIdFromNode(a),w=d||h||null;if(m)return!0;if(v&&(n=o.parseExtraParams(v)).dialogId&&(C=n.dialogId),f||p)return"function"!=typeof t.onMessageTypingListener||"chat"!==c&&"groupchat"!==c&&g||i.safeCallbackCall(t.onMessageTypingListener,!!f,_,C),!0;if(w)return d?"function"==typeof t.onDeliveredStatusListener&&"chat"===c&&i.safeCallbackCall(t.onDeliveredStatusListener,o.getAttr(d,"id"),C,_):"function"==typeof t.onReadStatusListener&&"chat"===c&&i.safeCallbackCall(t.onReadStatusListener,o.getAttr(h,"id"),C,_),!0;if(u&&_!=t.helpers.getIdFromNode(t.helpers.userCurrentJid(t.xmppClient))){var T={messageId:l,userId:_,dialogId:C};t.sendDeliveredStatus(T)}var x={id:l,dialog_id:C,recipient_id:r,type:c,body:b,extension:n?n.extension:null,delay:g};return u&&(x.markable=1),"function"!=typeof t.onMessageListener||"chat"!==c&&"groupchat"!==c||i.safeCallbackCall(t.onMessageListener,_,x),!0},this._onPresence=function(e){var n,r,s,a,c,l,u=o.getAttr(e,"from"),d=o.getAttr(e,"id"),h=o.getAttr(e,"type"),f=t.helpers.getIdFromNode(t.helpers.userCurrentJid(t.xmppClient)),p=o.getElement(e,"x");if(p&&(n=o.getAttr(p,"xmlns"),(r=o.getElement(p,"status"))&&(s=o.getAttr(r,"code"))),n&&"http://jabber.org/protocol/muc#user"==n){if(a=t.helpers.getDialogIdFromNode(u),c=t.helpers.getUserIdFromRoomJid(u),r&&"301"==s){if("function"==typeof t.onKickOccupant){var m=o.getElement(o.getElement(p,"item"),"actor"),g=o.getAttr(m,"jid");i.safeCallbackCall(t.onKickOccupant,a,t.helpers.getIdFromNode(g))}return delete t.muc.joinedRooms[t.helpers.getRoomJidFromRoomFullJid(u)],!0}if(!r&&c!=f)return h&&"unavailable"===h?("function"==typeof t.onLeaveOccupant&&i.safeCallbackCall(t.onLeaveOccupant,a,parseInt(c)),!0):("function"==typeof t.onJoinOccupant&&i.safeCallbackCall(t.onJoinOccupant,a,parseInt(c)),!0)}if(!i.getEnv().browser&&n)if("http://jabber.org/protocol/muc#user"==n){if(h&&"unavailable"===h)return r&&"110"==s&&"function"==typeof t.nodeStanzasCallbacks["muc:leave"]&&i.safeCallbackCall(t.nodeStanzasCallbacks["muc:leave"],null),!0;if(d.endsWith(":join")&&r&&"110"==s)return"function"==typeof t.nodeStanzasCallbacks[d]&&t.nodeStanzasCallbacks[d](e),!0}else if(h&&"error"===h&&"http://jabber.org/protocol/muc"==n)return d.endsWith(":join")&&"function"==typeof t.nodeStanzasCallbacks[d]&&t.nodeStanzasCallbacks[d](e),!0;if(c=t.helpers.getIdFromNode(u),l=t.contactList.contacts[c],h)switch(h){case"subscribe":l&&"to"===l.subscription?(l?l.ask=null:l={ask:null},l.subscription="both",t.contactList._sendSubscriptionPresence({jid:u,type:"subscribed"})):"function"==typeof t.onSubscribeListener&&i.safeCallbackCall(t.onSubscribeListener,c);break;case"subscribed":l&&"from"===l.subscription?(l?l.ask=null:l={ask:null},l.subscription="both"):(l?l.ask=null:l={ask:null},l.subscription="to","function"==typeof t.onConfirmSubscribeListener&&i.safeCallbackCall(t.onConfirmSubscribeListener,c));break;case"unsubscribed":l?l.ask=null:l={ask:null},l.subscription="none","function"==typeof t.onRejectSubscribeListener&&i.safeCallbackCall(t.onRejectSubscribeListener,c);break;case"unsubscribe":l?l.ask=null:l={ask:null},l.subscription="to";break;case"unavailable":"function"==typeof t.onContactListListener&&l&&"none"!==l.subscription&&i.safeCallbackCall(t.onContactListListener,c,h),c===f&&t.xmppClient.send(o.createPresenceStanza())}else"function"==typeof t.onContactListListener&&l&&"none"!==l.subscription&&i.safeCallbackCall(t.onContactListListener,c);return!0},this._onIQ=function(e){var n=o.getAttr(e,"id"),r=n.indexOf("lastActivity")>-1;if("function"==typeof t.onLastUserActivityListener&&r){var s=o.getAttr(e,"from"),a=t.helpers.getIdFromNode(s),c=o.getElement(e,"query"),l=o.getElement(e,"error")?void 0:+o.getAttr(c,"seconds");i.safeCallbackCall(t.onLastUserActivityListener,a,l)}return i.getEnv().browser||t.nodeStanzasCallbacks[n]&&(i.safeCallbackCall(t.nodeStanzasCallbacks[n],e),delete t.nodeStanzasCallbacks[n]),!0},this._onSystemMessageListener=function(e){var n,r=o.getAttr(e,"from"),s=(o.getAttr(e,"to"),o.getAttr(e,"id")),a=o.getElement(e,"extraParams"),c=t.helpers.getIdFromNode(r),l=o.getElement(e,"delay"),u=o.getElementText(a,"moduleIdentifier"),d=o.getElementText(e,"body"),h=o.parseExtraParams(a);return"SystemNotifications"===u&&"function"==typeof t.onSystemMessageListener?(n={id:s,userId:c,body:d,extension:h.extension},i.safeCallbackCall(t.onSystemMessageListener,n)):t.webrtcSignalingProcessor&&!l&&"WebRTCVideoChat"===u&&t.webrtcSignalingProcessor._onMessage(r,a,l,c,h.extension),!0},this._onMessageErrorListener=function(e){var n=o.getAttr(e,"id"),r=o.getErrorFromXMLNode(e);return"function"==typeof t.onMessageErrorListener&&i.safeCallbackCall(t.onMessageErrorListener,n,r),!0}}i.getEnv().browser&&(Strophe.addNamespace("CARBONS",o.MARKERS.CARBONS),Strophe.addNamespace("CHAT_MARKERS",o.MARKERS.CHAT),Strophe.addNamespace("PRIVACY_LIST",o.MARKERS.PRIVACY),Strophe.addNamespace("CHAT_STATES",o.MARKERS.STATES)),h.prototype={connect:function(e,t){i.DLog("[Chat]","Connect with parameters "+JSON.stringify(e));var n,s=this,a=o.buildUserJid(e),c="function"==typeof t;if(s._isConnecting)return n=i.getError(422,"REJECT - The connection is still in the CONNECTING state","Chat"),void(c&&t(n,null));if(s.isConnected)return i.DLog("[Chat]","CONNECTED - You are already connected"),void(c&&t(null,s.contactList.contacts));if(s._isConnecting=!0,s._isLogout=!1,i.getEnv().browser)s.xmppClient.connect(a,e.password,function(o){switch(o){case Strophe.Status.ERROR:s.isConnected=!1,s._isConnecting=!1,n=i.getError(422,"ERROR - An error has occurred","Chat"),c&&t(n,null);break;case Strophe.Status.CONNFAIL:s.isConnected=!1,s._isConnecting=!1,n=i.getError(422,"CONNFAIL - The connection attempt failed","Chat"),c&&t(n,null);break;case Strophe.Status.AUTHENTICATING:i.DLog("[Chat]","AUTHENTICATING");break;case Strophe.Status.AUTHFAIL:s.isConnected=!1,s._isConnecting=!1,n=i.getError(401,"Status.AUTHFAIL - The authentication attempt failed","Chat"),c&&t(n,null),s.isConnected||"function"!=typeof s.onReconnectFailedListener||i.safeCallbackCall(s.onReconnectFailedListener,n);break;case Strophe.Status.CONNECTING:i.DLog("[Chat]","Status.CONNECTING","(Chat Protocol - "+(1===r.chatProtocol.active?"BOSH":"WebSocket)"));break;case Strophe.Status.CONNECTED:s.xmppClient.XDeleteHandlers(),s.xmppClient.XAddTrackedHandler(s._onMessage,null,"message","chat"),s.xmppClient.XAddTrackedHandler(s._onMessage,null,"message","groupchat"),s.xmppClient.XAddTrackedHandler(s._onPresence,null,"presence"),s.xmppClient.XAddTrackedHandler(s._onIQ,null,"iq"),s.xmppClient.XAddTrackedHandler(s._onSystemMessageListener,null,"message","headline"),s.xmppClient.XAddTrackedHandler(s._onMessageErrorListener,null,"message","error"),s._postConnectActions(function(e){t(null,e)},c);break;case Strophe.Status.DISCONNECTING:i.DLog("[Chat]","DISCONNECTING");break;case Strophe.Status.DISCONNECTED:i.DLog("[Chat]","DISCONNECTED"),s.isConnected&&"function"==typeof s.onDisconnectedListener&&i.safeCallbackCall(s.onDisconnectedListener),s.isConnected=!1,s._isConnecting=!1,s._establishConnection(e);break;case Strophe.Status.ATTACHED:i.DLog("[Chat]","Status.ATTACHED")}});else if(i.getEnv().node||i.getEnv().nativescript)s.xmppClient.removeAllListeners(),s.xmppClient.on("connect",function(){i.DLog("[Chat]","CONNECTING","(Chat Protocol - "+(1===r.chatProtocol.active?"BOSH":"WebSocket)"))}),s.xmppClient.on("auth",function(){i.DLog("[Chat]","AUTHENTICATING")}),s.xmppClient.on("online",function(){i.DLog("[Chat]","ONLINE"),s._postConnectActions(function(e){t(null,e)},c)}),s.xmppClient.on("stanza",function(e){i.DLog("[Chat] RECV:",e.toString()),e.is("presence")?s._onPresence(e):e.is("iq")?s._onIQ(e):e.is("message")&&("headline"===e.attrs.type?s._onSystemMessageListener(e):"error"===e.attrs.type?s._onMessageErrorListener(e):s._onMessage(e))}),s.xmppClient.on("disconnect",function(){i.DLog("[Chat]","DISCONNECTED"),"function"==typeof s.onDisconnectedListener&&i.safeCallbackCall(s.onDisconnectedListener),s.isConnected=!1,s._isConnecting=!1,s._establishConnection(e)}),s.xmppClient.on("error",function(){i.DLog("[Chat]","ERROR"),n=i.getError(422,"ERROR - An error has occurred","Chat"),c&&t(n,null),s.isConnected=!1,s._isConnecting=!1}),s.xmppClient.on("end",function(){s.xmppClient.removeAllListeners()}),s.xmppClient.options.jid=a,s.xmppClient.options.password=e.password,s.xmppClient.connect();else{if(!i.getEnv().reactnative)throw"Unsupported platform for Chat/XMPP functionality";s.xmppClientListeners.forEach(function(e){s.xmppClient.removeListener(e.name,e.callback)}),s.xmppClientListeners=[];var l=function(){i.DLog("[Chat]","CONNECTING")};s.xmppClient.on("connect",l),s.xmppClientListeners.push({name:"connect",callback:l});var u=function(e){i.DLog("[Chat]","ONLINE"),s._postConnectActions(function(e){t(null,e)},c)};s.xmppClient.on("online",u),s.xmppClientListeners.push({name:"online",callback:u});var d=function(){i.DLog("[Chat]","OFFLINE")};s.xmppClient.on("offline",d),s.xmppClientListeners.push({name:"offline",callback:d});var h=function(t){i.DLog("[Chat]","DISCONNECTED");var n=function(){s.isConnected=!1,s._isConnecting=!1};s.isConnected&&"function"==typeof s.onDisconnectedListener?(n(),i.safeCallbackCall(s.onDisconnectedListener)):n(),s._establishConnection(e)};s.xmppClient.on("disconnect",h),s.xmppClientListeners.push({name:"disconnect",callback:h});var f=function(e,t){i.DLog("[Chat]","status",e,t?t.toString():"")};s.xmppClient.on("status",f),s.xmppClientListeners.push({name:"status",callback:f});var p=function(e){e.is("presence")?s._onPresence(e):e.is("iq")?s._onIQ(e):e.is("message")&&("headline"===e.attrs.type?s._onSystemMessageListener(e):"error"===e.attrs.type?s._onMessageErrorListener(e):s._onMessage(e))};s.xmppClient.on("stanza",p),s.xmppClientListeners.push({name:"stanza",callback:p});var m=function(e){i.DLog("[Chat]","ERROR:",e),c&&("SASLError"==e.name&&(e=e.condition),t(e,null)),s.isConnected=!1,s._isConnecting=!1};s.xmppClient.on("error",m),s.xmppClientListeners.push({name:"error",callback:m});var g=function(e){i.DLog("[Chat]","SENT:",e)};s.xmppClient.on("output",g),s.xmppClientListeners.push({name:"output",callback:g});var v=function(e){i.DLog("[Chat]","RECV:",e)};s.xmppClient.on("input",v),s.xmppClientListeners.push({name:"input",callback:v}),Object.defineProperty(s.xmppClient,"cbUserName",{value:o.buildUserJidLocalPart(e.userId),writable:!1}),Object.defineProperty(s.xmppClient,"cbUserPassword",{value:e.password,writable:!1}),s.xmppClient.start()}},_postConnectActions:function(e,t){i.DLog("[Chat]","CONNECTED");var n=this,s=o.createPresenceStanza();if(r.chat.streamManagement.enable&&2===r.chatProtocol.active&&(n.streamManagement.enable(n.xmppClient),n.streamManagement.sentMessageCallback=n._sentMessageCallback),n.helpers.setUserCurrentJid(n.helpers.userCurrentJid(n.xmppClient)),n.isConnected=!0,n._isConnecting=!1,n._enableCarbons(),t)n.contactList.get(function(t){n.xmppClient.send(s),n.contactList.contacts=t,e(n.contactList.contacts)});else{var a=Object.keys(n.muc.joinedRooms);n.xmppClient.send(s),i.DLog("[Chat]","Re-joining "+a.length+" rooms...");for(var c=0,l=a.length;c<l;c++)n.muc.join(a[c]);"function"==typeof n.onReconnectListener&&i.safeCallbackCall(n.onReconnectListener)}},_establishConnection:function(e){var t=this;if(!t._isLogout&&!t._checkConnectionTimer){var n=function(){t.isConnected||t._isConnecting?(clearInterval(t._checkConnectionTimer),t._checkConnectionTimer=void 0):t.connect(e)};n(),t._checkConnectionTimer=setInterval(function(){n()},1e3*r.chat.reconnectionTimeInterval)}},send:function(e,t){var n={from:this.helpers.getUserCurrentJid(),to:this.helpers.jidOrUserId(e),type:t.type?t.type:"chat",id:t.id?t.id:i.getBsonObjectId()},s=o.createMessageStanza(n);return t.body&&s.c("body",{xmlns:o.MARKERS.CLIENT}).t(t.body).up(),t.markable&&s.c("markable",{xmlns:o.MARKERS.CHAT}).up(),t.extension&&(s.c("extraParams",{xmlns:o.MARKERS.CLIENT}),s=o.filledExtraParams(s,t.extension)),r.chat.streamManagement.enable?(t.id=n.id,this.xmppClient.send(s,t)):this.xmppClient.send(s),n.id},sendSystemMessage:function(e,t){var n={type:"headline",id:t.id?t.id:i.getBsonObjectId(),to:this.helpers.jidOrUserId(e)},r=o.createMessageStanza(n);return t.body&&r.c("body",{xmlns:o.MARKERS.CLIENT}).t(t.body).up(),t.extension&&(r.c("extraParams",{xmlns:o.MARKERS.CLIENT}).c("moduleIdentifier").t("SystemNotifications").up(),r=o.filledExtraParams(r,t.extension)),this.xmppClient.send(r),n.id},sendIsTypingStatus:function(e){var t={from:this.helpers.getUserCurrentJid(),to:this.helpers.jidOrUserId(e),type:this.helpers.typeChat(e)},n=o.createMessageStanza(t);n.c("composing",{xmlns:o.MARKERS.STATES}),this.xmppClient.send(n)},sendIsStopTypingStatus:function(e){var t={from:this.helpers.getUserCurrentJid(),to:this.helpers.jidOrUserId(e),type:this.helpers.typeChat(e)},n=o.createMessageStanza(t);n.c("paused",{xmlns:o.MARKERS.STATES}),this.xmppClient.send(n)},sendDeliveredStatus:function(e){var t={type:"chat",from:this.helpers.getUserCurrentJid(),id:i.getBsonObjectId(),to:this.helpers.jidOrUserId(e.userId)},n=o.createMessageStanza(t);n.c("received",{xmlns:o.MARKERS.MARKERS,id:e.messageId}).up(),n.c("extraParams",{xmlns:o.MARKERS.CLIENT}).c("dialog_id").t(e.dialogId),this.xmppClient.send(n)},sendReadStatus:function(e){var t={type:"chat",from:this.helpers.getUserCurrentJid(),to:this.helpers.jidOrUserId(e.userId),id:i.getBsonObjectId()},n=o.createMessageStanza(t);n.c("displayed",{xmlns:o.MARKERS.MARKERS,id:e.messageId}).up(),n.c("extraParams",{xmlns:o.MARKERS.CLIENT}).c("dialog_id").t(e.dialogId),this.xmppClient.send(n)},getLastUserActivity:function(e){var t={from:this.helpers.getUserCurrentJid(),id:this.helpers.getUniqueId("lastActivity"),to:this.helpers.jidOrUserId(e),type:"get"},n=o.createIqStanza(t);n.c("query",{xmlns:o.MARKERS.LAST}),this.xmppClient.send(n)},disconnect:function(){clearInterval(this._checkConnectionTimer),this._checkConnectionTimer=void 0,this.muc.joinedRooms={},this._isLogout=!0,this.helpers.setUserCurrentJid(""),i.getEnv().browser?(this.xmppClient.flush(),this.xmppClient.disconnect()):i.getEnv().reactnative?this.xmppClient.stop():this.xmppClient.end()},_enableCarbons:function(){var e={type:"set",from:this.helpers.getUserCurrentJid(),id:o.getUniqueId("enableCarbons")},t=o.createIqStanza(e);t.c("enable",{xmlns:o.MARKERS.CARBONS}),i.getEnv().browser?this.xmppClient.sendIQ(t):this.xmppClient.send(t)}},e.exports=h},function(e,t,n){"use strict";var r=n(0),i=n(1),o=n(3);function s(){this._userCurrentJid=""}s.prototype={getUniqueId:o.getUniqueId,jidOrUserId:function(e){var t;if("string"==typeof e)t=e;else{if("number"!=typeof e)throw new Error('The method "jidOrUserId" may take jid or id');t=e+"-"+i.creds.appId+"@"+i.endpoints.chat}return t},typeChat:function(e){var t;if("string"==typeof e)t=e.indexOf("muc")>-1?"groupchat":"chat";else{if("number"!=typeof e)throw new Error("Unsupported chat type");t="chat"}return t},getRecipientId:function(e,t){var n=null;return e.forEach(function(e){e!=t&&(n=e)}),n},getUserJid:function(e,t){return t?e+"-"+t+"@"+i.endpoints.chat:e+"-"+i.creds.appId+"@"+i.endpoints.chat},getUserNickWithMucDomain:function(e){return i.endpoints.muc+"/"+e},getIdFromNode:function(e){return e.indexOf("@")<0?null:parseInt(e.split("@")[0].split("-")[0])},getDialogIdFromNode:function(e){return e.indexOf("@")<0?null:e.split("@")[0].split("_")[1]},getRoomJidFromDialogId:function(e){return i.creds.appId+"_"+e+"@"+i.endpoints.muc},getRoomJid:function(e){return e+"/"+this.getIdFromNode(this._userCurrentJid)},getIdFromResource:function(e){var t=e.split("/");return t.length<2?null:(t.splice(0,1),parseInt(t.join("/")))},getRoomJidFromRoomFullJid:function(e){var t=e.split("/");return t.length<2?null:t[0]},getBsonObjectId:function(){return r.getBsonObjectId()},getUserIdFromRoomJid:function(e){var t=e.toString().split("/");return 0===t.length?null:t[t.length-1]},userCurrentJid:function(e){return r.getEnv().browser?e.jid:r.getEnv().reactnative?e.jid._local+"@"+e.jid._domain+"/"+e.jid._resource:e.jid.user+"@"+e.jid._domain+"/"+e.jid._resource},getUserCurrentJid:function(){return this._userCurrentJid},setUserCurrentJid:function(e){this._userCurrentJid=e},getDialogJid:function(e){return e.indexOf("@")>0?e:this.getRoomJidFromDialogId(e)}},e.exports=s},function(e,t,n){"use strict";var r=n(0),i=n(3);function o(){this._NS="urn:xmpp:sm:3",this._isStreamManagementEnabled=!1,this._clientProcessedStanzasCounter=null,this._clientSentStanzasCounter=null,this._timeInterval=2e3,this.sentMessageCallback=null,r.getEnv().browser&&(this._parser=new DOMParser),this._c=null,this._originalSend=null,this._stanzasQueue=[]}o.prototype.enable=function(e){var t,n={xmlns:this._NS};this._isStreamManagementEnabled||(this._c=e,this._originalSend=this._c.send,this._c.send=this.send.bind(this)),r.getEnv().browser&&(this._clientProcessedStanzasCounter=null,this._clientSentStanzasCounter=null),this._addEnableHandlers(),t=i.createNonza("enable",n),this._c.send(t)},o.prototype._timeoutCallback=function(){var e=Date.now(),t=[];if(this._stanzasQueue.length){for(var n=0;n<this._stanzasQueue.length;n++)this._stanzasQueue[n]&&this._stanzasQueue[n].time<e?this.sentMessageCallback(this._stanzasQueue[n].message):t.push(this._stanzasQueue[n]);this._stanzasQueue=t}},o.prototype._addEnableHandlers=function(){var e=this;function t(t){var n=t.name||t.tagName||t.nodeTree.tagName;if("enabled"===n)return e._isStreamManagementEnabled=!0,setInterval(e._timeoutCallback.bind(e),e._timeInterval),!0;if(i.getAttr(t,"xmlns")!==e._NS&&e._increaseReceivedStanzasCounter(),"r"===n){var r={xmlns:e._NS,h:e._clientProcessedStanzasCounter},o=i.createNonza("a",r);return e._originalSend.call(e._c,o),!0}if("a"===n){var s=parseInt(i.getAttr(t,"h"));e._checkCounterOnIncomeStanza(s)}return!0}r.getEnv().browser?e._c.XAddTrackedHandler(t.bind(e)):r.getEnv().reactnative?e._c.on("element",t.bind(e)):e._c.on("stanza",t.bind(e))},o.prototype.send=function(e,t){var n=e.nodeTree?this._parser.parseFromString(e.nodeTree.outerHTML,"application/xml").childNodes[0]:e,r=n.name||n.tagName||n.nodeTree.tagName,o=i.getAttr(n,"type"),s=i.getElementText(n,"body")||"",a=i.getAllElements(n,"attachment")||"";this._originalSend.call(this._c,e),"message"!==r||"chat"!==o&&"groupchat"!==o||!s&&!a.length||this._sendStanzasRequest({message:t,time:Date.now()+this._timeInterval,expect:this._clientSentStanzasCounter}),this._clientSentStanzasCounter++},o.prototype._sendStanzasRequest=function(e){if(this._isStreamManagementEnabled){this._stanzasQueue.push(e);var t=i.createNonza("r",{xmlns:this._NS});this._originalSend.call(this._c,t)}},o.prototype.getClientSentStanzasCounter=function(){return this._clientSentStanzasCounter},o.prototype._checkCounterOnIncomeStanza=function(e){this._stanzasQueue[0].expect!==e?this.sentMessageCallback(this._stanzasQueue[0].message):this.sentMessageCallback(null,this._stanzasQueue[0].message),this._stanzasQueue.shift()},o.prototype._increaseReceivedStanzasCounter=function(){this._clientProcessedStanzasCounter++},e.exports=o},function(e,t,n){var r=n(3),i=n(0),o=n(1);function s(e){this.helpers=e.helpers,this.xmppClient=e.xmppClient,this.nodeStanzasCallbacks=e.nodeStanzasCallbacks,this.contacts={}}s.prototype={get:function(e){var t=this,n=r.getUniqueId("getRoster"),s={},a=r.createIqStanza({type:"get",from:this.helpers.getUserCurrentJid(),id:n});function c(n){for(var a=function(e){return i.getEnv().browser?e.getElementsByTagName("item"):e.getChild("query").children}(n),c=0,l=a.length;c<l;c++){var u=t.helpers.getIdFromNode(r.getAttr(a[c],"jid")),d=r.getAttr(a[c],"ask"),h=r.getAttr(a[c],"subscription"),f=r.getAttr(a[c],"name"),p=u+"-"+o.creds.appId!==f;s[u]={subscription:h,ask:d||null,name:p?f:null}}e(s)}a.c("query",{xmlns:r.MARKERS.ROSTER}),i.getEnv().browser?t.xmppClient.sendIQ(a,c):(t.nodeStanzasCallbacks[n]=c,t.xmppClient.send(a))},add:function(e,t){var n=this,o=e.userId||e,s=n.helpers.jidOrUserId(o),a=r.getUniqueId("addContactInRoster"),c=r.createIqStanza({type:"set",from:n.helpers.getUserCurrentJid(),id:a});function l(){n._sendSubscriptionPresence({jid:s,type:"subscribe"}),"function"==typeof t&&t()}n.contacts[o]={subscription:"none",ask:"subscribe",name:e.name||null},c.c("query",{xmlns:r.MARKERS.ROSTER}).c("item",{jid:s,name:e.name||null}),i.getEnv().browser?n.xmppClient.sendIQ(c,l):(n.nodeStanzasCallbacks[a]=l,n.xmppClient.send(c))},confirm:function(e,t){var n=e.userId||e,r=this.helpers.jidOrUserId(n);function i(){"function"==typeof t&&t()}this._sendSubscriptionPresence({jid:r,type:"subscribed"}),o.chat.contactList.subscriptionMode.mutual?this.add(e,function(){i()}):i()},reject:function(e,t){var n=this.helpers.jidOrUserId(e);this.contacts[e]={subscription:"none",ask:null},this._sendSubscriptionPresence({jid:n,type:"unsubscribed"}),"function"==typeof t&&t()},updateName:function(e,t){var n=this.helpers.jidOrUserId(e.userId),o=r.getUniqueId("updateContactInRoster"),s=this.contacts[e.userId];if(i.isObject(s)){s.name=e.name||null;var a=r.createIqStanza({type:"set",from:this.helpers.getUserCurrentJid(),id:o});a.c("query",{xmlns:r.MARKERS.ROSTER}).c("item",{jid:n,name:e.name||null}),i.getEnv().browser?this.xmppClient.sendIQ(a,c):(this.nodeStanzasCallbacks[o]=c,this.xmppClient.send(a))}else c("No contact exists with provided user id");function c(e){"function"==typeof t&&(e?t(e):t())}},remove:function(e,t){var n=this,o=this.helpers.jidOrUserId(e),s=r.getUniqueId("removeConactInRoster"),a=r.createIqStanza({type:"set",from:this.helpers.getUserCurrentJid(),id:s});function c(){delete n.contacts[e],"function"==typeof t&&t()}a.c("query",{xmlns:r.MARKERS.ROSTER}).c("item",{jid:o,subscription:"remove"}),i.getEnv().browser?n.xmppClient.sendIQ(a,c):(n.nodeStanzasCallbacks[s]=c,n.xmppClient.send(a))},_sendSubscriptionPresence:function(e){var t={to:e.jid,type:e.type},n=r.createPresenceStanza(t);this.xmppClient.send(n)}},e.exports=s},function(e,t,n){var r=n(3),i=n(0);function o(e){this.helpers=e.helpers,this.xmppClient=e.xmppClient,this.nodeStanzasCallbacks=e.nodeStanzasCallbacks}o.prototype={create:function(e,t){for(var n,o,s,a,c,l,u={},d=e.items.length-1;d>=0;d--){var h=e.items[d];u[h.user_id]={action:h.action,mutualBlock:!0===h.mutualBlock}}l=Object.keys(u);var f={type:"set",from:this.helpers.getUserCurrentJid(),id:r.getUniqueId("edit")},p=r.createIqStanza(f);function m(e,t){i.getEnv().browser?e.c("item",{type:"jid",value:t.jidOrMuc,action:t.userAction,order:t.order}).c("message",{}).up().c("presence-in",{}).up().c("presence-out",{}).up().c("iq",{}).up().up():e.getChild("query").getChild("list").c("item",{type:"jid",value:t.jidOrMuc,action:t.userAction,order:t.order}).c("message",{}).up().c("presence-in",{}).up().c("presence-out",{}).up().c("iq",{}).up().up();return e}function g(e,t){i.getEnv().browser?e.c("item",{type:"jid",value:t.jidOrMuc,action:t.userAction,order:t.order}).up():e.getChild("query").getChild("list").c("item",{type:"jid",value:t.jidOrMuc,action:t.userAction,order:t.order}).up();return e}p.c("query",{xmlns:r.MARKERS.PRIVACY}).c("list",{name:e.name});for(var v=0,b=0,y=l.length;v<y;v++,b+=2)c=u[n=l[v]].mutualBlock,a=u[n].action,o=this.helpers.jidOrUserId(parseInt(n,10)),s=this.helpers.getUserNickWithMucDomain(n),c&&"deny"===a?(p=g(p,{order:b+1,jidOrMuc:o,userAction:a}),p=g(p,{order:b+2,jidOrMuc:s,userAction:a}).up().up()):(p=m(p,{order:b+1,jidOrMuc:o,userAction:a}),p=m(p,{order:b+2,jidOrMuc:s,userAction:a}));i.getEnv().browser?this.xmppClient.sendIQ(p,function(e){t(null)},function(e){t(e?r.getErrorFromXMLNode(e):i.getError(408))}):(this.xmppClient.send(p),this.nodeStanzasCallbacks[f.id]=function(e){e.getChildElements("error").length?t(i.getError(408)):t(null)})},getList:function(e,t){var n,o,s,a=this,c=[],l={},u={type:"get",from:a.helpers.getUserCurrentJid(),id:r.getUniqueId("getlist")},d=r.createIqStanza(u);d.c("query",{xmlns:r.MARKERS.PRIVACY}).c("list",{name:e}),i.getEnv().browser?a.xmppClient.sendIQ(d,function(r){for(var i=0,u=(n=r.getElementsByTagName("item")).length;i<u;i+=2)o=n[i].getAttribute("value"),s=a.helpers.getIdFromNode(o),c.push({user_id:s,action:n[i].getAttribute("action")});t(null,l={name:e,items:c})},function(e){t(e?r.getErrorFromXMLNode(e):i.getError(408),null)}):(a.nodeStanzasCallbacks[u.id]=function(e){var r=e.getChild("query");l=r?r.getChild("list"):null;for(var i=0,d=(n=l?l.getChildElements("item"):null).length;i<d;i+=2)o=n[i].attrs.value,s=a.helpers.getIdFromNode(o),c.push({user_id:s,action:n[i].attrs.action});l={name:l.attrs.name,items:c},t(null,l),delete a.nodeStanzasCallbacks[u.id]},a.xmppClient.send(d))},update:function(e,t){var n=this;n.getList(e.name,function(r,o){if(r)t(r,null);else{var s={items:i.MergeArrayOfObjects(o.items,e.items),name:e.name};n.create(s,function(e,n){r?t(e,null):t(null,n)})}})},getNames:function(e){var t={type:"get",from:this.helpers.getUserCurrentJid(),id:r.getUniqueId("getNames")},n=r.createIqStanza(t);n.c("query",{xmlns:r.MARKERS.PRIVACY}),i.getEnv().browser?this.xmppClient.sendIQ(n,function(t){for(var n=t.getElementsByTagName("default"),r=t.getElementsByTagName("active"),i=t.getElementsByTagName("list"),o=n&&n.length>0?n[0].getAttribute("name"):null,s=r&&r.length>0?r[0].getAttribute("name"):null,a=[],c=0,l=i.length;c<l;c++)a.push(i[c].getAttribute("name"));e(null,{default:o,active:s,names:a})},function(t){e(t?r.getErrorFromXMLNode(t):i.getError(408),null)}):(this.nodeStanzasCallbacks[n.attrs.id]=function(t){if("error"!==t.attrs.type){for(var n=t.getChild("query"),r=n.getChild("default"),o=n.getChild("active"),s=n.getChildElements("list"),a=r?r.attrs.name:null,c=o?o.attrs.name:null,l=[],u=0,d=s.length;u<d;u++)l.push(s[u].attrs.name);e(null,{default:a,active:c,names:l})}else e(i.getError(408))},this.xmppClient.send(n))},delete:function(e,t){var n={from:this.xmppClient.jid||this.xmppClient.jid.user,type:"set",id:r.getUniqueId("remove")},o=r.createIqStanza(n);o.c("query",{xmlns:r.MARKERS.PRIVACY}).c("list",{name:e||""}),i.getEnv().browser?this.xmppClient.sendIQ(o,function(e){t(null)},function(e){t(e?r.getErrorFromXMLNode(e):i.getError(408))}):(this.nodeStanzasCallbacks[o.attrs.id]=function(e){e.getChildElements("error").length?t(i.getError(408)):t(null)},this.xmppClient.send(o))},setAsDefault:function(e,t){var n={from:this.xmppClient.jid||this.xmppClient.jid.user,type:"set",id:r.getUniqueId("default")},o=r.createIqStanza(n);o.c("query",{xmlns:r.MARKERS.PRIVACY}).c("default",e&&e.length>0?{name:e}:{}),i.getEnv().browser?this.xmppClient.sendIQ(o,function(e){t(null)},function(e){t(e?r.getErrorFromXMLNode(e):i.getError(408))}):(this.nodeStanzasCallbacks[o.attrs.id]=function(e){e.getChildElements("error").length?t(i.getError(408)):t(null)},this.xmppClient.send(o))}},e.exports=o},function(e,t,n){var r=n(3),i=n(0);function o(e){this.helpers=e.helpers,this.xmppClient=e.xmppClient,this.nodeStanzasCallbacks=e.nodeStanzasCallbacks,this.joinedRooms={}}o.prototype={join:function(e,t){var n=this,o=r.getUniqueId("join"),s=this.helpers.getDialogJid(e),a={id:o,from:n.helpers.getUserCurrentJid(),to:n.helpers.getRoomJid(s)},c=r.createPresenceStanza(a);function l(e){var s=r.getAttr(e,"from"),a=n.helpers.getDialogIdFromNode(s),c=r.getElement(e,"x"),l=r.getAttr(c,"xmlns"),u=r.getElement(c,"status"),d=r.getAttr(u,"code");if(1==t.length)return i.safeCallbackCall(t,e),!0;if(u&&"110"==d)i.safeCallbackCall(t,null,{dialogId:a});else{var h=r.getAttr(e,"type");if(h&&"error"===h&&"http://jabber.org/protocol/muc"==l&&o.endsWith(":join")){var f=r.getElement(e,"error"),p=r.getAttr(f,"code"),m=r.getElementText(f,"text");i.safeCallbackCall(t,{code:p||500,message:m||"Unknown issue"},{dialogId:a})}}}c.c("x",{xmlns:r.MARKERS.MUC}).c("history",{maxstanzas:0}),this.joinedRooms[s]=!0,i.getEnv().browser?"function"==typeof t&&n.xmppClient.XAddTrackedHandler(l,null,"presence",null,o):"function"==typeof t&&(n.nodeStanzasCallbacks[o]=l),n.xmppClient.send(c)},leave:function(e,t){var n={type:"unavailable",from:this.helpers.getUserCurrentJid(),to:this.helpers.getRoomJid(e)},o=r.createPresenceStanza(n);if(delete this.joinedRooms[e],i.getEnv().browser){var s=this.helpers.getRoomJid(e);"function"==typeof t&&this.xmppClient.XAddTrackedHandler(t,null,"presence",n.type,null,s)}else"function"==typeof t&&(this.nodeStanzasCallbacks["muc:leave"]=t);this.xmppClient.send(o)},listOnlineUsers:function(e,t){var n=this,o={type:"get",to:e,from:n.helpers.getUserCurrentJid(),id:r.getUniqueId("muc_disco_items")},s=r.createIqStanza(o);s.c("query",{xmlns:"http://jabber.org/protocol/disco#items"}),i.getEnv().browser?n.xmppClient.sendIQ(s,function(e){for(var r=e.getElementsByTagName("item"),i=[],o=0,s=r.length;o<s;o++){var a=n.helpers.getUserIdFromRoomJid(r[o].getAttribute("jid"));i.push(parseInt(a))}t(i)}):(n.xmppClient.send(s),n.nodeStanzasCallbacks[o.id]=function(e){var r=e.attrs.id;if(n.nodeStanzasCallbacks[r]){for(var i=e.getChild("query").getChildElements("item"),o=[],s=0,a=i.length;s<a;s++){var c=n.helpers.getUserIdFromRoomJid(i[s].attrs.jid);o.push(parseInt(c))}t(o)}})}},e.exports=o},function(e,t,n){var r=n(1),i=n(0),o=r.urls.chat+"/Dialog";function s(e){this.service=e}s.prototype={list:function(e,t){"function"==typeof e&&void 0===t&&(t=e,e={});var n={url:i.getUrl(o),data:e};this.service.ajax(n,t)},create:function(e,t){e&&e.occupants_ids&&i.isArray(e.occupants_ids)&&(e.occupants_ids=e.occupants_ids.join(", "));var n={url:i.getUrl(o),type:"POST",data:e};this.service.ajax(n,t)},update:function(e,t,n){var r={url:i.getUrl(o,e),type:"PUT",contentType:"application/json; charset=utf-8",isNeedStringify:!0,data:t};this.service.ajax(r,n)},delete:function(e,t,n){var r={url:i.getUrl(o,e),type:"DELETE",dataType:"text"};2===arguments.length?this.service.ajax(r,t):3===arguments.length&&(r.data=t,this.service.ajax(r,n))}},e.exports=s},function(e,t,n){var r=n(1),i=n(0),o=r.urls.chat+"/Message";function s(e){this.service=e}s.prototype={list:function(e,t){var n={url:i.getUrl(o),data:e};this.service.ajax(n,t)},create:function(e,t){var n={url:i.getUrl(o),type:"POST",data:e};this.service.ajax(n,t)},update:function(e,t,n){var r={type:"PUT",dataType:"text",url:i.getUrl(o,e),data:t};this.service.ajax(r,n)},delete:function(e,t,n){var r={url:i.getUrl(o,e),type:"DELETE",dataType:"text"};2===arguments.length?this.service.ajax(r,t):3===arguments.length&&(r.data=t,this.service.ajax(r,n))},unreadCount:function(e,t){e&&e.chat_dialog_ids&&i.isArray(e.chat_dialog_ids)&&(e.chat_dialog_ids=e.chat_dialog_ids.join(", "));var n={url:i.getUrl(o+"/unread"),data:e};this.service.ajax(n,t)}},e.exports=s},function(e,t,n){"use strict";var r=n(48),i=n(49),o=n(50),s=n(5),a=n(11),c=n(6),l=n(0),u=n(2).mediaDevices;function d(e,t){return d.__instance?d.__instance:this===window?new d:(d.__instance=this,this.connection=t,this.signalingProcessor=new i(e,this,t),this.signalingProvider=new o(e,t),this.SessionConnectionState=s.SessionConnectionState,this.CallType=s.CallType,this.PeerConnectionState=a.State,this.sessions={},void(u&&(u.ondevicechange=this._onDevicesChangeListener.bind(this))))}d.prototype.getMediaDevices=function(e){var t=[],n="Browser does not support output device selection.";return new Promise(function(r,i){u&&u.enumerateDevices?u.enumerateDevices().then(function(n){e?(n.forEach(function(n,r){n.kind===e&&t.push(n)}),r(t)):r(n)}):(i(n),s.traceWarning(n))})},d.prototype.sessions={},d.prototype.createNewSession=function(e,t,n){var i=function(e){var t=[];Object.keys(e).length>0&&Object.keys(e).forEach(function(n,i,o){var s=e[n];s.state!==r.State.NEW&&s.state!==r.State.ACTIVE||t.push(s.opponentsIDs)});return t}(this.sessions),o=s.getIdFromNode(s.userCurrentJid(this.connection)),a=n&&n.bandwidth&&!isNaN(n.bandwidth)?+n.bandwidth:0;if(!e)throw new Error("Can't create a session without the opponentsIDs.");if(function(e,t){var n=!1,r=t.sort();e.length&&e.forEach(function(e){var t=e.sort();n=t.length==r.length&&t.every(function(e,t){return e===r[t]})});return n}(i,e))throw new Error("Can't create a session with the same opponentsIDs. There is a session already in NEW or ACTIVE state.");return this._createAndStoreSession(null,o,e,t,a)},d.prototype._createAndStoreSession=function(e,t,n,i,o){var a=new r({sessionID:e,initiatorID:t,opIDs:n,callType:i,signalingProvider:this.signalingProvider,currentUserID:s.getIdFromNode(s.userCurrentJid(this.connection)),bandwidth:o});return a.onUserNotAnswerListener=this.onUserNotAnswerListener,a.onRemoteStreamListener=this.onRemoteStreamListener,a.onSessionConnectionStateChangedListener=this.onSessionConnectionStateChangedListener,a.onSessionCloseListener=this.onSessionCloseListener,a.onCallStatsReport=this.onCallStatsReport,this.sessions[a.ID]=a,a},d.prototype.clearSession=function(e){delete this.sessions[e]},d.prototype.isExistNewOrActiveSessionExceptSessionID=function(e){var t=this,n=!1;return Object.keys(t.sessions).length>0&&Object.keys(t.sessions).forEach(function(i,o,s){var a=t.sessions[i];a.state!==r.State.NEW&&a.state!==r.State.ACTIVE||a.ID!==e&&(n=!0)}),n},d.prototype._onCallListener=function(e,t,n){var r=n.userInfo||{};if(s.trace("onCall. UserID:"+e+". SessionID: "+t),this.isExistNewOrActiveSessionExceptSessionID(t))s.trace("User with id "+e+" is busy at the moment."),delete n.sdp,delete n.platform,n.sessionID=t,this.signalingProvider.sendMessage(e,n,c.SignalingType.REJECT),"function"==typeof this.onInvalidEventsListener&&l.safeCallbackCall(this.onInvalidEventsListener,"onCall",t,e,r);else{var i=this.sessions[t],o=+r.bandwidth||0;i?i.processOnCall(e,n):((i=this._createAndStoreSession(t,n.callerID,n.opponentsIDs,n.callType,o)).processOnCall(e,n),"function"==typeof this.onCallListener&&l.safeCallbackCall(this.onCallListener,i,r))}},d.prototype._onAcceptListener=function(e,t,n){var i=this.sessions[t],o=n.userInfo||{};s.trace("onAccept. UserID:"+e+". SessionID: "+t),i?i.state===r.State.ACTIVE?("function"==typeof this.onAcceptCallListener&&l.safeCallbackCall(this.onAcceptCallListener,i,e,o),i.processOnAccept(e,n)):("function"==typeof this.onInvalidEventsListener&&l.safeCallbackCall(this.onInvalidEventsListener,"onAccept",i,e,o),s.traceWarning("Ignore 'onAccept', the session( "+t+" ) has invalid state.")):s.traceError("Ignore 'onAccept', there is no information about session "+t+" by some reason.")},d.prototype._onRejectListener=function(e,t,n){var r=this.sessions[t];if(s.trace("onReject. UserID:"+e+". SessionID: "+t),r){var i=n.userInfo||{};"function"==typeof this.onRejectCallListener&&l.safeCallbackCall(this.onRejectCallListener,r,e,i),r.processOnReject(e,n)}else s.traceError("Ignore 'onReject', there is no information about session "+t+" by some reason.")},d.prototype._onStopListener=function(e,t,n){s.trace("onStop. UserID:"+e+". SessionID: "+t);var i=this.sessions[t],o=n.userInfo||{};!i||i.state!==r.State.ACTIVE&&i.state!==r.State.NEW?("function"==typeof this.onInvalidEventsListener&&l.safeCallbackCall(this.onInvalidEventsListener,"onStop",i,e,o),s.traceError("Ignore 'onStop', there is no information about session "+t+" by some reason.")):("function"==typeof this.onStopCallListener&&l.safeCallbackCall(this.onStopCallListener,i,e,o),setTimeout(i.processOnStop.bind(i),10,e,n))},d.prototype._onIceCandidatesListener=function(e,t,n){var i=this.sessions[t];s.trace("onIceCandidates. UserID:"+e+". SessionID: "+t+". ICE candidates count: "+n.iceCandidates.length),i?i.state===r.State.ACTIVE?i.processOnIceCandidates(e,n):s.traceWarning("Ignore 'OnIceCandidates', the session ( "+t+" ) has invalid state."):s.traceError("Ignore 'OnIceCandidates', there is no information about session "+t+" by some reason.")},d.prototype._onUpdateListener=function(e,t,n){var r=this.sessions[t],i=n.userInfo||{};s.trace("onUpdate. UserID:"+e+". SessionID: "+t+". Extension: "+JSON.stringify(i)),"function"==typeof this.onUpdateCallListener&&l.safeCallbackCall(this.onUpdateCallListener,r,e,i)},d.prototype._onDevicesChangeListener=function(){"function"==typeof this.onDevicesChangeListener&&l.safeCallbackCall(this.onDevicesChangeListener)},e.exports=d},function(e,t,n){"use strict";function r(e){return(r="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e})(e)}var i=n(1),o=n(11),s=n(0),a=n(5),c=n(6),l=n(2).mediaDevices;function u(e){var t;this.ID=e.sessionID?e.sessionID:(t=(new Date).getTime(),"xxxxxxxx-xxxx-4xxx-yxxx-xxxxxxxxxxxx".replace(/[xy]/g,function(e){var n=(t+16*Math.random())%16|0;return t=Math.floor(t/16),("x"==e?n:3&n|8).toString(16)})),this.state=u.State.NEW,this.initiatorID=parseInt(e.initiatorID),this.opponentsIDs=e.opIDs,this.callType=parseInt(e.callType),this.peerConnections={},this.localStream=null,this.mediaParams=null,this.signalingProvider=e.signalingProvider,this.currentUserID=e.currentUserID,this.bandwidth=e.bandwidth,this.answerTimer=null,this.startCallTime=0,this.acceptCallTime=0}function d(e){var t={};try{if("[object Object]"!=={}.toString.call(e))throw new Error('Invalid type of "extension" object.');t.userInfo=e,t=JSON.parse(JSON.stringify(t).replace(/null/g,'""'))}catch(e){a.traceWarning(e.message)}return t}function h(e){var t=JSON.parse(JSON.stringify(e));return Object.keys(t).forEach(function(e,n,r){t[n].hasOwnProperty("url")?t[n].urls=t[n].url:t[n].url=t[n].urls}),t}u.State={NEW:1,ACTIVE:2,HUNGUP:3,REJECTED:4,CLOSED:5},u.prototype.getUserMedia=function(e,t){var n=this;l.getUserMedia({audio:e.audio||!1,video:e.video||!1}).then(function(r){n.localStream=r,n.mediaParams=e,e.elementId&&n.attachMediaStream(e.elementId,r,e.options),t(null,r)}).catch(function(e){t(e,null)})},u.prototype.connectionStateForUser=function(e){var t=this.peerConnections[e];return t?t.state:null},u.prototype.attachMediaStream=function(e,t,n){var i=document.getElementById(e);if(!i)throw new Error("Unable to attach media stream, element "+e+" is undefined");"object"===r(i.srcObject)?i.srcObject=t:i.src=window.URL.createObjectURL(t),n&&n.muted&&(i.muted=!0),n&&n.mirror&&(i.style.webkitTransform="scaleX(-1)",i.style.transform="scaleX(-1)"),i.onloadedmetadata=function(e){i.play()}},u.prototype.detachMediaStream=function(e){var t=document.getElementById(e);t&&(t.pause(),"object"===r(t.srcObject)?t.srcObject=null:t.src="")},u.prototype.switchMediaTracks=function(e,t){var n=this,r=this.localStream;e&&e.audio&&("boolean"==typeof n.mediaParams.audio&&(n.mediaParams.audio={}),n.mediaParams.audio.deviceId=e.audio),e&&e.video&&("boolean"==typeof n.mediaParams.video&&(n.mediaParams.video={}),n.mediaParams.video.deviceId=e.video),r.getTracks().forEach(function(e){e.stop()}),l.getUserMedia({audio:n.mediaParams.audio||!1,video:n.mediaParams.video||!1}).then(function(e){n._replaceTracks(e),t(null,e)}).catch(function(e){t(e,null)})},u.prototype._replaceTracks=function(e){var t=this.peerConnections,n=this.localStream,r=this.mediaParams.elementId,i=this.mediaParams.options,o=e.getTracks();if(s.getEnv().reactnative||this.detachMediaStream(r),o.forEach(function(e){n.addTrack(e)}),s.getEnv().reactnative||this.attachMediaStream(r,e,i),!s.getEnv().reactnative){for(var a in t)t[a].getSenders().map(function(e){e.replaceTrack(o.find(function(t){return t.kind===e.track.kind}))})}},u.prototype.call=function(e,t){var n=this,r=d(e);a.trace("Call, extension: "+JSON.stringify(r.userInfo)),n.state=u.State.ACTIVE,n.opponentsIDs.forEach(function(e,t,i){n._callInternal(e,r,!0)}),"function"==typeof t&&t(null)},u.prototype._callInternal=function(e,t,n){var r=this,i=r._createPeer(e,"offer"),o=a.getVersionSafari();o&&o>=11?r.localStream.getTracks().forEach(function(e){i.addTrack(e,r.localStream)}):i.addLocalStream(r.localStream),this.peerConnections[e]=i,i.getAndSetLocalSessionDescription(this.callType,function(e){e?a.trace("getAndSessionDescription error: "+e):(a.trace("getAndSessionDescription success"),i._startDialingTimer(t,n))})},u.prototype.accept=function(e){var t=this,n=d(e);if(a.trace("Accept, extension: "+JSON.stringify(n.userInfo)),t.state!==u.State.ACTIVE){if(t.state===u.State.CLOSED)return a.traceError("Can't accept, the session is already closed, return."),void t.stop({});t.state=u.State.ACTIVE,t.acceptCallTime=new Date,t._clearAnswerTimer(),t._acceptInternal(t.initiatorID,n);var r=t._uniqueOpponentsIDsWithoutInitiator();if(r.length>0){var i=(t.acceptCallTime-t.startCallTime)/1e3;t._startWaitingOfferOrAnswerTimer(i),r.forEach(function(e,n,r){t.currentUserID>e&&t._callInternal(e,{},!0)})}}else a.traceError("Can't accept, the session is already active, return.")},u.prototype._acceptInternal=function(e,t){var n=this,r=this.peerConnections[e];if(r){var i=a.getVersionSafari();i&&i>=11?n.localStream.getTracks().forEach(function(e){r.addTrack(e,n.localStream)}):r.addLocalStream(n.localStream),r.setRemoteSessionDescription("offer",r.getRemoteSDP(),function(i){i?a.traceError("'setRemoteSessionDescription' error: "+i):(a.trace("'setRemoteSessionDescription' success"),r.getAndSetLocalSessionDescription(n.callType,function(i){i?a.trace("getAndSetLocalSessionDescription error: "+i):(t.sessionID=n.ID,t.callType=n.callType,t.callerID=n.initiatorID,t.opponentsIDs=n.opponentsIDs,t.sdp=r.localDescription.sdp,n.signalingProvider.sendMessage(e,t,c.SignalingType.ACCEPT))}))})}else a.traceError("Can't accept the call, there is no information about peer connection by some reason.")},u.prototype.reject=function(e){var t=d(e),n=Object.keys(this.peerConnections).length;if(a.trace("Reject, extension: "+JSON.stringify(t.userInfo)),this.state=u.State.REJECTED,this._clearAnswerTimer(),t.sessionID=this.ID,t.callType=this.callType,t.callerID=this.initiatorID,t.opponentsIDs=this.opponentsIDs,n>0)for(var r in this.peerConnections){var i=this.peerConnections[r];this.signalingProvider.sendMessage(i.userID,t,c.SignalingType.REJECT)}this._close()},u.prototype.stop=function(e){var t=d(e),n=Object.keys(this.peerConnections).length;if(a.trace("Stop, extension: "+JSON.stringify(t.userInfo)),this.state=u.State.HUNGUP,this.answerTimer&&this._clearAnswerTimer(),t.sessionID=this.ID,t.callType=this.callType,t.callerID=this.initiatorID,t.opponentsIDs=this.opponentsIDs,n>0)for(var r in this.peerConnections){var i=this.peerConnections[r];this.signalingProvider.sendMessage(i.userID,t,c.SignalingType.STOP)}this._close()},u.prototype.closeConnection=function(e){var t=this.peerConnections[e];if(!t)return a.traceWarn("Not found connection with user ("+e+")"),!1;try{t.release()}catch(e){a.traceError(e)}finally{this._closeSessionIfAllConnectionsClosed()}},u.prototype.update=function(e){var t={};if(a.trace("Update, extension: "+JSON.stringify(e)),null!==e)for(var n in(t=d(e)).sessionID=this.ID,this.peerConnections){var r=this.peerConnections[n];this.signalingProvider.sendMessage(r.userID,t,c.SignalingType.PARAMETERS_CHANGED)}else a.trace("extension is null, no parameters to update")},u.prototype.mute=function(e){this._muteStream(0,e)},u.prototype.unmute=function(e){this._muteStream(1,e)},u.prototype.processOnCall=function(e,t){var n=this;n._uniqueOpponentsIDs().forEach(function(r,i,o){var s,a=n.peerConnections[r];a?r==e&&(a.updateRemoteSDP(t.sdp),e!=n.initiatorID&&n.state===u.State.ACTIVE&&n._acceptInternal(e,{})):(s=r!=e&&n.currentUserID>r?n._createPeer(r,"offer"):n._createPeer(r,"answer"),n.peerConnections[r]=s,r==e&&(s.updateRemoteSDP(t.sdp),n._startAnswerTimer()))})},u.prototype.processOnAccept=function(e,t){var n=this.peerConnections[e];n?(n._clearDialingTimer(),n.setRemoteSessionDescription("answer",t.sdp,function(e){e?a.traceError("'setRemoteSessionDescription' error: "+e):a.trace("'setRemoteSessionDescription' success")})):a.traceError("Ignore 'OnAccept', there is no information about peer connection by some reason.")},u.prototype.processOnReject=function(e,t){var n=this.peerConnections[e];this._clearWaitingOfferOrAnswerTimer(),n?n.release():a.traceError("Ignore 'OnReject', there is no information about peer connection by some reason."),this._closeSessionIfAllConnectionsClosed()},u.prototype.processOnStop=function(e,t){var n=this;if(this._clearAnswerTimer(),e===n.initiatorID)Object.keys(n.peerConnections).length?Object.keys(n.peerConnections).forEach(function(e){n.peerConnections[e].release()}):a.traceError("Ignore 'OnStop', there is no information about peer connections by some reason.");else{var r=n.peerConnections[e];r?r.release():a.traceError("Ignore 'OnStop', there is no information about peer connection by some reason.")}this._closeSessionIfAllConnectionsClosed()},u.prototype.processOnIceCandidates=function(e,t){var n=this.peerConnections[e];n?n.addCandidates(t.iceCandidates):a.traceError("Ignore 'OnIceCandidates', there is no information about peer connection by some reason.")},u.prototype.processCall=function(e,t){var n=t||{};n.sessionID=this.ID,n.callType=this.callType,n.callerID=this.initiatorID,n.opponentsIDs=this.opponentsIDs,n.sdp=e.localDescription.sdp,n.userInfo=t.userInfo||{},n.userInfo.bandwidth=this.bandwidth,this.signalingProvider.sendMessage(e.userID,n,c.SignalingType.CALL)},u.prototype.processIceCandidates=function(e,t){var n={};n.sessionID=this.ID,n.callType=this.callType,n.callerID=this.initiatorID,n.opponentsIDs=this.opponentsIDs,this.signalingProvider.sendCandidate(e.userID,t,n)},u.prototype.processOnNotAnswer=function(e){a.trace("Answer timeout callback for session "+this.ID+" for user "+e.userID),this._clearWaitingOfferOrAnswerTimer(),e.release(),"function"==typeof this.onUserNotAnswerListener&&s.safeCallbackCall(this.onUserNotAnswerListener,this,e.userID),this._closeSessionIfAllConnectionsClosed()},u.prototype._onRemoteStreamListener=function(e,t){"function"==typeof this.onRemoteStreamListener&&s.safeCallbackCall(this.onRemoteStreamListener,this,e,t)},u.prototype._onCallStatsReport=function(e,t,n){"function"==typeof this.onCallStatsReport&&s.safeCallbackCall(this.onCallStatsReport,this,e,t,n)},u.prototype._onSessionConnectionStateChangedListener=function(e,t){"function"==typeof this.onSessionConnectionStateChangedListener&&s.safeCallbackCall(this.onSessionConnectionStateChangedListener,this,e,t)},u.prototype._createPeer=function(e,t){if(!o)throw new Error("_createPeer error: RTCPeerConnection() is not supported in your browser");this.startCallTime=new Date;var n={iceServers:h(i.videochat.iceServers)};a.trace("_createPeer, iceServers: "+JSON.stringify(n));var r=new o(n);return r._init(this,e,this.ID,t),r},u.prototype._close=function(){for(var e in a.trace("_close"),this.peerConnections){var t=this.peerConnections[e];try{t.release()}catch(e){console.warn("Peer close error:",e)}}this._closeLocalMediaStream(),this.state=u.State.CLOSED,"function"==typeof this.onSessionCloseListener&&s.safeCallbackCall(this.onSessionCloseListener,this)},u.prototype._closeSessionIfAllConnectionsClosed=function(){var e=!0;for(var t in this.peerConnections){var n,r=this.peerConnections[t];try{n="closed"===r.iceConnectionState?"closed":r.signalingState}catch(e){a.traceError(e),n="closed"}if("closed"!==n){e=!1;break}}a.trace("All peer connections closed: "+e),e&&(this._closeLocalMediaStream(),"function"==typeof this.onSessionCloseListener&&this.onSessionCloseListener(this),this.state=u.State.CLOSED)},u.prototype._closeLocalMediaStream=function(){this.localStream&&(this.localStream.getAudioTracks().forEach(function(e){e.stop()}),this.localStream.getVideoTracks().forEach(function(e){e.stop()}),this.localStream=null)},u.prototype._muteStream=function(e,t){"audio"===t&&this.localStream.getAudioTracks().length>0?this.localStream.getAudioTracks().forEach(function(t){t.enabled=!!e}):"video"===t&&this.localStream.getVideoTracks().length>0&&this.localStream.getVideoTracks().forEach(function(t){t.enabled=!!e})},u.prototype._clearAnswerTimer=function(){this.answerTimer&&(a.trace("_clearAnswerTimer"),clearTimeout(this.answerTimer),this.answerTimer=null)},u.prototype._startAnswerTimer=function(){a.trace("_startAnswerTimer");var e=this,t=1e3*i.videochat.answerTimeInterval;this.answerTimer=setTimeout(function(){a.trace("_answerTimeoutCallback"),"function"==typeof e.onSessionCloseListener&&e._close(),e.answerTimer=null},t)},u.prototype._clearWaitingOfferOrAnswerTimer=function(){this.waitingOfferOrAnswerTimer&&(a.trace("_clearWaitingOfferOrAnswerTimer"),clearTimeout(this.waitingOfferOrAnswerTimer),this.waitingOfferOrAnswerTimer=null)},u.prototype._startWaitingOfferOrAnswerTimer=function(e){var t=this,n=i.videochat.answerTimeInterval-e<0?1:i.videochat.answerTimeInterval-e;a.trace("_startWaitingOfferOrAnswerTimer, timeout: "+n),this.waitingOfferOrAnswerTimer=setTimeout(function(){a.trace("waitingOfferOrAnswerTimeoutCallback"),Object.keys(t.peerConnections).length>0&&Object.keys(t.peerConnections).forEach(function(e){var n=t.peerConnections[e];n.state!==o.State.CONNECTING&&n.state!==o.State.NEW||t.processOnNotAnswer(n)}),t.waitingOfferOrAnswerTimer=null},1e3*n)},u.prototype._uniqueOpponentsIDs=function(){var e=this,t=[];return this.initiatorID!==this.currentUserID&&t.push(this.initiatorID),this.opponentsIDs.forEach(function(n,r,i){n!=e.currentUserID&&t.push(parseInt(n))}),t},u.prototype._uniqueOpponentsIDsWithoutInitiator=function(){var e=this,t=[];return this.opponentsIDs.forEach(function(n,r,i){n!=e.currentUserID&&t.push(parseInt(n))}),t},u.prototype.toString=function(){return"ID: "+this.ID+", initiatorID:  "+this.initiatorID+", opponentsIDs: "+this.opponentsIDs+", state: "+this.state+", callType: "+this.callType},e.exports=u},function(e,t,n){"use strict";var r=n(6),i=n(3);e.exports=function(e,t,n){var o=this;o.service=e,o.delegate=t,o.connection=n,this._onMessage=function(e,t,n,i){var s=o._getExtension(t),a=s.sessionID,c=s.signalType;switch(delete s.moduleIdentifier,delete s.sessionID,delete s.signalType,c){case r.SignalingType.CALL:"function"==typeof o.delegate._onCallListener&&o.delegate._onCallListener(i,a,s);break;case r.SignalingType.ACCEPT:"function"==typeof o.delegate._onAcceptListener&&o.delegate._onAcceptListener(i,a,s);break;case r.SignalingType.REJECT:"function"==typeof o.delegate._onRejectListener&&o.delegate._onRejectListener(i,a,s);break;case r.SignalingType.STOP:"function"==typeof o.delegate._onStopListener&&o.delegate._onStopListener(i,a,s);break;case r.SignalingType.CANDIDATE:"function"==typeof o.delegate._onIceCandidatesListener&&o.delegate._onIceCandidatesListener(i,a,s);break;case r.SignalingType.PARAMETERS_CHANGED:"function"==typeof o.delegate._onUpdateListener&&o.delegate._onUpdateListener(i,a,s)}},this._getExtension=function(e){if(!e)return null;for(var t,n,r,o={},s=[],a=[],c=e.childNodes||e.children,l=0,u=c.length;l<u;l++){var d=c[l].childNodes||c[l].children,h=c[l].tagName||c[l].name;if("iceCandidates"===h)for(var f=0,p=d.length;f<p;f++){t={};for(var m=0,g=(r=d[f].childNodes||d[f].children).length;m<g;m++){var v=r[m].tagName||r[m].name,b=r[m].textContent||r[m].children[0];t[v]="sdpMLineIndex"===v?parseInt(b):b}s.push(t)}else if("opponentsIDs"===h)for(var y=0,S=d.length;y<S;y++)n=d[y].textContent||d[y].children[0],a.push(parseInt(n));else if(d.length>1)if((c[l].textContent||c[l].children[0]).length>4096){for(var C="",_=0;_<d.length;++_)C+=d.textContent||d.children[0];o[h]=C}else o=i._XMLtoJS(o,h,c[l]);else"userInfo"===c[l].tagName?o=i._XMLtoJS(o,h,c[l]):o[h]=c[l].textContent||c[l].children[0]}return s.length>0&&(o.iceCandidates=s),a.length>0&&(o.opponentsIDs=a),o}}},function(e,t,n){"use strict";function r(e){return(r="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e})(e)}var i=n(5),o=n(6),s=n(0),a=n(1),c=n(3);function l(e,t){this.service=e,this.connection=t}l.prototype.sendCandidate=function(e,t,n){var r=n||{};r.iceCandidates=t,this.sendMessage(e,r,o.SignalingType.CANDIDATE)},l.prototype.sendMessage=function(e,t,n){var l,u,d=t||{};d.moduleIdentifier=o.MODULE_ID,d.signalType=n,d.platform="web",d.userInfo&&!Object.keys(d.userInfo).length&&delete d.userInfo,u={to:i.getUserJid(e,a.creds.appId),type:"headline",id:s.getBsonObjectId()},l=c.createMessageStanza(u).c("extraParams",{xmlns:c.MARKERS.CLIENT}),Object.keys(d).forEach(function(e){"iceCandidates"===e?(l=l.c("iceCandidates"),d[e].forEach(function(e){l=l.c("iceCandidate"),Object.keys(e).forEach(function(t){l=l.c(t).t(e[t]).up()}),l=l.up()}),l=l.up()):"opponentsIDs"===e?(l=l.c("opponentsIDs"),d[e].forEach(function(e){l=l.c("opponentID").t(e).up()}),l=l.up()):"object"===r(d[e])?c._JStoXML(e,d[e],l):l=l.c(e).t(d[e]).up()}),l=l.up(),this.connection.send(l)},e.exports=l},function(e,t,n){"use strict";var r=n(52),i=n(0),o=n(1),s=n(53).EventEmitter;function a(e){if(!adapter)throw"Error: in order to use this library please connect adapter.js. More info https://github.com/webrtc/adapter";if(this.configs=e,!this.configs.server)throw"'server' parameter is mandatory.";this.configs.server.includes("http")&&(this.configs.server=this.configs.server+"/janus"),this.configs.debug||(this.configs.debug="all"),this.engine=null,this.videoRoomPlugin=null,this.isOnlyAudio=!1,this.currentDialogId=null,this.remoteFeeds=[],this.remoteJseps=[],this.remoteFeedsAttachingInProgress=[],this.currentMidiaDeviceId=null,this.bitrateTimers=[],this.emitter=new s}a.attachMediaStream=function(e,t){r.attachMediaStream(e,t)},a.listDevices=function(e){navigator.mediaDevices.enumerateDevices().then(function(t){console.debug(t),e(t)}).catch(function(t){console.error(t),e([])})},a.listVideoinputDevices=function(e){a.listDevices(function(t){for(var n=[],r=0;r!==t.length;++r){var i=t[r];if("videoinput"===i.kind){var o=i.label||"camera "+(n.length+1),s=i.deviceId;n.push({label:o,deviceId:s})}}e(n)})},a.prototype={createSession:function(e){var t=this;r.init({debug:this.configs.debug,callback:function(){r.isWebrtcSupported()?t.engine=new r({server:t.configs.server,iceServers:o.videochat.iceServers,success:function(){"function"==typeof e.success&&i.safeCallbackCall(e.success)},error:function(t){"function"==typeof e.error&&i.safeCallbackCall(e.error,t)},destroyed:function(){"function"==typeof e.destroyed&&i.safeCallbackCall(e.destroyed)},timeoutSessionCallback:function(){"function"==typeof e.timeoutSessionCallback&&i.safeCallbackCall(e.timeoutSessionCallback)}}):"function"==typeof e.error&&e.error("Your browser does not support WebRTC, so you can't use this functionality.")}})},getSessionId:function(){return this.engine?this.engine.getSessionId():null},destroySession:function(e){this.engine.destroy({}),"function"==typeof e.success&&i.safeCallbackCall(e.success)},attachVideoConferencingPlugin:function(e,t,n){var r=this,o=null;this.engine.attach({plugin:"janus.plugin.videoroom",success:function(s){if(e){(o=s).userId=t,r.remoteFeedsAttachingInProgress[t]=o;var a={request:"join",room:r.currentDialogId,ptype:"listener",feed:t};"safari"===adapter.browserDetails.browser&&(a.offer_video=!1),o.send({message:a})}else r.videoRoomPlugin=s;"function"==typeof n.success&&i.safeCallbackCall(n.success)},error:function(e){"function"==typeof n.error&&i.safeCallbackCall(n.error,i.wrapError(e))},consentDialog:function(e){"function"==typeof n.consentDialog&&i.safeCallbackCall(n.consentDialog,e)},mediaState:function(e,t){"function"==typeof n.mediaState&&i.safeCallbackCall(n.mediaState,e,t)},webrtcState:function(e){"function"==typeof n.webrtcState&&i.safeCallbackCall(n.webrtcState,e)},slowLink:function(e,t){"function"==typeof n.slowLink&&i.safeCallbackCall(n.slowLink,e,t)},iceState:function(e){"function"==typeof n.iceState&&i.safeCallbackCall(n.iceState,e)},onmessage:function(t,o){var s=t.videoroom;if(e){if(s)if("attached"===s){var a=t.id;r.remoteFeeds[a]=r.remoteFeedsAttachingInProgress[a],r.remoteFeedsAttachingInProgress[a]=null}else t.error&&"function"==typeof n.error&&i.safeCallbackCall(n.error,i.wrapError(t.error));if(o){a=t.id;r.remoteJseps[a]=o,r.createAnswer(r.remoteFeeds[a],o,{success:function(){},error:function(e){"function"==typeof n.error&&i.safeCallbackCall(n.error,i.wrapError(e))}})}}else{if(s)if("joined"===s)r.createOffer({useAudio:!0,useVideo:!r.isOnlyAudio},{success:function(){if(t.publishers){var e=t.publishers;for(var n in e){var i=e[n].id,o=e[n].display;r.emitter.emit("participantjoined",i,o)}}},error:function(e){"function"==typeof n.error&&i.safeCallbackCall(n.error,i.wrapError(e))}});else if("event"===s)if(t.publishers){var c=t.publishers;for(var l in c){var u=c[l].id,d=c[l].display;r.emitter.emit("participantjoined",u,d)}}else if(t.leaving){a=t.leaving;r.detachRemoteFeed(a)&&r.emitter.emit("participantleft",a,null)}else if(t.unpublished){if("ok"!=(a=t.unpublished))r.detachRemoteFeed(a)&&r.emitter.emit("participantleft",a,null)}else t.error&&"function"==typeof n.error&&i.safeCallbackCall(n.error,i.wrapError(t.error));o&&r.videoRoomPlugin.handleRemoteJsep({jsep:o})}},onlocalstream:function(e){r.emitter.emit("localstream",e)},onremotestream:function(e){o.stream=e,r.emitter.emit("remotestream",e,o.userId)},oncleanup:function(){console.info("ON CLEANUP"),"function"==typeof n.oncleanup&&i.safeCallbackCall(n.oncleanup)},detached:function(){}})},getPluginId:function(){return this.videoRoomPlugin?this.videoRoomPlugin.getId():null},detachVideoConferencingPlugin:function(e){var t=this,n=function(){t.videoRoomPlugin=null,Object.keys(t.remoteFeeds).forEach(function(e){t.detachRemoteFeed(e)}),t.remoteFeeds=[],t.remoteJseps=[],t.currentMidiaDeviceId=null};this.videoRoomPlugin.detach({success:function(){n(),"function"==typeof e.success&&i.safeCallbackCall(e.success)},error:function(t){n(),"function"==typeof e.error&&i.safeCallbackCall(e.error,t)}})},join:function(e,t,n,r){var o=this;if("boolean"!=typeof n)throw"'isOnlyAudio' parameter can be of type 'boolean' only.";o.isOnlyAudio=n,"safari"===adapter.browserDetails.browser&&(o.isOnlyAudio=!0),console.info("isOnlyAudio: "+o.isOnlyAudio);var s={request:"join",room:e,ptype:"publisher",id:t};this.videoRoomPlugin.send({message:s,success:function(n){o.currentDialogId=e,o.currentUserId=t,"function"==typeof r.success&&i.safeCallbackCall(r.success)},error:function(e){"function"==typeof r.error&&i.safeCallbackCall(r.error,e)}})},leave:function(e){if(console.warn("leave"),this.engine.isConnected()){var t={request:"leave",room:this.currentDialogId,id:this.currentUserId};this.videoRoomPlugin&&this.videoRoomPlugin.send({message:t}),this.currentDialogId=null,this.currentUserId=null,console.warn("resp"),"function"==typeof e.success&&i.safeCallbackCall(e.success)}else"function"==typeof e.success&&i.safeCallbackCall(e.success)},listOnlineParticipants:function(e,t){var n={request:"listparticipants",room:e};this.videoRoomPlugin.send({message:n,success:function(e){var n=[];e&&(n=e.participants),"function"==typeof t.success&&i.safeCallbackCall(t.success,n)},error:function(e){"function"==typeof t.error&&i.safeCallbackCall(t.error,e)}})},toggleAudioMute:function(){return this.videoRoomPlugin.isAudioMuted()?this.videoRoomPlugin.unmuteAudio():this.videoRoomPlugin.muteAudio(),this.videoRoomPlugin.isAudioMuted()},isAudioMuted:function(){return this.videoRoomPlugin.isAudioMuted()},toggleRemoteAudioMute:function(e){var t=this.remoteFeeds[e];if(!t)return!1;var n=t.stream.getAudioTracks();if(n&&n.length>0){for(var r=0;r<n.length;++r)n[r].enabled=!n[r].enabled;return!n[0].enabled}return!1},isRemoteAudioMuted:function(e){var t=this.remoteFeeds[e];if(!t)return!1;var n=t.stream.getAudioTracks();return!!(n&&n.length>0)&&!n[0].enabled},toggleVideoMute:function(){return this.videoRoomPlugin.isVideoMuted()?this.videoRoomPlugin.unmuteVideo():this.videoRoomPlugin.muteVideo(),this.videoRoomPlugin.isVideoMuted()},isVideoMuted:function(){return this.videoRoomPlugin.isVideoMuted()},toggleRemoteVideoMute:function(e){var t=this.remoteFeeds[e];if(!t)return!1;var n=t.stream.getVideoTracks();if(n&&n.length>0){for(var r=0;r<n.length;++r)n[r].enabled=!n[r].enabled;return!n[0].enabled}return!1},isRemoteVideoMuted:function(e){var t=this.remoteFeeds[e];if(!t)return!1;var n=t.stream.getVideoTracks();return!!(n&&n.length>0)&&!n[0].enabled},switchVideoinput:function(e,t){if(this.videoRoomPlugin){if(this.isOnlyAudio)throw"Can't switch video input in audio only call.";this.currentMidiaDeviceId=null;var n=this;this.createOffer({video:{deviceId:e},replaceVideo:!0},{success:function(){console.info("switchVideoinput: success"),n.currentMidiaDeviceId=e,"function"==typeof t.success&&i.safeCallbackCall(t.success)},error:function(e){console.info("switchVideoinput: error",e),"function"==typeof t.error&&i.safeCallbackCall(t.error,e)}})}else"function"==typeof t.error&&i.safeCallbackCall(t.error,"No active stream")},iceRestart:function(e,t){if(t){console.info("Performing remote ICE restart for user: ",e);var n=this.remoteFeeds[e];if(!n)return void("function"==typeof t.error&&i.safeCallbackCall(t.error,"No such user feed"));n.send({message:{request:"configure",restart:!0}}),"function"==typeof t.success&&i.safeCallbackCall(t.success)}else console.info("Performing local ICE restart"),this.createOffer({iceRestart:!0},{success:function(){"function"==typeof e.success&&i.safeCallbackCall(e.success)},error:function(t){"function"==typeof e.error&&i.safeCallbackCall(e.error,t)}})},createOffer:function(e,t){console.log("createOffer, inputParams: ",e);var n,r=this,i=e.useAudio,o=e.useVideo,s=e.stream,a=e.replaceVideo,c=e.iceRestart,l=r.configs.video?r.configs.video.quality:null,u=r.configs.video?r.configs.video.frameRate:null;s?n={stream:s}:a?(n={media:e},l&&(n.media.video=l),u&&(n.media.videoFrameRate={min:u,max:u})):c?n=e:(n={media:{audioRecv:!1,videoRecv:!1,audioSend:i,videoSend:o}},l&&(n.media.video=l),u&&(n.media.videoFrameRate={min:u,ideal:u})),console.info("createOffer params: ",n),n.success=function(e){var n={request:"configure"};a||c||(n.audio=i,n.video=o),console.info("createOffer publish: ",n),r.videoRoomPlugin.send({message:n,jsep:e}),"function"==typeof t.success&&t.success()},n.error=function(e){console.error("Error in createOffer: ",e),i?r.createOffer({useAudio:!1,useVideo:!1},t):"function"==typeof t.error&&t.error(e)},this.videoRoomPlugin.createOffer(n)},createAnswer:function(e,t,n){var r=this;e.createAnswer({jsep:t,media:{audioSend:!1,videoSend:!1},success:function(t){var o={request:"start",room:r.currentDialogId};e.send({message:o,jsep:t}),"function"==typeof n.success&&i.safeCallbackCall(n.success)},error:function(e){console.error("createAnswer error: ",e),"function"==typeof n.error&&i.safeCallbackCall(n.error,e)}})},detachRemoteFeed:function(e){var t=this.remoteFeeds[e];return!!t&&(t.detach(),this.remoteFeeds[e]=null,this.remoteJseps[e]=null,!0)},showBitrate:function(e,t){var n=this.remoteFeeds[e];"chrome"!==adapter.browserDetails.browser&&"firefox"!==adapter.browserDetails.browser||(this.bitrateTimers[e]=setInterval(function(){var e=n.getBitrate();t.text(e)},1e3))},hideBitrate:function(e,t){this.bitrateTimers[e]&&clearInterval(this.bitrateTimers[e]),this.bitrateTimers[e]=null,t.text=null},on:function(e,t){this.emitter.addListener(e,t)},removeAllListeners:function(e){e?this.emitter.removeAllListeners(e):this.emitter.removeAllListeners()}},e.exports={Client:a}},function(e,t,n){var r,i,o;function s(e){return(s="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e})(e)}o=function(){function e(t){if(void 0===e.initDone)return t.error("Library not initialized"),{};if(!e.isWebrtcSupported())return t.error("WebRTC not supported by this browser"),{};if(e.log("Library initialized: "+e.initDone),(t=t||{}).success="function"==typeof t.success?t.success:e.noop,t.error="function"==typeof t.error?t.error:e.noop,t.destroyed="function"==typeof t.destroyed?t.destroyed:e.noop,null===t.server||void 0===t.server)return t.error("Invalid gateway url"),{};var n=!1,r=null,i={},o=null,a=null,c=0,l=t.server;e.isArray(l)?(e.log("Multiple servers provided ("+l.length+"), will use the first that works"),l=null,a=t.server,e.debug(a)):0===l.indexOf("ws")?(n=!0,e.log("Using WebSockets to contact Janus: "+l)):(n=!1,e.log("Using REST API to contact Janus: "+l));var u=t.iceServers;null==u&&(u=[{urls:"stun:stun.l.google.com:19302"}]);var d=t.iceTransportPolicy,h=t.bundlePolicy,f=t.ipv6;null==f&&(f=!1);var p=!1;void 0!==t.withCredentials&&null!==t.withCredentials&&(p=!0===t.withCredentials);var m=null;void 0!==t.max_poll_events&&null!==t.max_poll_events&&(m=t.max_poll_events),m<1&&(m=1);var g=null;void 0!==t.token&&null!==t.token&&(g=t.token);var v=null;void 0!==t.apisecret&&null!==t.apisecret&&(v=t.apisecret),this.destroyOnUnload=!0,void 0!==t.destroyOnUnload&&null!==t.destroyOnUnload&&(this.destroyOnUnload=!0===t.destroyOnUnload);var b=!1,y=null,S={},C=this,_=0,w={};function T(){if(null!=y)if(e.debug("Long poll..."),b){var n=l+"/"+y+"?rid="+(new Date).getTime();null!=m&&(n=n+"&maxev="+m),null!=g&&(n=n+"&token="+g),null!=v&&(n=n+"&apisecret="+v),e.httpAPICall(n,{verb:"GET",withCredentials:p,success:x,timeout:6e4,error:function(n,r){if(e.error(n+": "+r),++_>3)return b=!1,void t.error("Lost connection to the gateway (is it down?)");T()}})}else e.warn("Is the gateway down? (connected=false)")}function x(t,r){if(_=0,n||null==u||!0===r||setTimeout(T,200),n||!e.isArray(t))if("keepalive"!==t.janus)if("ack"!==t.janus)if("success"!==t.janus){if("webrtcup"===t.janus)return e.debug("Got a webrtcup event on session "+u),e.debug(t),null==(i=t.sender)?void e.warn("Missing sender..."):null==(s=S[i])?void e.debug("This handle is not attached to this session"):void s.webrtcState(!0);if("hangup"===t.janus){if(e.debug("Got a hangup event on session "+u),e.debug(t),null==(i=t.sender))return void e.warn("Missing sender...");if(null==(s=S[i]))return void e.debug("This handle is not attached to this session");s.webrtcState(!1,t.reason),s.hangup()}else if("detached"===t.janus){if(e.debug("Got a detached event on session "+u),e.debug(t),null==(i=t.sender))return void e.warn("Missing sender...");if(null==(s=S[i]))return;s.detached=!0,s.ondetached(),s.detach()}else if("media"===t.janus){if(e.debug("Got a media event on session "+u),e.debug(t),null==(i=t.sender))return void e.warn("Missing sender...");if(null==(s=S[i]))return void e.debug("This handle is not attached to this session");s.mediaState(t.type,t.receiving)}else if("slowlink"===t.janus){if(e.debug("Got a slowlink event on session "+u),e.debug(t),null==(i=t.sender))return void e.warn("Missing sender...");if(null==(s=S[i]))return void e.debug("This handle is not attached to this session");s.slowLink(t.uplink,t.nacks)}else{if("error"===t.janus){if(e.error("Ooops: "+t.error.code+" "+t.error.reason),e.debug(t),null!=(h=t.transaction))null!=(f=w[h])&&f(t),delete w[h];return}if("event"===t.janus){var i;if(e.debug("Got a plugin event on session "+u),e.debug(t),null==(i=t.sender))return void e.warn("Missing sender...");var o=t.plugindata;if(null==o)return void e.warn("Missing plugindata...");e.debug("  -- Event is coming from "+i+" ("+o.plugin+")");var s,a=o.data;if(e.debug(a),null==(s=S[i]))return void e.warn("This handle is not attached to this session");var c=t.jsep;null!=c&&(e.debug("Handling SDP as well..."),e.debug(c));var l=s.onmessage;null!=l?(e.debug("Notifying application..."),l(a,c)):e.debug("No provided notification callback")}else if("timeout"===t.janus){var u=t.session_id,d=e.sessions[u];d&&d.timeoutSessionCallback()}else e.warn("Unkown message/event  '"+t.janus+"' on session "+u),e.debug(t)}}else{var h,f;e.debug("Got a success on session "+u),e.debug(t),null!=(h=t.transaction)&&(null!=(f=w[h])&&f(t),delete w[h])}else e.debug("Got an ack on session "+u),e.debug(t),null!=(h=t.transaction)&&(null!=(f=w[h])&&f(t),delete w[h]);else e.vdebug("Got a keepalive on session "+u);else for(var p=0;p<t.length;p++)x(t[p],!0)}function I(){if(null!==l&&n&&b){o=setTimeout(I,3e4);var t={janus:"keepalive",session_id:y,transaction:e.randomString(12)};null!=g&&(t.token=g),null!=v&&(t.apisecret=v),r.send(JSON.stringify(t))}}function E(t,i){if((i=i||{}).success="function"==typeof i.success?i.success:e.noop,i.error="function"==typeof i.error?i.error:e.noop,!b)return e.warn("Is the gateway down? (connected=false)"),void i.error("Is the gateway down? (connected=false)");var o=i.message,s=i.jsep,a=e.randomString(12),c={janus:"message",body:o,transaction:a};if(null!=g&&(c.token=g),null!=v&&(c.apisecret=v),null!=s&&(c.jsep=s),e.debug("Sending message to plugin (handle="+t+"):"),e.debug(c),n)return c.session_id=y,c.handle_id=t,w[a]=function(t){if(e.debug("Message sent!"),e.debug(t),"success"===t.janus){var n=t.plugindata;if(null==n)return e.warn("Request succeeded, but missing plugindata..."),void i.success();e.log("Synchronous transaction successful ("+n.plugin+")");var r=n.data;return e.debug(r),void i.success(r)}"ack"===t.janus?i.success():void 0!==t.error&&null!==t.error?(e.error("Ooops: "+t.error.code+" "+t.error.reason),i.error(t.error.code+" "+t.error.reason)):(e.error("Unknown error"),i.error("Unknown error"))},void r.send(JSON.stringify(c));e.httpAPICall(l+"/"+y+"/"+t,{verb:"POST",withCredentials:p,body:c,success:function(t){if(e.debug("Message sent!"),e.debug(t),"success"===t.janus){var n=t.plugindata;if(null==n)return e.warn("Request succeeded, but missing plugindata..."),void i.success();e.log("Synchronous transaction successful ("+n.plugin+")");var r=n.data;return e.debug(r),void i.success(r)}"ack"===t.janus?i.success():void 0!==t.error&&null!==t.error?(e.error("Ooops: "+t.error.code+" "+t.error.reason),i.error(t.error.code+" "+t.error.reason)):(e.error("Unknown error"),i.error("Unknown error"))},error:function(t,n){e.error(t+": "+n),i.error(t+": "+n)}})}function A(t,i){if(b){var o={janus:"trickle",candidate:i,transaction:e.randomString(12)};if(null!=g&&(o.token=g),null!=v&&(o.apisecret=v),e.vdebug("Sending trickle candidate (handle="+t+"):"),e.vdebug(o),n)return o.session_id=y,o.handle_id=t,void r.send(JSON.stringify(o));e.httpAPICall(l+"/"+y+"/"+t,{verb:"POST",withCredentials:p,body:o,success:function(t){e.vdebug("Candidate sent!"),e.vdebug(t),"ack"===t.janus||e.error("Ooops: "+t.error.code+" "+t.error.reason)},error:function(t,n){e.error(t+": "+n)}})}else e.warn("Is the gateway down? (connected=false)")}function k(t,n){(n=n||{}).success="function"==typeof n.success?n.success:e.noop,n.error="function"==typeof n.error?n.error:e.noop;var r=S[t];if(null==r||null===r.webrtcStuff||void 0===r.webrtcStuff)return e.warn("Invalid handle"),void n.error("Invalid handle");var i=r.webrtcStuff,o=n.text;if(null==o)return e.warn("Invalid text"),void n.error("Invalid text");e.log("Sending string on data channel: "+o),i.dataChannel.send(o),n.success()}function R(t,n){(n=n||{}).success="function"==typeof n.success?n.success:e.noop,n.error="function"==typeof n.error?n.error:e.noop;var r=S[t];if(null==r||null===r.webrtcStuff||void 0===r.webrtcStuff)return e.warn("Invalid handle"),void n.error("Invalid handle");var i=r.webrtcStuff;if(null===i.dtmfSender||void 0===i.dtmfSender){if(void 0!==i.myStream&&null!==i.myStream){var o=i.myStream.getAudioTracks();if(null!=o&&o.length>0){var s=o[0];i.dtmfSender=i.pc.createDTMFSender(s),e.log("Created DTMF Sender"),i.dtmfSender.ontonechange=function(t){e.debug("Sent DTMF tone: "+t.tone)}}}if(null===i.dtmfSender||void 0===i.dtmfSender)return e.warn("Invalid DTMF configuration"),void n.error("Invalid DTMF configuration")}var a=n.dtmf;if(null==a)return e.warn("Invalid DTMF parameters"),void n.error("Invalid DTMF parameters");var c=a.tones;if(null==c)return e.warn("Invalid DTMF string"),void n.error("Invalid DTMF string");var l=a.duration;null==l&&(l=500);var u=a.gap;null==u&&(u=50),e.debug("Sending DTMF string "+c+" (duration "+l+"ms, gap "+u+"ms)"),i.dtmfSender.insertDTMF(c,l,u)}function D(t,i){(i=i||{}).success="function"==typeof i.success?i.success:e.noop,i.error="function"==typeof i.error?i.error:e.noop;var o=!0;if(void 0!==i.asyncRequest&&null!==i.asyncRequest&&(o=!0===i.asyncRequest),e.log("Destroying handle "+t+" (async="+o+")"),F(t),S[t].detached)return delete S[t],void i.success();if(!b)return e.warn("Is the gateway down? (connected=false)"),void i.error("Is the gateway down? (connected=false)");var s={janus:"detach",transaction:e.randomString(12)};if(null!=g&&(s.token=g),null!=v&&(s.apisecret=v),n)return s.session_id=y,s.handle_id=t,r.send(JSON.stringify(s)),delete S[t],void i.success();e.httpAPICall(l+"/"+y+"/"+t,{verb:"POST",async:o,withCredentials:p,body:s,success:function(n){e.log("Destroyed handle:"),e.debug(n),"success"!==n.janus&&e.error("Ooops: "+n.error.code+" "+n.error.reason),delete S[t],i.success()},error:function(n,r){e.error(n+": "+r),delete S[t],i.success()}})}function O(t,n,r,i,o){console.warn("streamsDone",r);var a=S[t];if(null==a||null===a.webrtcStuff||void 0===a.webrtcStuff)return e.warn("Invalid handle"),void i.error("Invalid handle");var c=a.webrtcStuff;if(e.debug("streamsDone:",o),o&&(e.debug("  -- Audio tracks:",o.getAudioTracks()),e.debug("  -- Video tracks:",o.getVideoTracks())),r.update&&!c.streamExternal){if((r.removeAudio||r.replaceAudio)&&(c.myStream&&c.myStream.getAudioTracks()&&c.myStream.getAudioTracks().length&&(e.log("Removing audio track:",c.myStream.getAudioTracks()[0]),c.myStream.removeTrack(c.myStream.getAudioTracks()[0])),c.pc.getSenders()&&c.pc.getSenders().length))for(var l in c.pc.getSenders()){(p=c.pc.getSenders()[l])&&p.track&&"audio"===p.track.kind&&(e.log("Removing audio sender:",p),c.pc.removeTrack(p))}if((r.removeVideo||r.replaceVideo)&&(c.myStream&&c.myStream.getVideoTracks()&&c.myStream.getVideoTracks().length&&(e.log("Removing video track:",c.myStream.getVideoTracks()[0]),c.myStream.removeTrack(c.myStream.getVideoTracks()[0])),c.pc.getSenders()&&c.pc.getSenders().length))for(var l in c.pc.getSenders()){var p;(p=c.pc.getSenders()[l])&&p.track&&"video"===p.track.kind&&(e.log("Removing video sender:",p),c.pc.removeTrack(p))}}var m=!1;if(c.myStream&&r.update&&!c.streamExternal?((!r.update&&H(r)||r.update&&(r.addAudio||r.replaceAudio))&&o.getAudioTracks()&&o.getAudioTracks().length&&(e.log("Adding audio track:",o.getAudioTracks()[0]),c.myStream.addTrack(o.getAudioTracks()[0]),c.pc.addTrack(o.getAudioTracks()[0],o)),(!r.update&&z(r)||r.update&&(r.addVideo||r.replaceVideo))&&o.getVideoTracks()&&o.getVideoTracks().length&&(e.log("Adding video track:",o.getVideoTracks()[0]),c.myStream.addTrack(o.getVideoTracks()[0]),c.pc.addTrack(o.getVideoTracks()[0],o))):(c.myStream=o,m=!0),!c.pc){var g={iceServers:u,iceTransportPolicy:d,bundlePolicy:h},v={optional:[{DtlsSrtpKeyAgreement:!0}]};if(!0===f&&v.optional.push({googIPv6:!0}),i.rtcConstraints&&"object"===s(i.rtcConstraints))for(var b in e.debug("Adding custom PeerConnection constraints:",i.rtcConstraints),i.rtcConstraints)v.optional.push(i.rtcConstraints[b]);"edge"===e.webRTCAdapter.browserDetails.browser&&(g.bundlePolicy="max-bundle"),e.log("Creating PeerConnection"),e.debug(v),c.pc=new RTCPeerConnection(g,v),e.debug(c.pc),c.pc.getStats&&(c.volume.value=0,c.bitrate.value="0 kbits/sec"),e.log("Preparing local SDP and gathering candidates (trickle="+c.trickle+")"),c.pc.oniceconnectionstatechange=function(e){c.pc&&a.iceState(c.pc.iceConnectionState)},c.pc.onicecandidate=function(n){if(null==n.candidate||"edge"===e.webRTCAdapter.browserDetails.browser&&n.candidate.candidate.indexOf("endOfCandidates")>0)e.log("End of candidates."),c.iceDone=!0,!0===c.trickle?A(t,{completed:!0}):function(t,n){(n=n||{}).success="function"==typeof n.success?n.success:e.noop,n.error="function"==typeof n.error?n.error:e.noop;var r=S[t];if(null==r||null===r.webrtcStuff||void 0===r.webrtcStuff)return void e.warn("Invalid handle, not sending anything");var i=r.webrtcStuff;if(e.log("Sending offer/answer SDP..."),null===i.mySdp||void 0===i.mySdp)return void e.warn("Local SDP instance is invalid, not sending anything...");i.mySdp={type:i.pc.localDescription.type,sdp:i.pc.localDescription.sdp},!1===i.trickle&&(i.mySdp.trickle=!1);e.debug(n),i.sdpSent=!0,n.success(i.mySdp)}(t,i);else{var r={candidate:n.candidate.candidate,sdpMid:n.candidate.sdpMid,sdpMLineIndex:n.candidate.sdpMLineIndex};!0===c.trickle&&A(t,r)}},c.pc.ontrack=function(t){e.log("Handling Remote Track"),e.debug(t),t.streams&&(c.remoteStream=t.streams[0],a.onremotestream(c.remoteStream),t.track&&!t.track.onended&&(e.log("Adding onended callback to track:",t.track),t.track.onended=function(t){e.log("Remote track removed:",t),c.remoteStream&&(c.remoteStream.removeTrack(t.target),a.onremotestream(c.remoteStream))}))}}if(m&&null!=o&&(e.log("Adding local stream"),o.getTracks().forEach(function(e){c.pc.addTrack(e,o)})),function(t){if(e.debug("isDataEnabled:",t),"edge"==e.webRTCAdapter.browserDetails.browser)return e.warn("Edge doesn't support data channels yet"),!1;return null!=t&&!0===t.data}(r)&&!c.dataChannel){e.log("Creating data channel");var y=function(){var t=null!==c.dataChannel?c.dataChannel.readyState:"null";e.log("State change on data channel: "+t),"open"===t&&a.ondataopen()};c.dataChannel=c.pc.createDataChannel("JanusDataChannel",{ordered:!1}),c.dataChannel.onmessage=function(t){e.log("Received message on data channel: "+t.data),a.ondata(t.data)},c.dataChannel.onopen=y,c.dataChannel.onclose=y,c.dataChannel.onerror=function(t){e.error("Got error on data channel:",t)}}c.myStream&&a.onlocalstream(c.myStream),null==n?function(t,n,r){console.warn("createOffer:",n),(r=r||{}).success="function"==typeof r.success?r.success:e.noop,r.error="function"==typeof r.error?r.error:e.noop;var i=S[t];if(null==i||null===i.webrtcStuff||void 0===i.webrtcStuff)return e.warn("Invalid handle"),void r.error("Invalid handle");var o=i.webrtcStuff,s=!0===r.simulcast;s?e.log("Creating offer (iceDone="+o.iceDone+", simulcast="+s+")"):e.log("Creating offer (iceDone="+o.iceDone+")");var a={offerToReceiveAudio:B(n),offerToReceiveVideo:J(n)};!0===r.iceRestart&&(a.iceRestart=!0);e.debug(a);var c=z(n);if(c&&s&&"firefox"===e.webRTCAdapter.browserDetails.browser){e.log("Enabling Simulcasting for Firefox (RID)");var l=o.pc.getSenders()[1];e.log(l);var u=l.getParameters();e.log(u),l.setParameters({encodings:[{rid:"high",active:!0,priority:"high",maxBitrate:1e6},{rid:"medium",active:!0,priority:"medium",maxBitrate:3e5},{rid:"low",active:!0,priority:"low",maxBitrate:1e5}]})}o.pc.createOffer(function(t){if(e.debug(t),e.log("Setting local description"),c&&s&&("chrome"===e.webRTCAdapter.browserDetails.browser?(e.log("Enabling Simulcasting for Chrome (SDP munging)"),t.sdp=function(t){for(var n=t.split("\r\n"),r=!1,i=[-1],o=-1,s=null,a=null,c=null,l=null,u=-1,d=0;d<n.length;d++){var h=n[d].match(/m=(\w+) */);if(h){var f=h[1];if("video"===f){if(!(i[0]<0)){u=d;break}r=!0}else if(i[0]>-1){u=d;break}}else if(r){var p=n[d].match(/a=ssrc-group:FID (\d+) (\d+)/);if(p)i[0]=p[1],o=p[2],n.splice(d,1),d--;else{if(i[0]){var m=n[d].match("a=ssrc:"+i[0]+" cname:(.+)");if(m&&(s=m[1]),(m=n[d].match("a=ssrc:"+i[0]+" msid:(.+)"))&&(a=m[1]),(m=n[d].match("a=ssrc:"+i[0]+" mslabel:(.+)"))&&(c=m[1]),(m=n[d].match("a=ssrc:"+i+" label:(.+)"))&&(l=m[1]),0===n[d].indexOf("a=ssrc:"+o)){n.splice(d,1),d--;continue}if(0===n[d].indexOf("a=ssrc:"+i[0])){n.splice(d,1),d--;continue}}0!=n[d].length||(n.splice(d,1),d--)}}}if(i[0]<0){u=-1,r=!1;for(var d=0;d<n.length;d++){var h=n[d].match(/m=(\w+) */);if(h){var f=h[1];if("video"===f){if(!(i[0]<0)){u=d;break}r=!0}else if(i[0]>-1){u=d;break}}else if(r){if(i[0]<0){var g=n[d].match(/a=ssrc:(\d+)/);if(g){i[0]=g[1],n.splice(d,1),d--;continue}}else{var m=n[d].match("a=ssrc:"+i[0]+" cname:(.+)");if(m&&(s=m[1]),(m=n[d].match("a=ssrc:"+i[0]+" msid:(.+)"))&&(a=m[1]),(m=n[d].match("a=ssrc:"+i[0]+" mslabel:(.+)"))&&(c=m[1]),(m=n[d].match("a=ssrc:"+i+" label:(.+)"))&&(l=m[1]),0===n[d].indexOf("a=ssrc:"+o)){n.splice(d,1),d--;continue}if(0===n[d].indexOf("a=ssrc:"+i[0])){n.splice(d,1),d--;continue}}0!=n[d].length||(n.splice(d,1),d--)}}}if(i[0]<0)return e.warn("Couldn't find the video SSRC, simulcasting NOT enabled"),t;u<0&&(u=n.length);i[1]=Math.floor(4294967295*Math.random()),i[2]=Math.floor(4294967295*Math.random());for(var d=0;d<i.length;d++)s&&(n.splice(u,0,"a=ssrc:"+i[d]+" cname:"+s),u++),a&&(n.splice(u,0,"a=ssrc:"+i[d]+" msid:"+a),u++),c&&(n.splice(u,0,"a=ssrc:"+i[d]+" mslabel:"+a),u++),l&&(n.splice(u,0,"a=ssrc:"+i[d]+" label:"+a),u++);n.splice(u,0,"a=ssrc-group:SIM "+i[0]+" "+i[1]+" "+i[2]),(t=n.join("\r\n")).endsWith("\r\n")||(t+="\r\n");return t}(t.sdp)):"firefox"!==e.webRTCAdapter.browserDetails.browser&&e.warn("simulcast=true, but this is not Chrome nor Firefox, ignoring")),o.mySdp=t.sdp,o.pc.setLocalDescription(t),o.mediaConstraints=a,o.iceDone||o.trickle){e.log("Offer ready"),e.debug(r);var n={type:t.type,sdp:t.sdp};r.success(n)}else e.log("Waiting for all candidates...")},r.error,a)}(t,r,i):c.pc.setRemoteDescription(new RTCSessionDescription(n),function(){e.log("Remote description accepted!"),function(t,n,r){(r=r||{}).success="function"==typeof r.success?r.success:e.noop,r.error="function"==typeof r.error?r.error:e.noop;var i=S[t];if(null==i||null===i.webrtcStuff||void 0===i.webrtcStuff)return e.warn("Invalid handle"),void r.error("Invalid handle");var o=i.webrtcStuff,s=!0===r.simulcast;s?e.log("Creating answer (iceDone="+o.iceDone+", simulcast="+s+")"):e.log("Creating answer (iceDone="+o.iceDone+")");var a=null;a="firefox"==e.webRTCAdapter.browserDetails.browser||"edge"==e.webRTCAdapter.browserDetails.browser?{offerToReceiveAudio:B(n),offerToReceiveVideo:J(n)}:{mandatory:{OfferToReceiveAudio:B(n),OfferToReceiveVideo:J(n)}};e.debug(a);var c=z(n);if(c&&s&&"firefox"===e.webRTCAdapter.browserDetails.browser){e.log("Enabling Simulcasting for Firefox (RID)");var l=o.pc.getSenders()[1];e.log(l);var u=l.getParameters();e.log(u),l.setParameters({encodings:[{rid:"high",active:!0,priority:"high",maxBitrate:1e6},{rid:"medium",active:!0,priority:"medium",maxBitrate:3e5},{rid:"low",active:!0,priority:"low",maxBitrate:1e5}]})}o.pc.createAnswer(function(t){if(e.debug(t),e.log("Setting local description"),c&&s&&("chrome"===e.webRTCAdapter.browserDetails.browser?e.warn("simulcast=true, but this is an answer, and video breaks in Chrome if we enable it"):"firefox"!==e.webRTCAdapter.browserDetails.browser&&e.warn("simulcast=true, but this is not Chrome nor Firefox, ignoring")),o.mySdp=t.sdp,o.pc.setLocalDescription(t),o.mediaConstraints=a,o.iceDone||o.trickle){var n={type:t.type,sdp:t.sdp};r.success(n)}else e.log("Waiting for all candidates...")},r.error,a)}(t,r,i)},i.error)}function N(t,n){(n=n||{}).success="function"==typeof n.success?n.success:e.noop,n.error="function"==typeof n.error?n.error:q;var r=n.jsep;n.media=n.media||{audio:!0,video:!0};var i=n.media,o=S[t];if(null==o||null===o.webrtcStuff||void 0===o.webrtcStuff)return e.warn("Invalid handle"),void n.error("Invalid handle");var a,c=o.webrtcStuff;if(void 0===c.pc||null===c.pc)i.update=!1;else if(void 0!==c.pc&&null!==c.pc)if(e.log("Updating existing media session"),i.update=!0,null!==n.stream&&void 0!==n.stream)n.stream!==c.myStream&&e.log("Renegotiation involves a new external stream");else{if(i.addAudio){if(i.replaceAudio=!1,i.removeAudio=!1,i.audioSend=!0,c.myStream&&c.myStream.getAudioTracks()&&c.myStream.getAudioTracks().length)return e.error("Can't add audio stream, there already is one"),void n.error("Can't add audio stream, there already is one")}else i.removeAudio?(i.replaceAudio=!1,i.addAudio=!1,i.audioSend=!1):i.replaceAudio&&(i.addAudio=!1,i.removeAudio=!1,i.audioSend=!0);if(null===c.myStream||void 0===c.myStream?(i.replaceAudio&&(i.replaceAudio=!1,i.addAudio=!0,i.audioSend=!0),H(i)&&(i.addAudio=!0)):null!==c.myStream.getAudioTracks()&&void 0!==c.myStream.getAudioTracks()&&0!==c.myStream.getAudioTracks().length||(i.replaceAudio&&(i.replaceAudio=!1,i.addAudio=!0,i.audioSend=!0),H(i)&&(i.addAudio=!0)),i.addVideo){if(i.replaceVideo=!1,i.removeVideo=!1,i.videoSend=!0,c.myStream&&c.myStream.getVideoTracks()&&c.myStream.getVideoTracks().length)return e.error("Can't add video stream, there already is one"),void n.error("Can't add video stream, there already is one")}else i.removeVideo?(i.replaceVideo=!1,i.addVideo=!1,i.videoSend=!1):i.replaceVideo&&(i.addVideo=!1,i.removeVideo=!1,i.videoSend=!0);null===c.myStream||void 0===c.myStream?(i.replaceVideo&&(i.replaceVideo=!1,i.addVideo=!0,i.videoSend=!0),z(i)&&(i.addVideo=!0)):null!==c.myStream.getVideoTracks()&&void 0!==c.myStream.getVideoTracks()&&0!==c.myStream.getVideoTracks().length||(i.replaceVideo&&(i.replaceVideo=!1,i.addVideo=!0,i.videoSend=!0),z(i)&&(i.addVideo=!0)),i.addData&&(i.data=!0)}if(c.trickle=(a=n.trickle,e.debug("isTrickleEnabled:",a),null==a||!0===a),null!==n.stream&&void 0!==n.stream){var l=n.stream;if(e.log("MediaStream provided by the application"),e.debug(l),i.update&&c.myStream&&c.myStream!==n.stream&&!c.streamExternal){try{var u=c.myStream.getTracks();for(var d in u){var h=u[d];e.log(h),null!=h&&h.stop()}}catch(e){}c.myStream=null}return c.streamExternal=!0,void O(t,r,i,n,l)}if(H(i)||z(i)){var f={mandatory:{},optional:[]};o.consentDialog(!0);var p=H(i);!0===p&&null!=i&&null!=i&&"object"===s(i.audio)&&(p=i.audio);var m=z(i);if(!0===m&&null!=i&&null!=i)if(!(!0===n.simulcast)||r||void 0!==i.video&&!1!==i.video||(i.video="hires"),i.video&&"screen"!=i.video&&"window"!=i.video)if("object"===s(i.video))m=i.video;else{var g=0,v=0;"lowres"===i.video?(v=240,240,g=320):"lowres-16:9"===i.video?(v=180,180,g=320):"hires"===i.video||"hires-16:9"===i.video||"hdres"===i.video?(v=720,720,g=1280):"fhdres"===i.video?(v=1080,1080,g=1920):"4kres"===i.video?(v=2160,2160,g=3840):"stdres"===i.video?(v=480,480,g=640):"stdres-16:9"===i.video?(v=360,360,g=640):(e.log("Default video setting is stdres 4:3"),v=480,480,g=640),e.log("Adding media constraint:",i.video),m={height:{ideal:v},width:{ideal:g}},i.videoFrameRate&&(m.frameRate=i.videoFrameRate),e.debug("Adding video constraint:",m)}else if("screen"===i.video||"window"===i.video){var b=function(e,s){o.consentDialog(!1),e?n.error({code:e.code,name:e.name,message:e.message}):O(t,r,i,n,s)},y=function(t,n,r){e.log("Adding media constraint (screen capture)"),e.debug(t),navigator.mediaDevices.getUserMedia(t).then(function(e){r?navigator.mediaDevices.getUserMedia({audio:!0,video:!1}).then(function(t){e.addTrack(t.getAudioTracks()[0]),n(null,e)}):n(null,e)}).catch(function(e){o.consentDialog(!1),n(e)})};if(i.screenshareFrameRate||(i.screenshareFrameRate=3),"https:"!==window.location.protocol)return e.warn("Screen sharing only works on HTTPS, try the https:// version of this page"),o.consentDialog(!1),void n.error("Screen sharing only works on HTTPS, try the https:// version of this page");var C={};if("chrome"===e.webRTCAdapter.browserDetails.browser){var _=e.webRTCAdapter.browserDetails.version,w=33;if(window.navigator.userAgent.match("Linux")&&(w=35),_>=26&&_<=w)f={video:{mandatory:{googLeakyBucket:!0,maxWidth:window.screen.width,maxHeight:window.screen.height,minFrameRate:i.screenshareFrameRate,maxFrameRate:i.screenshareFrameRate,chromeMediaSource:"screen"}},audio:H(i)},y(f,b);else{var T=window.setTimeout(function(){return(x=new Error("NavigatorUserMediaError")).name='The required Chrome extension is not installed: click <a href="#">here</a> to install it. (NOTE: this will need you to refresh the page)',o.consentDialog(!1),n.error(x)},1e3);C[T]=[b,null],window.postMessage({type:"janusGetScreen",id:T},"*")}}else if(window.navigator.userAgent.match("Firefox")){if(!(parseInt(window.navigator.userAgent.match(/Firefox\/(.*)/)[1],10)>=33)){var x=new Error("NavigatorUserMediaError");return x.name="Your version of Firefox does not support screen sharing, please install Firefox 33 (or more recent versions)",o.consentDialog(!1),void n.error(x)}f={video:{mozMediaSource:i.video,mediaSource:i.video},audio:H(i)},y(f,function(e,t){if(b(e,t),!e)var n=t.currentTime,r=window.setInterval(function(){t||window.clearInterval(r),t.currentTime==n&&(window.clearInterval(r),t.onended&&t.onended()),n=t.currentTime},500)})}return void window.addEventListener("message",function(e){if(e.origin==window.location.origin)if("janusGotScreen"==e.data.type&&C[e.data.id]){var t=C[e.data.id][0];if(delete C[e.data.id],""===e.data.sourceId){var r=new Error("NavigatorUserMediaError");r.name="You cancelled the request for permission, giving up...",o.consentDialog(!1),n.error(r)}else(f={audio:!1,video:{mandatory:{chromeMediaSource:"desktop",maxWidth:window.screen.width,maxHeight:window.screen.height,minFrameRate:i.screenshareFrameRate,maxFrameRate:i.screenshareFrameRate},optional:[{googLeakyBucket:!0},{googTemporalLayeredScreencast:!0}]}}).video.mandatory.chromeMediaSourceId=e.data.sourceId,y(f,t,H(i))}else"janusGetScreenPending"==e.data.type&&window.clearTimeout(e.data.id)})}null!=i&&"screen"===i.video||navigator.mediaDevices.enumerateDevices().then(function(s){var a=s.some(function(e){return"audioinput"===e.kind}),c=s.some(function(e){return"videoinput"===e.kind}),l=H(i),u=z(i),d=function(t){return e.debug("isAudioSendRequired:",t),null!=t&&!1!==t.audio&&!1!==t.audioSend&&void 0!==t.failIfNoAudio&&null!==t.failIfNoAudio&&!0===t.failIfNoAudio}(i),h=function(t){return e.debug("isVideoSendRequired:",t),null!=t&&!1!==t.video&&!1!==t.videoSend&&void 0!==t.failIfNoVideo&&null!==t.failIfNoVideo&&!0===t.failIfNoVideo}(i);if(l||u||d||h){var f=!!l&&a,g=!!u&&c;if(!f&&!g)return o.consentDialog(!1),n.error("No capture device found"),!1;if(!f&&d)return o.consentDialog(!1),n.error("Audio capture is required, but no capture device found"),!1;if(!g&&h)return o.consentDialog(!1),n.error("Video capture is required, but no capture device found"),!1}navigator.mediaDevices.getUserMedia({audio:!!a&&p,video:!!c&&m}).then(function(s){var a=s.getVideoTracks()[0];a&&(e.debug("Video height: "+a.getSettings().height),e.debug("Video width: "+a.getSettings().width),e.debug("Video framerate: "+a.getSettings().frameRate)),o.consentDialog(!1),O(t,r,i,n,s)}).catch(function(e){o.consentDialog(!1),n.error({code:e.code,name:e.name,message:e.message})})}).catch(function(e){o.consentDialog(!1),n.error("enumerateDevices error",e)})}else O(t,r,i,n)}function L(t,n){(n=n||{}).success="function"==typeof n.success?n.success:e.noop,n.error="function"==typeof n.error?n.error:q;var r=n.jsep,i=S[t];if(null==i||null===i.webrtcStuff||void 0===i.webrtcStuff)return e.warn("Invalid handle"),void n.error("Invalid handle");var o=i.webrtcStuff;if(null!=r){if(null===o.pc)return e.warn("Wait, no PeerConnection?? if this is an answer, use createAnswer and not handleRemoteJsep"),void n.error("No PeerConnection: if this is an answer, use createAnswer and not handleRemoteJsep");o.pc.setRemoteDescription(new RTCSessionDescription(r),function(){e.log("Remote description accepted!"),n.success()},n.error)}else n.error("Invalid JSEP")}function M(t){var n=S[t];if(null==n||null===n.webrtcStuff||void 0===n.webrtcStuff)return e.warn("Invalid handle"),0;var r=n.webrtcStuff;return r.pc.getStats&&"chrome"==e.webRTCAdapter.browserDetails.browser?null===r.remoteStream||void 0===r.remoteStream?(e.warn("Remote stream unavailable"),0):null===r.volume.timer||void 0===r.volume.timer?(e.log("Starting volume monitor"),r.volume.timer=setInterval(function(){r.pc.getStats(function(e){for(var t=e.result(),n=0;n<t.length;n++){var i=t[n];"ssrc"==i.type&&i.stat("audioOutputLevel")&&(r.volume.value=i.stat("audioOutputLevel"))}})},200),0):r.volume.value:(e.log("Getting the remote volume unsupported by browser"),0)}function j(t,n){var r=S[t];if(null==r||null===r.webrtcStuff||void 0===r.webrtcStuff)return e.warn("Invalid handle"),!0;var i=r.webrtcStuff;return null===i.pc||void 0===i.pc?(e.warn("Invalid PeerConnection"),!0):void 0===i.myStream||null===i.myStream?(e.warn("Invalid local MediaStream"),!0):n?null===i.myStream.getVideoTracks()||void 0===i.myStream.getVideoTracks()||0===i.myStream.getVideoTracks().length?(e.warn("No video track"),!0):!i.myStream.getVideoTracks()[0].enabled:null===i.myStream.getAudioTracks()||void 0===i.myStream.getAudioTracks()||0===i.myStream.getAudioTracks().length?(e.warn("No audio track"),!0):!i.myStream.getAudioTracks()[0].enabled}function P(t,n,r){var i=S[t];if(null==i||null===i.webrtcStuff||void 0===i.webrtcStuff)return e.warn("Invalid handle"),!1;var o=i.webrtcStuff;return null===o.pc||void 0===o.pc?(e.warn("Invalid PeerConnection"),!1):void 0===o.myStream||null===o.myStream?(e.warn("Invalid local MediaStream"),!1):n?null===o.myStream.getVideoTracks()||void 0===o.myStream.getVideoTracks()||0===o.myStream.getVideoTracks().length?(e.warn("No video track"),!1):(o.myStream.getVideoTracks()[0].enabled=!r,!0):null===o.myStream.getAudioTracks()||void 0===o.myStream.getAudioTracks()||0===o.myStream.getAudioTracks().length?(e.warn("No audio track"),!1):(o.myStream.getAudioTracks()[0].enabled=!r,!0)}function U(t){var n=S[t];if(null==n||null===n.webrtcStuff||void 0===n.webrtcStuff)return e.warn("Invalid handle"),"Invalid handle";var r=n.webrtcStuff;return null===r.pc||void 0===r.pc?"Invalid PeerConnection":r.pc.getStats?null===r.bitrate.timer||void 0===r.bitrate.timer?(e.log("Starting bitrate timer (via getStats)"),r.bitrate.timer=setInterval(function(){r.pc.getStats().then(function(t){t.forEach(function(t){if(t){var n=!1;if(("video"===t.mediaType||t.id.toLowerCase().indexOf("video")>-1)&&"inbound-rtp"===t.type&&t.id.indexOf("rtcp")<0?n=!0:"ssrc"!=t.type||!t.bytesReceived||"VP8"!==t.googCodecName&&""!==t.googCodecName||(n=!0),n)if(r.bitrate.bsnow=t.bytesReceived,r.bitrate.tsnow=t.timestamp,null===r.bitrate.bsbefore||null===r.bitrate.tsbefore)r.bitrate.bsbefore=r.bitrate.bsnow,r.bitrate.tsbefore=r.bitrate.tsnow;else{var i=r.bitrate.tsnow-r.bitrate.tsbefore;"safari"==e.webRTCAdapter.browserDetails.browser&&(i/=1e3);var o=Math.round(8*(r.bitrate.bsnow-r.bitrate.bsbefore)/i);r.bitrate.value=o+" kbits/sec",r.bitrate.bsbefore=r.bitrate.bsnow,r.bitrate.tsbefore=r.bitrate.tsnow}}})})},1e3),"0 kbits/sec"):r.bitrate.value:(e.warn("Getting the video bitrate unsupported by browser"),"Feature unsupported by browser")}function q(t){e.error("WebRTC error:",t)}function F(t,i){e.log("Cleaning WebRTC stuff");var o=S[t];if(null!=o){var s=o.webrtcStuff;if(null!=s){if(!0===i){var a={janus:"hangup",transaction:e.randomString(12)};null!=g&&(a.token=g),null!=v&&(a.apisecret=v),e.debug("Sending hangup request (handle="+t+"):"),e.debug(a),n?(a.session_id=y,a.handle_id=t,r.send(JSON.stringify(a))):e.httpAPICall(l+"/"+y+"/"+t,{verb:"POST",withCredentials:p,data:a})}s.remoteStream=null,s.volume.timer&&clearInterval(s.volume.timer),s.volume.value=null,s.bitrate.timer&&clearInterval(s.bitrate.timer),s.bitrate.timer=null,s.bitrate.bsnow=null,s.bitrate.bsbefore=null,s.bitrate.tsnow=null,s.bitrate.tsbefore=null,s.bitrate.value=null;try{if(!s.streamExternal&&null!==s.myStream&&void 0!==s.myStream){e.log("Stopping local stream tracks");var c=s.myStream.getTracks();for(var u in c){var d=c[u];e.log(d),null!=d&&d.stop()}}}catch(e){}s.streamExternal=!1,s.myStream=null;try{s.pc.close()}catch(e){}s.pc=null,s.mySdp=null,s.iceDone=!1,s.dataChannel=null,s.dtmfSender=null}o.oncleanup()}}function H(t){return e.debug("isAudioSendEnabled:",t),null==t||!1!==t.audio&&(void 0===t.audioSend||null===t.audioSend||!0===t.audioSend)}function B(t){return e.debug("isAudioRecvEnabled:",t),null==t||!1!==t.audio&&(void 0===t.audioRecv||null===t.audioRecv||!0===t.audioRecv)}function z(t){return e.debug("isVideoSendEnabled:",t),null==t||!1!==t.video&&(void 0===t.videoSend||null===t.videoSend||!0===t.videoSend)}function J(t){return e.debug("isVideoRecvEnabled:",t),null==t||!1!==t.video&&(void 0===t.videoRecv||null===t.videoRecv||!0===t.videoRecv)}!function s(u){var d=e.randomString(12);var h={janus:"create",transaction:d};null!=g&&(h.token=g);null!=v&&(h.apisecret=v);null===l&&e.isArray(a)&&(0===(l=a[c]).indexOf("ws")?(n=!0,e.log("Server #"+(c+1)+": trying WebSockets to contact Janus ("+l+")")):(n=!1,e.log("Server #"+(c+1)+": trying REST API to contact Janus ("+l+")")));if(n){for(var f in r=e.newWebSocket(l,"janus-protocol"),i={error:function(){if(console.warn("WS error"),e.error("Error connecting to the Janus WebSockets server... "+l),e.isArray(a))return++c==a.length?void u.error("Error connecting to any of the provided Janus servers: Is the gateway down?"):(l=null,void setTimeout(function(){s(u)},200));u.error("Error connecting to the Janus WebSockets server: Is the gateway down?")},open:function(){console.warn("WS connected"),w[d]=function(t){if(e.debug(t),"success"!==t.janus)return e.error("Ooops: "+t.error.code+" "+t.error.reason),void u.error(t.error.reason);o=setTimeout(I,3e4),b=!0,y=t.data.id,e.log("Created session: "+y),e.sessions[y]=C,u.success()},r.send(JSON.stringify(h))},message:function(e){x(JSON.parse(e.data))},close:function(){null!==l&&b&&(b=!1,console.warn("WS close"),t.error("Lost connection to the gateway (is it down?)"))}})r.addEventListener(f,i[f]);return}e.httpAPICall(l,{verb:"POST",withCredentials:p,body:h,success:function(t){if(e.debug(t),"success"!==t.janus)return e.error("Ooops: "+t.error.code+" "+t.error.reason),void u.error(t.error.reason);b=!0,y=t.data.id,e.log("Created session: "+y),e.sessions[y]=C,T(),u.success()},error:function(t,n){if(e.error(t+": "+n),e.isArray(a))return++c==a.length?void u.error("Error connecting to any of the provided Janus servers: Is the gateway down?"):(l=null,void setTimeout(function(){s(u)},200));""===n?u.error(t+": Is the gateway down?"):u.error(t+": "+n)}})}(t),this.getServer=function(){return l},this.isConnected=function(){return b},this.getSessionId=function(){return y},this.destroy=function(s){!function(s){(s=s||{}).success="function"==typeof s.success?s.success:e.noop;var a=!0;void 0!==s.asyncRequest&&null!==s.asyncRequest&&(a=!0===s.asyncRequest);if(e.log("Destroying session "+y+" (async="+a+")"),!b)return e.warn("Is the gateway down? (connected=false)"),void s.success();if(null==y)return e.warn("No session to destroy"),s.success(),void t.destroyed();delete e.sessions[y];var c={janus:"destroy",transaction:e.randomString(12)};null!=g&&(c.token=g);null!=v&&(c.apisecret=v);if(n){c.session_id=y;var u=function(){for(var e in i)r.removeEventListener(e,i[e]);r.removeEventListener("message",d),r.removeEventListener("error",h),o&&clearTimeout(o),r.close()},d=function(e){var n=JSON.parse(e.data);n.session_id==c.session_id&&n.transaction==c.transaction&&(u(),s.success(),t.destroyed())},h=function(e){u(),s.error("Failed to destroy the gateway: Is the gateway down?"),t.destroyed()};return r.addEventListener("message",d),r.addEventListener("error",h),void r.send(JSON.stringify(c))}e.httpAPICall(l+"/"+y,{verb:"POST",async:a,withCredentials:p,body:c,success:function(n){e.log("Destroyed session:"),e.debug(n),y=null,b=!1,"success"!==n.janus&&e.error("Ooops: "+n.error.code+" "+n.error.reason),s.success(),t.destroyed()},error:function(n,r){e.error(n+": "+r),y=null,b=!1,s.success(),t.destroyed()}})}(s)},this.attach=function(t){!function(t){if((t=t||{}).success="function"==typeof t.success?t.success:e.noop,t.error="function"==typeof t.error?t.error:e.noop,t.consentDialog="function"==typeof t.consentDialog?t.consentDialog:e.noop,t.iceState="function"==typeof t.iceState?t.iceState:e.noop,t.mediaState="function"==typeof t.mediaState?t.mediaState:e.noop,t.webrtcState="function"==typeof t.webrtcState?t.webrtcState:e.noop,t.slowLink="function"==typeof t.slowLink?t.slowLink:e.noop,t.onmessage="function"==typeof t.onmessage?t.onmessage:e.noop,t.onlocalstream="function"==typeof t.onlocalstream?t.onlocalstream:e.noop,t.onremotestream="function"==typeof t.onremotestream?t.onremotestream:e.noop,t.ondata="function"==typeof t.ondata?t.ondata:e.noop,t.ondataopen="function"==typeof t.ondataopen?t.ondataopen:e.noop,t.oncleanup="function"==typeof t.oncleanup?t.oncleanup:e.noop,t.ondetached="function"==typeof t.ondetached?t.ondetached:e.noop,!b)return e.warn("Is the gateway down? (connected=false)"),void t.error("Is the gateway down? (connected=false)");var i=t.plugin;if(null==i)return e.error("Invalid plugin"),void t.error("Invalid plugin");var o=t.opaqueId,s=e.randomString(12),a={janus:"attach",plugin:i,opaque_id:o,transaction:s};null!=g&&(a.token=g);null!=v&&(a.apisecret=v);"chrome"!=e.webRTCAdapter.browserDetails.browser&&"firefox"!=e.webRTCAdapter.browserDetails.browser&&"safari"!=e.webRTCAdapter.browserDetails.browser||(a["force-bundle"]=!0,a["force-rtcp-mux"]=!0);if(n)return w[s]=function(n){if(e.debug(n),"success"!==n.janus)return e.error("Ooops: "+n.error.code+" "+n.error.reason),void t.error("Ooops: "+n.error.code+" "+n.error.reason);var r=n.data.id;e.log("Created handle: "+r);var o={session:C,plugin:i,id:r,detached:!1,webrtcStuff:{started:!1,myStream:null,streamExternal:!1,remoteStream:null,mySdp:null,mediaConstraints:null,pc:null,dataChannel:null,dtmfSender:null,trickle:!0,iceDone:!1,volume:{value:null,timer:null},bitrate:{value:null,bsnow:null,bsbefore:null,tsnow:null,tsbefore:null,timer:null}},getId:function(){return r},getPlugin:function(){return i},getVolume:function(){return M(r)},isAudioMuted:function(){return j(r,!1)},muteAudio:function(){return P(r,!1,!0)},unmuteAudio:function(){return P(r,!1,!1)},isVideoMuted:function(){return j(r,!0)},muteVideo:function(){return P(r,!0,!0)},unmuteVideo:function(){return P(r,!0,!1)},getBitrate:function(){return U(r)},send:function(e){E(r,e)},data:function(e){k(r,e)},dtmf:function(e){R(r,e)},consentDialog:t.consentDialog,iceState:t.iceState,mediaState:t.mediaState,webrtcState:t.webrtcState,slowLink:t.slowLink,onmessage:t.onmessage,createOffer:function(e){N(r,e)},createAnswer:function(e){N(r,e)},handleRemoteJsep:function(e){L(r,e)},onlocalstream:t.onlocalstream,onremotestream:t.onremotestream,ondata:t.ondata,ondataopen:t.ondataopen,oncleanup:t.oncleanup,ondetached:t.ondetached,hangup:function(e){F(r,!0===e)},detach:function(e){D(r,e)}};S[r]=o,t.success(o)},a.session_id=y,void r.send(JSON.stringify(a));e.httpAPICall(l+"/"+y,{verb:"POST",withCredentials:p,body:a,success:function(n){if(e.debug(n),"success"!==n.janus)return e.error("Ooops: "+n.error.code+" "+n.error.reason),void t.error("Ooops: "+n.error.code+" "+n.error.reason);var r=n.data.id;e.log("Created handle: "+r);var o={session:C,plugin:i,id:r,detached:!1,webrtcStuff:{started:!1,myStream:null,streamExternal:!1,remoteStream:null,mySdp:null,mediaConstraints:null,pc:null,dataChannel:null,dtmfSender:null,trickle:!0,iceDone:!1,volume:{value:null,timer:null},bitrate:{value:null,bsnow:null,bsbefore:null,tsnow:null,tsbefore:null,timer:null}},getId:function(){return r},getPlugin:function(){return i},getVolume:function(){return M(r)},isAudioMuted:function(){return j(r,!1)},muteAudio:function(){return P(r,!1,!0)},unmuteAudio:function(){return P(r,!1,!1)},isVideoMuted:function(){return j(r,!0)},muteVideo:function(){return P(r,!0,!0)},unmuteVideo:function(){return P(r,!0,!1)},getBitrate:function(){return U(r)},send:function(e){E(r,e)},data:function(e){k(r,e)},dtmf:function(e){R(r,e)},consentDialog:t.consentDialog,iceState:t.iceState,mediaState:t.mediaState,webrtcState:t.webrtcState,slowLink:t.slowLink,onmessage:t.onmessage,createOffer:function(e){N(r,e)},createAnswer:function(e){N(r,e)},handleRemoteJsep:function(e){L(r,e)},onlocalstream:t.onlocalstream,onremotestream:t.onremotestream,ondata:t.ondata,ondataopen:t.ondataopen,oncleanup:t.oncleanup,ondetached:t.ondetached,hangup:function(e){F(r,!0===e)},detach:function(e){D(r,e)}};S[r]=o,t.success(o)},error:function(t,n){e.error(t+": "+n)}})}(t)},this.timeoutSessionCallback="function"==typeof t.timeoutSessionCallback?t.timeoutSessionCallback:e.noop}return e.sessions={},e.extensionId="hapfgfdkleiggjjpfpenajgdnfckjpaj",e.isExtensionEnabled=function(){if(window.navigator.userAgent.match("Chrome")){var t=parseInt(window.navigator.userAgent.match(/Chrome\/(.*) /)[1],10),n=33;return window.navigator.userAgent.match("Linux")&&(n=35),t>=26&&t<=n||e.checkJanusExtension()}return!0},e.useDefaultDependencies=function(t){var n=t&&t.fetch||fetch,r=t&&t.Promise||Promise,i=t&&t.WebSocket||WebSocket;return{newWebSocket:function(e,t){return new i(e,t)},isArray:function(e){return Array.isArray(e)},checkJanusExtension:function(){return null!==document.querySelector("#janus-extension-installed")},webRTCAdapter:t&&t.adapter||adapter,httpAPICall:function(t,i){var o={method:i.verb,cache:"no-cache"};void 0!==i.withCredentials&&(o.credentials=!0===i.withCredentials?"include":i.withCredentials?i.withCredentials:"omit"),void 0!==i.body&&(o.body=JSON.stringify(i.body));var a=n(t,o).catch(function(e){return r.reject({message:"Probably a network error, is the gateway down?",error:e})});if(void 0!==i.timeout){var c=new r(function(e,t){var n=setTimeout(function(){return clearTimeout(n),t({message:"Request timed out",timeout:i.timeout})},i.timeout)});a=r.race([a,c])}return a.then(function(t){return t.ok?s(i.success)===s(e.noop)?t.json().then(function(e){i.success(e)}).catch(function(e){return r.reject({message:"Failed to parse response body",error:e,response:t})}):void 0:r.reject({message:"API call failed",response:t})}).catch(function(t){s(i.error)===s(e.noop)&&i.error(t.message||"<< internal error >>",t)}),a}}},e.useOldDependencies=function(t){var n=t&&t.jQuery||jQuery,r=t&&t.WebSocket||WebSocket;return{newWebSocket:function(e,t){return new r(e,t)},isArray:function(e){return n.isArray(e)},checkJanusExtension:function(){return n("#janus-extension-installed").length>0},webRTCAdapter:t&&t.adapter||adapter,httpAPICall:function(t,r){var i=void 0!==r.body?{contentType:"application/json",data:JSON.stringify(r.body)}:{},o=void 0!==r.withCredentials?{xhrFields:{withCredentials:r.withCredentials}}:{};return n.ajax(n.extend(i,o,{url:t,type:r.verb,cache:!1,dataType:"json",async:r.async,timeout:r.timeout,success:function(t){s(r.success)===s(e.noop)&&r.success(t)},error:function(t,n,i){s(r.error)===s(e.noop)&&r.error(n,i)}}))}}},e.noop=function(){},e.init=function(t){if((t=t||{}).callback="function"==typeof t.callback?t.callback:e.noop,!0===e.initDone)t.callback();else{if("undefined"!=typeof console&&void 0!==console.log||(console={log:function(){}}),e.trace=e.noop,e.debug=e.noop,e.vdebug=e.noop,e.log=e.noop,e.warn=e.noop,e.error=e.noop,!0===t.debug||"all"===t.debug)e.trace=console.trace.bind(console),e.debug=console.debug.bind(console),e.vdebug=console.debug.bind(console),e.log=console.log.bind(console),e.warn=console.warn.bind(console),e.error=console.error.bind(console);else if(Array.isArray(t.debug))for(var n in t.debug){var r=t.debug[n];switch(r){case"trace":e.trace=console.trace.bind(console);break;case"debug":e.debug=console.debug.bind(console);break;case"vdebug":e.vdebug=console.debug.bind(console);break;case"log":e.log=console.log.bind(console);break;case"warn":e.warn=console.warn.bind(console);break;case"error":e.error=console.error.bind(console);break;default:console.error("Unknown debugging option '"+r+"' (supported: 'trace', 'debug', 'vdebug', 'log', warn', 'error')")}}e.log("Initializing library");var i=t.dependencies||e.useDefaultDependencies();e.isArray=i.isArray,e.webRTCAdapter=i.webRTCAdapter,e.httpAPICall=i.httpAPICall,e.checkJanusExtension=i.checkJanusExtension,e.newWebSocket=i.newWebSocket,e.listDevices=function(t,n){t="function"==typeof t?t:e.noop,null==n&&(n={audio:!0,video:!0}),navigator.mediaDevices?navigator.mediaDevices.getUserMedia(n).then(function(n){navigator.mediaDevices.enumerateDevices().then(function(r){e.debug(r),t(r);try{var i=n.getTracks();for(var o in i){var s=i[o];null!=s&&s.stop()}}catch(e){}})}).catch(function(n){e.error(n),t([])}):(e.warn("navigator.mediaDevices unavailable"),t([]))},e.attachMediaStream=function(t,n){"chrome"===e.webRTCAdapter.browserDetails.browser?e.webRTCAdapter.browserDetails.version>=43?t.srcObject=n:void 0!==t.src?t.src=URL.createObjectURL(n):e.error("Error attaching stream to element"):t.srcObject=n},e.reattachMediaStream=function(t,n){"chrome"===e.webRTCAdapter.browserDetails.browser?e.webRTCAdapter.browserDetails.version>=43?t.srcObject=n.srcObject:void 0!==t.src?t.src=n.src:e.error("Error reattaching stream to element"):t.srcObject=n.srcObject};var o=window.onbeforeunload;window.onbeforeunload=function(){for(var t in e.log("Closing window"),e.sessions)null!==e.sessions[t]&&void 0!==e.sessions[t]&&e.sessions[t].destroyOnUnload&&(e.log("Destroying session "+t),e.sessions[t].destroy({asyncRequest:!1}));o&&"function"==typeof o&&o()},e.initDone=!0,t.callback()}},e.isWebrtcSupported=function(){return void 0!==window.RTCPeerConnection&&null!==window.RTCPeerConnection&&void 0!==navigator.getUserMedia&&null!==navigator.getUserMedia},e.randomString=function(e){for(var t="ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789",n="",r=0;r<e;r++){var i=Math.floor(Math.random()*t.length);n+=t.substring(i,i+1)}return n},e},"object"===s(t)&&void 0!==e?e.exports=o():void 0===(i="function"==typeof(r=o)?r.call(t,n,t,e):r)||(e.exports=i)},function(e,t,n){var r={EventEmitter:n(54),EmitterSubscription:n(12)};e.exports=r},function(e,t,n){"use strict";var r=n(12),i=n(56),o=n(57),s=n(13),a=function(){function e(){!function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,e),this._subscriber=new i,this._currentSubscription=null}return e.prototype.addListener=function(e,t,n){return this._subscriber.addSubscription(e,new r(this._subscriber,t,n))},e.prototype.once=function(e,t,n){var r=this;return this.addListener(e,function(){r.removeCurrentListener(),t.apply(n,arguments)})},e.prototype.removeAllListeners=function(e){this._subscriber.removeAllSubscriptions(e)},e.prototype.removeCurrentListener=function(){this._currentSubscription||s(!1),this._subscriber.removeSubscription(this._currentSubscription)},e.prototype.listeners=function(e){var t=this._subscriber.getSubscriptionsForType(e);return t?t.filter(o.thatReturnsTrue).map(function(e){return e.listener}):[]},e.prototype.emit=function(e){var t=this._subscriber.getSubscriptionsForType(e);if(t){for(var n=Object.keys(t),r=0;r<n.length;r++){var i=t[n[r]];i&&(this._currentSubscription=i,this.__emitToSubscription.apply(this,[i].concat(Array.prototype.slice.call(arguments))))}this._currentSubscription=null}},e.prototype.__emitToSubscription=function(e,t){var n=Array.prototype.slice.call(arguments,2);e.listener.apply(e.context,n)},e}();e.exports=a},function(e,t,n){"use strict";var r=function(){function e(t){!function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,e),this.subscriber=t}return e.prototype.remove=function(){this.subscriber&&(this.subscriber.removeSubscription(this),this.subscriber=null)},e}();e.exports=r},function(e,t,n){"use strict";var r=n(13),i=function(){function e(){!function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,e),this._subscriptionsForType={},this._currentSubscription=null}return e.prototype.addSubscription=function(e,t){t.subscriber!==this&&r(!1),this._subscriptionsForType[e]||(this._subscriptionsForType[e]=[]);var n=this._subscriptionsForType[e].length;return this._subscriptionsForType[e].push(t),t.eventType=e,t.key=n,t},e.prototype.removeAllSubscriptions=function(e){void 0===e?this._subscriptionsForType={}:delete this._subscriptionsForType[e]},e.prototype.removeSubscription=function(e){var t=e.eventType,n=e.key,r=this._subscriptionsForType[t];r&&delete r[n]},e.prototype.getSubscriptionsForType=function(e){return this._subscriptionsForType[e]},e}();e.exports=i},function(e,t,n){"use strict";function r(e){return function(){return e}}var i=function(){};i.thatReturns=r,i.thatReturnsFalse=r(!1),i.thatReturnsTrue=r(!0),i.thatReturnsNull=r(null),i.thatReturnsThis=function(){return this},i.thatReturnsArgument=function(e){return e},e.exports=i}])});
//# sourceMappingURL=connectycube.min.map